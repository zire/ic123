<html>
<head><meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<style type="text/css">
<!--
span.cls_002{font-family:Arial,serif;font-size:17.3px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_002{font-family:Arial,serif;font-size:17.3px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_003{font-family:Arial,serif;font-size:12.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_003{font-family:Arial,serif;font-size:12.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_004{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_004{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_005{font-family:Arial,serif;font-size:10.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_005{font-family:Arial,serif;font-size:10.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_006{font-family:Arial,serif;font-size:14.4px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_006{font-family:Arial,serif;font-size:14.4px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_007{font-family:Arial,serif;font-size:11.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_007{font-family:Arial,serif;font-size:11.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_008{font-family:Arial,serif;font-size:6.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_008{font-family:Arial,serif;font-size:6.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_009{font-family:Arial,serif;font-size:9.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_009{font-family:Arial,serif;font-size:9.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_011{font-family:Arial,serif;font-size:6.2px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_011{font-family:Arial,serif;font-size:6.2px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_012{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_012{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_013{font-family:Arial,serif;font-size:6.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_013{font-family:Arial,serif;font-size:6.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_014{font-family:Arial,serif;font-size:11.9px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_014{font-family:Arial,serif;font-size:11.9px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_016{font-family:Arial,serif;font-size:7.3px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_016{font-family:Arial,serif;font-size:7.3px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_019{font-family:Arial,serif;font-size:5.5px;color:rgb(6,161,255);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_019{font-family:Arial,serif;font-size:5.5px;color:rgb(6,161,255);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_018{font-family:Arial,serif;font-size:5.5px;color:rgb(254,147,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_018{font-family:Arial,serif;font-size:5.5px;color:rgb(254,147,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_015{font-family:Arial,serif;font-size:6.9px;color:rgb(255,254,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_015{font-family:Arial,serif;font-size:6.9px;color:rgb(255,254,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_020{font-family:Arial,serif;font-size:5.5px;color:rgb(28,176,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_020{font-family:Arial,serif;font-size:5.5px;color:rgb(28,176,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_017{font-family:Arial,serif;font-size:7.3px;color:rgb(0,0,0);font-weight:bold;font-style:italic;text-decoration: none}
div.cls_017{font-family:Arial,serif;font-size:7.3px;color:rgb(0,0,0);font-weight:bold;font-style:italic;text-decoration: none}
span.cls_021{font-family:Arial,serif;font-size:7.2px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_021{font-family:Arial,serif;font-size:7.2px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_022{font-family:Arial,serif;font-size:5.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_022{font-family:Arial,serif;font-size:5.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_023{font-family:Arial,serif;font-size:7.3px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_023{font-family:Arial,serif;font-size:7.3px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_024{font-family:Arial,serif;font-size:6.2px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_024{font-family:Arial,serif;font-size:6.2px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
-->
</style>
<script type="text/javascript" src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/wz_jsgraphics.js"></script>
</head>
<body>
<div style="position:absolute;left:50%;margin-left:-306px;top:0px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background01.jpg" width=612 height=792></div>
<div style="position:absolute;left:189.82px;top:127.48px" class="cls_002"><span class="cls_002">The Internet Computer for Geeks</span></div>
<div style="position:absolute;left:290.88px;top:152.62px" class="cls_003"><span class="cls_003">(v1.0)</span></div>
<div style="position:absolute;left:252.36px;top:182.57px" class="cls_003"><span class="cls_003">The DFINITY Team</span><span class="cls_004"><sup>∗</sup></span></div>
<div style="position:absolute;left:262.35px;top:207.39px" class="cls_003"><span class="cls_003">January 21, 2022</span></div>
<div style="position:absolute;left:284.08px;top:261.61px" class="cls_005"><span class="cls_005">Abstract</span></div>
<div style="position:absolute;left:132.22px;top:279.79px" class="cls_005"><span class="cls_005">Smart contracts are a new form of software that will revolutionize how software is</span></div>
<div style="position:absolute;left:117.27px;top:291.74px" class="cls_005"><span class="cls_005">written, IT systems are maintained, and applications and whole businesses are built.</span></div>
<div style="position:absolute;left:117.27px;top:303.70px" class="cls_005"><span class="cls_005">Smart contracts are composable and autonomous pieces of software that run on decen-</span></div>
<div style="position:absolute;left:117.27px;top:315.66px" class="cls_005"><span class="cls_005">tralized blockchains, which makes them tamperproof and unstoppable.  In this paper,</span></div>
<div style="position:absolute;left:117.27px;top:327.61px" class="cls_005"><span class="cls_005">we describe the Internet Computer (IC), which is a radical new design of blockchain</span></div>
<div style="position:absolute;left:117.27px;top:339.57px" class="cls_005"><span class="cls_005">that unleashes the full potential of smart contracts, overcoming the limitations of smart</span></div>
<div style="position:absolute;left:117.27px;top:351.52px" class="cls_005"><span class="cls_005">contracts on traditional blockchains with respect to speed, storage costs, and compu-</span></div>
<div style="position:absolute;left:117.27px;top:363.48px" class="cls_005"><span class="cls_005">tational capacity.  This allows smart contracts for the first time to implement fully</span></div>
<div style="position:absolute;left:117.27px;top:375.43px" class="cls_005"><span class="cls_005">decentralized applications that are hosted end to end on blockchain.  The IC consists</span></div>
<div style="position:absolute;left:117.27px;top:387.39px" class="cls_005"><span class="cls_005">of a set of cryptographic protocols that connects independently operated nodes into a</span></div>
<div style="position:absolute;left:117.27px;top:399.34px" class="cls_005"><span class="cls_005">collection of blockchains. These blockchains host and execute “canisters”, the IC’s form</span></div>
<div style="position:absolute;left:117.27px;top:411.30px" class="cls_005"><span class="cls_005">of smart contracts.  Canisters can store data, perform very general computations on</span></div>
<div style="position:absolute;left:117.27px;top:423.25px" class="cls_005"><span class="cls_005">that data, and provide a complete technology stack, serving web pages directly to end</span></div>
<div style="position:absolute;left:117.27px;top:435.21px" class="cls_005"><span class="cls_005">users.  Computational and storage costs are covered by a “reverse-gas model”, where</span></div>
<div style="position:absolute;left:117.27px;top:447.16px" class="cls_005"><span class="cls_005">canister developers pre-pay costs in cycles that are obtained from ICP, the native token</span></div>
<div style="position:absolute;left:117.27px;top:459.12px" class="cls_005"><span class="cls_005">of the IC. ICP tokens are also used for governance: the IC is governed by a decentralized</span></div>
<div style="position:absolute;left:117.27px;top:471.07px" class="cls_005"><span class="cls_005">autonomous organization, or DAO, which, among other things, determines changes to</span></div>
<div style="position:absolute;left:117.27px;top:483.03px" class="cls_005"><span class="cls_005">the topology of the network and upgrades to the protocol.</span></div>
<div style="position:absolute;left:90.00px;top:513.02px" class="cls_006"><span class="cls_006">1</span></div>
<div style="position:absolute;left:114.21px;top:513.02px" class="cls_006"><span class="cls_006">Introduction</span></div>
<div style="position:absolute;left:90.00px;top:540.16px" class="cls_003"><span class="cls_003">1.1</span></div>
<div style="position:absolute;left:120.64px;top:540.16px" class="cls_003"><span class="cls_003">Unleashing smart contracts</span></div>
<div style="position:absolute;left:90.00px;top:561.80px" class="cls_007"><span class="cls_007">Because of their unique features, smart contracts are the key enabler of Web3, the new</span></div>
<div style="position:absolute;left:90.00px;top:575.35px" class="cls_007"><span class="cls_007">approach to the web where applications are fully controlled by their users and run on</span></div>
<div style="position:absolute;left:90.00px;top:588.90px" class="cls_007"><span class="cls_007">decentralized blockchain platforms.  Such decentralized applications (dapps) are typically</span></div>
<div style="position:absolute;left:90.00px;top:602.45px" class="cls_007"><span class="cls_007">tokenized, meaning tokens are distributed to users as rewards for participating in the dapps.</span></div>
<div style="position:absolute;left:90.00px;top:615.99px" class="cls_007"><span class="cls_007">Participation can come in many different forms, ranging from moderating and providing</span></div>
<div style="position:absolute;left:90.00px;top:629.54px" class="cls_007"><span class="cls_007">content to governing a dapp and to creating and maintaining a dapp.  Usually, tokens</span></div>
<div style="position:absolute;left:90.00px;top:643.09px" class="cls_007"><span class="cls_007">can also be bought on exchanges; indeed, selling tokens is a common way to finance dapp</span></div>
<div style="position:absolute;left:90.00px;top:656.64px" class="cls_007"><span class="cls_007">development. Finally, tokens are also used as a form of payment for the services or contents</span></div>
<div style="position:absolute;left:90.00px;top:670.19px" class="cls_007"><span class="cls_007">a dapp offers. Smart contracts running on today’s blockchain platforms, including all the</span></div>
<div style="position:absolute;left:102.44px;top:691.07px" class="cls_008"><span class="cls_008"><sup>∗</sup></span><A HREF="https://dfinity.org/foundation/">https://dfinity.org/foundation/</A> </span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">1</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:802px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background02.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">popular ones (such as Ethereum), suffer from many limitations, such as high transaction and</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">storage costs, slow computational speed, and the inability to serve frontends to users. As</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">a result, many popular blockchain applications are not fully decentralized but are hybrids</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">where most of the application is hosted on traditional cloud platforms and call out to smart</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">contracts on a blockchain for a small part of their overall functionality. Unfortunately, this</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">renders such applications non-decentralized, and opens them to many of the drawbacks of</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">traditional cloud-hosted applications, such as being at the mercy of cloud providers, and</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">being vulnerable to many single points of failure.</span></div>
<div style="position:absolute;left:106.94px;top:204.42px" class="cls_007"><span class="cls_007">The Internet Computer (IC) is a new platform for executing smart contracts.</span></div>
<div style="position:absolute;left:90.00px;top:217.97px" class="cls_007"><span class="cls_007">Here, we use the term “smart contract” in a very broad sense:  a general-purpose, im-</span></div>
<div style="position:absolute;left:90.00px;top:231.52px" class="cls_007"><span class="cls_007">mutable, tamperproof computer program whose execution is performed autonomously on a</span></div>
<div style="position:absolute;left:90.00px;top:245.07px" class="cls_007"><span class="cls_007">decentralized public network.</span></div>
<div style="position:absolute;left:106.39px;top:267.58px" class="cls_007"><span class="cls_007">• By general purpose, we mean that the class of smart contract programs is Turing</span></div>
<div style="position:absolute;left:117.27px;top:281.13px" class="cls_007"><span class="cls_007">complete (i.e., anything computable can be computed by a smart contract).</span></div>
<div style="position:absolute;left:106.39px;top:303.65px" class="cls_007"><span class="cls_007">• By immutable, we mean that, once deployed, the code of a smart contract cannot be</span></div>
<div style="position:absolute;left:117.27px;top:316.18px" class="cls_007"><span class="cls_007">changed by a party unilaterally.</span><span class="cls_004"><sup>1</sup></span></div>
<div style="position:absolute;left:106.39px;top:339.71px" class="cls_007"><span class="cls_007">• By tamperproof, we mean that the instructions of the program are carried out faithfully</span></div>
<div style="position:absolute;left:117.27px;top:353.26px" class="cls_007"><span class="cls_007">and that intermediate and final results are accurately stored and/or transmitted.</span></div>
<div style="position:absolute;left:106.39px;top:375.78px" class="cls_007"><span class="cls_007">• By autonomous, we mean that a smart contract is executed automatically by the</span></div>
<div style="position:absolute;left:117.27px;top:389.33px" class="cls_007"><span class="cls_007">network, without the need for any action on the part of any individual.</span></div>
<div style="position:absolute;left:106.39px;top:411.84px" class="cls_007"><span class="cls_007">• By a decentralized public network, we mean of network of computers that is publicly</span></div>
<div style="position:absolute;left:117.27px;top:425.39px" class="cls_007"><span class="cls_007">accessible, geographically distributed, and not under the control of a small number of</span></div>
<div style="position:absolute;left:117.27px;top:438.94px" class="cls_007"><span class="cls_007">individuals or organizations.</span></div>
<div style="position:absolute;left:90.00px;top:461.46px" class="cls_007"><span class="cls_007">In addition, smart contracts</span></div>
<div style="position:absolute;left:106.39px;top:483.97px" class="cls_007"><span class="cls_007">• are composable, meaning that they may interact with one another, and</span></div>
<div style="position:absolute;left:106.39px;top:506.49px" class="cls_007"><span class="cls_007">• support tokenization, meaning that they may use and trade digital tokens.</span></div>
<div style="position:absolute;left:106.94px;top:531.99px" class="cls_007"><span class="cls_007">Compared to existing smart contract platforms, the IC is designed to:</span></div>
<div style="position:absolute;left:106.39px;top:554.51px" class="cls_007"><span class="cls_007">• be more cost effective, in particular, allowing applications to compute and store data</span></div>
<div style="position:absolute;left:117.27px;top:568.06px" class="cls_007"><span class="cls_007">at a fraction of the cost of previous platforms;</span></div>
<div style="position:absolute;left:106.39px;top:590.57px" class="cls_007"><span class="cls_007">• provide higher throughput and lower latency for processing smart contract transac-</span></div>
<div style="position:absolute;left:117.27px;top:604.12px" class="cls_007"><span class="cls_007">tions;</span></div>
<div style="position:absolute;left:106.39px;top:626.64px" class="cls_007"><span class="cls_007">• be more scalable, in particular, the IC can process unbounded volumes of smart con-</span></div>
<div style="position:absolute;left:117.27px;top:640.19px" class="cls_007"><span class="cls_007">tract data and computation natively because it can grow in capacity by adding more</span></div>
<div style="position:absolute;left:117.27px;top:653.74px" class="cls_007"><span class="cls_007">nodes to the network.</span></div>
<div style="position:absolute;left:102.44px;top:672.49px" class="cls_008"><span class="cls_008"><sup>1</sup></span><span class="cls_009">The IC allows a range of mutability policies for smart contracts, ranging from purely immutable to</span></div>
<div style="position:absolute;left:90.00px;top:684.27px" class="cls_009"><span class="cls_009">unilaterally upgradable, with other options in between.</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">2</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:1604px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background03.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">In addition to providing a smart contract platform, the IC is designed to act as a</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">complete technology stack, such that systems and services can be built that run entirely on</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">the IC. In particular, smart contracts on the IC can service HTTP requests created by end</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">users, so that smart contracts can directly serve interactive web experiences.  This means</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">that systems and services can be created without relying on corporate cloud hosting services</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">or private servers, thus providing all of the benefits of smart contracts in a true end-to-end</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">fashion.</span></div>
<div style="position:absolute;left:90.00px;top:200.16px" class="cls_007"><span class="cls_007">Realizing the vision of Web3.  For end-users, accessing IC-based services is largely</span></div>
<div style="position:absolute;left:90.00px;top:213.71px" class="cls_007"><span class="cls_007">transparent.  Their personal data is more secure than when accessing applications on a</span></div>
<div style="position:absolute;left:90.00px;top:227.26px" class="cls_007"><span class="cls_007">public or private cloud, but the experience of interacting with the application is the same.</span></div>
<div style="position:absolute;left:106.94px;top:240.81px" class="cls_007"><span class="cls_007">For the people creating and managing those IC-based services, however, the IC elimi-</span></div>
<div style="position:absolute;left:90.00px;top:254.36px" class="cls_007"><span class="cls_007">nates many of the costs, risks, and complexities associated with developing and deploying</span></div>
<div style="position:absolute;left:90.00px;top:267.90px" class="cls_007"><span class="cls_007">modern applications and microservices. For example, the IC platform provides an alterna-</span></div>
<div style="position:absolute;left:90.00px;top:281.45px" class="cls_007"><span class="cls_007">tive to the consolidation driven by large technology companies that are monopolizing the</span></div>
<div style="position:absolute;left:90.00px;top:295.00px" class="cls_007"><span class="cls_007">Internet. In addition, its secure protocol guarantees reliable message delivery, transparent</span></div>
<div style="position:absolute;left:90.00px;top:308.55px" class="cls_007"><span class="cls_007">accountability, and resilience without relying on firewalls, backup facilities, load balancing</span></div>
<div style="position:absolute;left:90.00px;top:322.10px" class="cls_007"><span class="cls_007">services, or failover orchestration.</span></div>
<div style="position:absolute;left:106.94px;top:335.65px" class="cls_007"><span class="cls_007">Building the IC is about restoring the Internet to its open, innovative, and creative roots</span></div>
<div style="position:absolute;left:90.00px;top:349.20px" class="cls_007"><span class="cls_007">— in other words, to realize the vision of Web3. To focus on a few specific examples, the</span></div>
<div style="position:absolute;left:90.00px;top:362.75px" class="cls_007"><span class="cls_007">IC does the following:</span></div>
<div style="position:absolute;left:106.39px;top:388.25px" class="cls_007"><span class="cls_007">• Supports interoperability, shared functions, permanent APIs, and ownerless applica-</span></div>
<div style="position:absolute;left:117.27px;top:401.80px" class="cls_007"><span class="cls_007">tions, all of which reduce platform risk and encourages innovation and collaboration.</span></div>
<div style="position:absolute;left:106.39px;top:424.32px" class="cls_007"><span class="cls_007">• Persists data automatically in memory, which eliminates the need for database servers</span></div>
<div style="position:absolute;left:117.27px;top:437.87px" class="cls_007"><span class="cls_007">and storage management, improves computational efficiency, and simplifies software</span></div>
<div style="position:absolute;left:117.27px;top:451.42px" class="cls_007"><span class="cls_007">development.</span></div>
<div style="position:absolute;left:106.39px;top:473.93px" class="cls_007"><span class="cls_007">• Simplifies the technology stack that IT organizations need to integrate and manage,</span></div>
<div style="position:absolute;left:117.27px;top:487.48px" class="cls_007"><span class="cls_007">which improves operational efficiency</span></div>
<div style="position:absolute;left:90.00px;top:515.65px" class="cls_003"><span class="cls_003">1.2</span></div>
<div style="position:absolute;left:120.64px;top:515.65px" class="cls_003"><span class="cls_003">High level view of the Internet Computer</span></div>
<div style="position:absolute;left:90.00px;top:537.29px" class="cls_007"><span class="cls_007">To a first approximation, the IC is a network of interacting replicated state machines.</span></div>
<div style="position:absolute;left:90.00px;top:550.84px" class="cls_007"><span class="cls_007">The notion of a replicated state machine is a fairly standard concept in distributed systems</span></div>
<div style="position:absolute;left:90.00px;top:564.39px" class="cls_007"><span class="cls_007">[Sch90], but we give a brief introduction here, beginning with the notion of a state machine.</span></div>
<div style="position:absolute;left:106.94px;top:577.94px" class="cls_007"><span class="cls_007">A state machine is a particular model of computation.  Such a machine maintains a</span></div>
<div style="position:absolute;left:90.00px;top:591.49px" class="cls_007"><span class="cls_007">state, which corresponds to main memory or other forms of data storage in an ordinary</span></div>
<div style="position:absolute;left:90.00px;top:605.03px" class="cls_007"><span class="cls_007">computer. Such a machine executes in discrete rounds: in each round, it takes an input,</span></div>
<div style="position:absolute;left:90.00px;top:618.58px" class="cls_007"><span class="cls_007">applies a state transition function to the input and the current state, obtaining an</span></div>
<div style="position:absolute;left:90.00px;top:632.13px" class="cls_007"><span class="cls_007">output and a new state. The new state becomes the current state in the next round.</span></div>
<div style="position:absolute;left:106.94px;top:645.68px" class="cls_007"><span class="cls_007">The state transition function of the IC is a universal function, meaning that some</span></div>
<div style="position:absolute;left:90.00px;top:659.23px" class="cls_007"><span class="cls_007">of the inputs and data stored in the state may be arbitrary programs which act on other</span></div>
<div style="position:absolute;left:90.00px;top:672.78px" class="cls_007"><span class="cls_007">inputs and data.  Thus, such a state machine represents a general (i.e., Turing complete)</span></div>
<div style="position:absolute;left:90.00px;top:686.33px" class="cls_007"><span class="cls_007">model of computation.</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">3</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:2406px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background04.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">To achieve fault tolerance, the state machine may be replicated.  A replicated state</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">machine comprises a subnet of replicas, each of which is running a copy of the same state</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">machine. A subnet should continue to function — and to function correctly — even if some</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">replicas are faulty.</span></div>
<div style="position:absolute;left:106.94px;top:144.25px" class="cls_007"><span class="cls_007">It is essential that each replica in a subnet processes the same inputs in the same order.</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">To achieve this, the replicas in a subnet must run a consensus protocol [Fis83], which</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">ensures that all replicas in a subnet process inputs in the same order. Therefore, the internal</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">state of each replica will evolve over time in exactly the same way, and each replica will</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">produce exactly the same sequence of outputs.  Note that an input to a replicated state</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">machine on the IC may be an input generated by an external user, or an output generated</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">by another replicated state machine. Similarly, an output of a replicated state machine may</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">be either an output directed to an external user, or an input to another replicated state</span></div>
<div style="position:absolute;left:90.00px;top:252.64px" class="cls_007"><span class="cls_007">machine.</span></div>
<div style="position:absolute;left:90.00px;top:280.81px" class="cls_003"><span class="cls_003">1.3</span></div>
<div style="position:absolute;left:120.64px;top:280.81px" class="cls_003"><span class="cls_003">Fault Models</span></div>
<div style="position:absolute;left:90.00px;top:302.45px" class="cls_007"><span class="cls_007">In this area of computer science, one typically considers two types of replica failures: crash</span></div>
<div style="position:absolute;left:90.00px;top:316.00px" class="cls_007"><span class="cls_007">faults and Byzantine faults. A crash fault occurs when a replica abruptly stops and does</span></div>
<div style="position:absolute;left:90.00px;top:329.55px" class="cls_007"><span class="cls_007">not resume. Byzantine faults are failures in which a replica may deviate in an arbitrary</span></div>
<div style="position:absolute;left:90.00px;top:343.09px" class="cls_007"><span class="cls_007">way from its prescribed protocol. Moreover, with Byzantine faults, one or possibly several</span></div>
<div style="position:absolute;left:90.00px;top:356.64px" class="cls_007"><span class="cls_007">replicas may be directly under the control of a malicious adversary who may coordinate the</span></div>
<div style="position:absolute;left:90.00px;top:370.19px" class="cls_007"><span class="cls_007">behavior of these replicas. Of the two types of faults, Byzantine faults are potentially far</span></div>
<div style="position:absolute;left:90.00px;top:383.74px" class="cls_007"><span class="cls_007">more disruptive.</span></div>
<div style="position:absolute;left:106.94px;top:397.29px" class="cls_007"><span class="cls_007">Protocols for consensus and for realizing replicated state machines typically make as-</span></div>
<div style="position:absolute;left:90.00px;top:410.84px" class="cls_007"><span class="cls_007">sumptions about how many replicas may be faulty and to to what degree (crash or</span></div>
<div style="position:absolute;left:90.00px;top:424.39px" class="cls_007"><span class="cls_007">Byzantine) they may be faulty. In the IC, the assumption is that if a given subnet has n</span></div>
<div style="position:absolute;left:90.00px;top:437.94px" class="cls_007"><span class="cls_007">replicas, then less than n/3 of these replicas are faulty and these faults may be Byzantine.</span></div>
<div style="position:absolute;left:90.00px;top:451.49px" class="cls_007"><span class="cls_007">(Note that the different subnets in the IC may have different sizes.)</span></div>
<div style="position:absolute;left:90.00px;top:479.66px" class="cls_003"><span class="cls_003">1.4</span></div>
<div style="position:absolute;left:120.64px;top:479.66px" class="cls_003"><span class="cls_003">Communication Models</span></div>
<div style="position:absolute;left:90.00px;top:501.30px" class="cls_007"><span class="cls_007">Protocols for consensus and for implementing replicated state machines also typically make</span></div>
<div style="position:absolute;left:90.00px;top:514.84px" class="cls_007"><span class="cls_007">assumptions about the communication model, which characterizes the ability of an ad-</span></div>
<div style="position:absolute;left:90.00px;top:528.39px" class="cls_007"><span class="cls_007">versary to delay the delivery of messages between replicas. At opposite ends of the spectrum,</span></div>
<div style="position:absolute;left:90.00px;top:541.94px" class="cls_007"><span class="cls_007">we have the following models:</span></div>
<div style="position:absolute;left:106.39px;top:567.45px" class="cls_007"><span class="cls_007">• In the synchronous model, there exists some known finite time bound δ, such that</span></div>
<div style="position:absolute;left:117.27px;top:581.00px" class="cls_007"><span class="cls_007">for any message sent, it will be delivered in less than time δ.</span></div>
<div style="position:absolute;left:106.39px;top:603.51px" class="cls_007"><span class="cls_007">• In the asynchronous model, for any message sent, the adversary can delay its</span></div>
<div style="position:absolute;left:117.27px;top:617.06px" class="cls_007"><span class="cls_007">delivery by any finite amount of time, so that there is no bound on the time to deliver</span></div>
<div style="position:absolute;left:117.27px;top:630.61px" class="cls_007"><span class="cls_007">a message; however, each message must eventually be delivered.</span></div>
<div style="position:absolute;left:106.94px;top:656.12px" class="cls_007"><span class="cls_007">Since the replicas in an IC-subnet are typically distributed around the globe, the syn-</span></div>
<div style="position:absolute;left:90.00px;top:669.66px" class="cls_007"><span class="cls_007">chronous communication model would be highly unrealistic.  Indeed, an attacker could</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">4</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:3208px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background05.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">compromise the correct behavior of the protocol by delaying honest replicas or the commu-</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">nication between them.  Such an attack is generally easier to mount than gaining control</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">over and corrupting an honest replica.</span></div>
<div style="position:absolute;left:106.94px;top:130.70px" class="cls_007"><span class="cls_007">In the setting of a globally distributed subnet, the most realistic and robust model is the</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">asynchronous model. Unfortunately, there are no known consensus protocols in this model</span></div>
<div style="position:absolute;left:90.00px;top:156.78px" class="cls_007"><span class="cls_007">that are truly practical (more recent asynchronous consensus protocols, as in [MXC</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">16],</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">attain reasonable throughput, but not very good latency).  So like most other practical</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">Byzantine fault tolerant systems that do not rely on synchronous communication (e.g.,</span></div>
<div style="position:absolute;left:90.00px;top:197.42px" class="cls_007"><span class="cls_007">PBFT [CL99, BKM18, AMN</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">20]), the IC opts for a compromise: a partial synchrony</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">communication model [DLS88]. Such partial synchrony models can be formulated in various</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">ways. The partial synchrony assumption used by the IC says, roughly speaking, that for each</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">subnet, communication among replicas in that subnet is periodically synchronous for short</span></div>
<div style="position:absolute;left:90.00px;top:252.64px" class="cls_007"><span class="cls_007">intervals of time; moreover, the synchrony bound δ does not need to be known in advance.</span></div>
<div style="position:absolute;left:90.00px;top:266.19px" class="cls_007"><span class="cls_007">This partial synchrony assumption is only needed to ensure that the consensus protocol</span></div>
<div style="position:absolute;left:90.00px;top:279.74px" class="cls_007"><span class="cls_007">makes progress (the so-called liveness property).  The partial synchrony assumption (nor,</span></div>
<div style="position:absolute;left:90.00px;top:293.29px" class="cls_007"><span class="cls_007">for that matter, the eventual delivery assumption) is not needed to ensure correct behavior</span></div>
<div style="position:absolute;left:90.00px;top:306.84px" class="cls_007"><span class="cls_007">of consensus (the so-called safety property), nor is it needed anywhere else in the IC protocol</span></div>
<div style="position:absolute;left:90.00px;top:320.39px" class="cls_007"><span class="cls_007">stack.</span></div>
<div style="position:absolute;left:106.94px;top:333.93px" class="cls_007"><span class="cls_007">Under the assumption of partial synchrony and Byzantine faults, it is known that our</span></div>
<div style="position:absolute;left:90.00px;top:347.48px" class="cls_007"><span class="cls_007">bound of f &lt; n/3 on the number of faults is optimal.</span></div>
<div style="position:absolute;left:90.00px;top:375.65px" class="cls_003"><span class="cls_003">1.5</span></div>
<div style="position:absolute;left:120.64px;top:375.65px" class="cls_003"><span class="cls_003">Permission Models</span></div>
<div style="position:absolute;left:90.00px;top:397.29px" class="cls_007"><span class="cls_007">The earliest protocols for consensus (e.g., PBFT [CL99]) were permissioned, in the sense</span></div>
<div style="position:absolute;left:90.00px;top:410.84px" class="cls_007"><span class="cls_007">that the replicas comprising a replicated state machine are governed by a centralized or-</span></div>
<div style="position:absolute;left:90.00px;top:424.39px" class="cls_007"><span class="cls_007">ganization, which determines which entities provide replicas, the topology of the network,</span></div>
<div style="position:absolute;left:90.00px;top:437.94px" class="cls_007"><span class="cls_007">and possibly also implements some kind of centralized public-key infrastructure.  Permis-</span></div>
<div style="position:absolute;left:90.00px;top:451.49px" class="cls_007"><span class="cls_007">sioned consensus protocols are typically the most efficient, and while they do avoid a single</span></div>
<div style="position:absolute;left:90.00px;top:465.04px" class="cls_007"><span class="cls_007">point of failure, the centralized governance is undesirable for certain applications, and it is</span></div>
<div style="position:absolute;left:90.00px;top:478.59px" class="cls_007"><span class="cls_007">antithetical to the spirit of the burgeoning Web3 era.</span></div>
<div style="position:absolute;left:106.94px;top:492.14px" class="cls_007"><span class="cls_007">More recently, we have seen the rise of permissionless consensus protocols, such as</span></div>
<div style="position:absolute;left:90.00px;top:504.67px" class="cls_007"><span class="cls_007">Bitcoin [Nak08], Ethereum [But13], and Algorand [GHM</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">17].  Such protocols such are</span></div>
<div style="position:absolute;left:90.00px;top:519.23px" class="cls_007"><span class="cls_007">based on a blockchain and either a proof of work (PoW) (e.g., Bitcoin, Ethereum prior</span></div>
<div style="position:absolute;left:90.00px;top:532.78px" class="cls_007"><span class="cls_007">to v2.0) or a proof of stake (PoS) (e.g., Algorand, Ethereum v2.0) . While such protocols</span></div>
<div style="position:absolute;left:90.00px;top:546.33px" class="cls_007"><span class="cls_007">are completely decentralized, they are much less efficient than permissioned protocols. We</span></div>
<div style="position:absolute;left:90.00px;top:559.88px" class="cls_007"><span class="cls_007">also point out that, as observed in [PSS17], PoW-based consensus protocols such as Bitcoin</span></div>
<div style="position:absolute;left:90.00px;top:573.43px" class="cls_007"><span class="cls_007">cannot guarantee correctness (i.e., safety) in an asynchronous communication network.</span></div>
<div style="position:absolute;left:106.94px;top:586.98px" class="cls_007"><span class="cls_007">The IC’s permission model is a hybrid model, obtaining the efficiency of a permissioned</span></div>
<div style="position:absolute;left:90.00px;top:600.53px" class="cls_007"><span class="cls_007">protocol while offering many of the benefits of a decentralized PoS protocol.  This hybrid</span></div>
<div style="position:absolute;left:90.00px;top:614.08px" class="cls_007"><span class="cls_007">model is called a DAO-controlled network and (roughly speaking) works as follows:</span></div>
<div style="position:absolute;left:90.00px;top:627.63px" class="cls_007"><span class="cls_007">each subnet runs a permissioned consensus protocol, but a decentralized autonomous</span></div>
<div style="position:absolute;left:90.00px;top:641.18px" class="cls_007"><span class="cls_007">organization (DAO) determines which entities provide replicas, configures the topology of</span></div>
<div style="position:absolute;left:90.00px;top:654.73px" class="cls_007"><span class="cls_007">the network, provides a public-key infrastructure, and controls which version of the protocol</span></div>
<div style="position:absolute;left:90.00px;top:668.28px" class="cls_007"><span class="cls_007">is deployed to the replicas. The IC’s DAO is called the network nervous system (NNS),</span></div>
<div style="position:absolute;left:90.00px;top:681.82px" class="cls_007"><span class="cls_007">and is based on a PoS, so that all decisions taken by the NNS are made by community</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">5</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:4010px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background06.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">members whose voting power is determined by how much of the IC’s native governance</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">token they have staked in the NNS (see Section 1.8 for more in this token). Through this</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">PoS-based governance system, new subnets can be created, replicas may be added to or</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">removed from existing subnets, software updates may be deployed, and other modifications</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">to the IC may be effected.  The NNS is itself a replicated state machine, which (like any</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">other) runs on a particular subnet whose membership is determined via the same PoS-based</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">governance system. The NNS maintains a database called the registry, which keeps track</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">of the topology of the IC: which replicas belong to which subnets, the public keys of the</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">replicas, and so on. (See Section 1.10 for a few more details on the NNS.)</span></div>
<div style="position:absolute;left:106.94px;top:211.99px" class="cls_007"><span class="cls_007">Thus, one sees that the IC’s DAO-controlled network allows the IC to achieve many of</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">the practical benefits of a permissioned network (in terms of more efficient consensus), while</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">maintaining many of the benefits of a decentralized network (with governance controlled by</span></div>
<div style="position:absolute;left:90.00px;top:252.64px" class="cls_007"><span class="cls_007">a DAO).</span></div>
<div style="position:absolute;left:106.94px;top:266.19px" class="cls_007"><span class="cls_007">The replicas running the IC protocol are hosted on servers in geographically distributed,</span></div>
<div style="position:absolute;left:90.00px;top:279.74px" class="cls_007"><span class="cls_007">independently operated data centers.  This also bolsters the security and decentralized</span></div>
<div style="position:absolute;left:90.00px;top:293.29px" class="cls_007"><span class="cls_007">nature of the IC.</span></div>
<div style="position:absolute;left:90.00px;top:321.45px" class="cls_003"><span class="cls_003">1.6</span></div>
<div style="position:absolute;left:120.64px;top:321.45px" class="cls_003"><span class="cls_003">Chain-key cryptography</span></div>
<div style="position:absolute;left:90.00px;top:343.09px" class="cls_007"><span class="cls_007">The IC’s consensus protocol does, in fact, use a blockchain, but it also uses public-key</span></div>
<div style="position:absolute;left:90.00px;top:356.64px" class="cls_007"><span class="cls_007">cryptography, specifically, digital signatures:  the registry maintained by the NNS is used</span></div>
<div style="position:absolute;left:90.00px;top:370.19px" class="cls_007"><span class="cls_007">to bind public keys to replicas and subnets as a whole.  This enables a unique and pow-</span></div>
<div style="position:absolute;left:90.00px;top:383.74px" class="cls_007"><span class="cls_007">erful collection of technologies that we call chain-key cryptography, which has several</span></div>
<div style="position:absolute;left:90.00px;top:397.29px" class="cls_007"><span class="cls_007">components.</span></div>
<div style="position:absolute;left:90.00px;top:426.11px" class="cls_007"><span class="cls_007">1.6.1</span></div>
<div style="position:absolute;left:128.33px;top:426.11px" class="cls_007"><span class="cls_007">Threshold signatures</span></div>
<div style="position:absolute;left:90.00px;top:446.70px" class="cls_007"><span class="cls_007">The first component of chain-key cryptography is threshold signatures: this is a well es-</span></div>
<div style="position:absolute;left:90.00px;top:460.25px" class="cls_007"><span class="cls_007">tablished cryptographic technique that allows a subnet to have a public signature-verification</span></div>
<div style="position:absolute;left:90.00px;top:473.80px" class="cls_007"><span class="cls_007">key whose corresponding secret signing key is split into shares, which are distributed among</span></div>
<div style="position:absolute;left:90.00px;top:487.35px" class="cls_007"><span class="cls_007">all of the replicas in a subnet in such a way that the shares held by the corrupt replicas</span></div>
<div style="position:absolute;left:90.00px;top:500.90px" class="cls_007"><span class="cls_007">do not let them forge any signatures, while the shares held by the honest replicas allow the</span></div>
<div style="position:absolute;left:90.00px;top:514.45px" class="cls_007"><span class="cls_007">subnet to generate signatures consistent with the policies and protocols of the IC.</span></div>
<div style="position:absolute;left:106.94px;top:528.00px" class="cls_007"><span class="cls_007">One critical application of these threshold signatures is that</span></div>
<div style="position:absolute;left:117.27px;top:550.51px" class="cls_007"><span class="cls_007">an individual output of one subnet may be verified by another subnet or external</span></div>
<div style="position:absolute;left:117.27px;top:564.06px" class="cls_007"><span class="cls_007">user by simply validating a digital signature with respect to the public signature-</span></div>
<div style="position:absolute;left:117.27px;top:577.61px" class="cls_007"><span class="cls_007">verification key of the (first) subnet.</span></div>
<div style="position:absolute;left:90.00px;top:600.13px" class="cls_007"><span class="cls_007">Note that the public signature-verification key for a subnet may be obtained from the NNS</span></div>
<div style="position:absolute;left:90.00px;top:613.67px" class="cls_007"><span class="cls_007">— this public signature-verification key remains constant over the lifetime of a subnet (even</span></div>
<div style="position:absolute;left:90.00px;top:627.22px" class="cls_007"><span class="cls_007">as the membership of a subnet may change over that lifetime). This stands in contrast to</span></div>
<div style="position:absolute;left:90.00px;top:640.77px" class="cls_007"><span class="cls_007">many non-scalable blockchain-based protocols, which require the entire blockchain to be</span></div>
<div style="position:absolute;left:90.00px;top:654.32px" class="cls_007"><span class="cls_007">validated in order to validate any single output.</span></div>
<div style="position:absolute;left:106.94px;top:667.87px" class="cls_007"><span class="cls_007">As we will see, these threshold signatures have a number of other applications within</span></div>
<div style="position:absolute;left:90.00px;top:681.42px" class="cls_007"><span class="cls_007">the IC. One such application is to give each replica in a subnet access to unpredictable</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">6</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:4812px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background07.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">pseudorandom bits (derived from such signatures).  This is the basis for the Random</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">Beacon used in consensus and the Random Tape used in execution.</span></div>
<div style="position:absolute;left:106.94px;top:117.15px" class="cls_007"><span class="cls_007">In order to securely deploy threshold signatures, the IC uses an innovative distributed</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">key generation (DKG) protocol that constructs a public signature-verification key and</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">provisions each replica with a share of the corresponding secret signing key, and works</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">within our fault and communication model.</span></div>
<div style="position:absolute;left:90.00px;top:186.61px" class="cls_007"><span class="cls_007">1.6.2</span></div>
<div style="position:absolute;left:128.33px;top:186.61px" class="cls_007"><span class="cls_007">Chain-evolution technology</span></div>
<div style="position:absolute;left:90.00px;top:207.20px" class="cls_007"><span class="cls_007">Chain-key cryptography also includes a sophisticated collection of technologies for robustly</span></div>
<div style="position:absolute;left:90.00px;top:220.75px" class="cls_007"><span class="cls_007">and securely maintaining a blockchain based replicated state machine over time, which</span></div>
<div style="position:absolute;left:90.00px;top:234.30px" class="cls_007"><span class="cls_007">together form what we call chain-evolution technology. Each subnet operates in epochs</span></div>
<div style="position:absolute;left:90.00px;top:247.85px" class="cls_007"><span class="cls_007">of many rounds (typically on the order of a few hundreds of rounds).  Using threshold</span></div>
<div style="position:absolute;left:90.00px;top:261.40px" class="cls_007"><span class="cls_007">signatures and a number of other techniques, chain-evolution technology implements many</span></div>
<div style="position:absolute;left:90.00px;top:274.95px" class="cls_007"><span class="cls_007">essential maintenance activities that are executed periodically with a cadence that is tied</span></div>
<div style="position:absolute;left:90.00px;top:288.50px" class="cls_007"><span class="cls_007">to epochs:</span></div>
<div style="position:absolute;left:90.00px;top:311.02px" class="cls_007"><span class="cls_007">Garbage collection: At the end of each epoch, all inputs that have been processed, and all</span></div>
<div style="position:absolute;left:117.27px;top:324.56px" class="cls_007"><span class="cls_007">consensus-level protocol messages needed to order those inputs, may safely be purged</span></div>
<div style="position:absolute;left:117.27px;top:338.11px" class="cls_007"><span class="cls_007">from the memory of each replica. This is essential in keeping the storage requirements</span></div>
<div style="position:absolute;left:117.27px;top:351.66px" class="cls_007"><span class="cls_007">for the replicas from growing without bound. This is in contrast to many non-scalable</span></div>
<div style="position:absolute;left:117.27px;top:365.21px" class="cls_007"><span class="cls_007">blockchain-based protocols, where the entire blockchain from the genesis block must</span></div>
<div style="position:absolute;left:117.27px;top:378.76px" class="cls_007"><span class="cls_007">be stored.</span></div>
<div style="position:absolute;left:90.00px;top:401.28px" class="cls_007"><span class="cls_007">Fast forwarding: If a replica in a subnet falls very far behind its peers (because it is</span></div>
<div style="position:absolute;left:117.27px;top:414.83px" class="cls_007"><span class="cls_007">down or disconnected from the network for a long time), or a new replica is added to</span></div>
<div style="position:absolute;left:117.27px;top:428.37px" class="cls_007"><span class="cls_007">a subnet, it can be fast forwarded to the beginning of the most recent epoch, without</span></div>
<div style="position:absolute;left:117.27px;top:441.92px" class="cls_007"><span class="cls_007">having to run the consensus protocol and process all of the inputs up to that point.</span></div>
<div style="position:absolute;left:117.27px;top:455.47px" class="cls_007"><span class="cls_007">This is in contrast to many non-scalable blockchain-based protocols, where the entire</span></div>
<div style="position:absolute;left:117.27px;top:469.02px" class="cls_007"><span class="cls_007">blockchain from the genesis block must be processed.</span></div>
<div style="position:absolute;left:90.00px;top:491.54px" class="cls_007"><span class="cls_007">Subnet membership changes: The membership of the subnet (as determined by the</span></div>
<div style="position:absolute;left:117.27px;top:505.09px" class="cls_007"><span class="cls_007">NNS, see Section 1.5) may change over time.  This can only happen at an epoch</span></div>
<div style="position:absolute;left:117.27px;top:518.64px" class="cls_007"><span class="cls_007">boundary, and needs to be done with care to ensure consistent and correct behavior.</span></div>
<div style="position:absolute;left:90.00px;top:541.15px" class="cls_007"><span class="cls_007">Pro-active resharing of secrets: We mentioned above in Section 1.6.1 how the IC uses</span></div>
<div style="position:absolute;left:117.27px;top:554.70px" class="cls_007"><span class="cls_007">chain-key cryptography — specifically, threshold signatures — for output verification.</span></div>
<div style="position:absolute;left:117.27px;top:568.25px" class="cls_007"><span class="cls_007">This is based on secret sharing, which avoids any single point of failure by splitting</span></div>
<div style="position:absolute;left:117.27px;top:581.80px" class="cls_007"><span class="cls_007">up a secret (in this case, a secret signing key) into shares that are stored among the</span></div>
<div style="position:absolute;left:117.27px;top:595.35px" class="cls_007"><span class="cls_007">replicas.  At the beginning of each epoch, these shares are pro-actively reshared.</span></div>
<div style="position:absolute;left:117.27px;top:608.90px" class="cls_007"><span class="cls_007">This achieves two goals:</span></div>
<div style="position:absolute;left:130.40px;top:631.41px" class="cls_007"><span class="cls_007">• When the membership of a subnet changes, the resharing will ensure that any</span></div>
<div style="position:absolute;left:141.27px;top:644.96px" class="cls_007"><span class="cls_007">new members have an appropriate share of the secret, while any replicas that</span></div>
<div style="position:absolute;left:141.27px;top:658.51px" class="cls_007"><span class="cls_007">are no longer members no longer have a share of the secret.</span></div>
<div style="position:absolute;left:130.40px;top:676.05px" class="cls_007"><span class="cls_007">• If a small number of shares are leaked to an attacker in any one epoch, or even</span></div>
<div style="position:absolute;left:141.27px;top:689.60px" class="cls_007"><span class="cls_007">in every epoch, those shares will not do an attacker any good.</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">7</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:5614px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background08.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">Protocol upgrades: When the IC protocol itself needs to be upgraded, to fix bugs or add</span></div>
<div style="position:absolute;left:117.27px;top:103.60px" class="cls_007"><span class="cls_007">new features, this can be done automatically using a special protocol at the beginning</span></div>
<div style="position:absolute;left:117.27px;top:117.15px" class="cls_007"><span class="cls_007">of an epoch.</span></div>
<div style="position:absolute;left:90.00px;top:145.31px" class="cls_003"><span class="cls_003">1.7</span></div>
<div style="position:absolute;left:120.64px;top:145.31px" class="cls_003"><span class="cls_003">Execution Models</span></div>
<div style="position:absolute;left:90.00px;top:166.96px" class="cls_007"><span class="cls_007">As already mentioned, replicated state machines in the IC can execute arbitrary programs.</span></div>
<div style="position:absolute;left:90.00px;top:180.50px" class="cls_007"><span class="cls_007">The basic computational unit in the IC is called a canister, which is roughly the same as</span></div>
<div style="position:absolute;left:90.00px;top:194.05px" class="cls_007"><span class="cls_007">the notion of a process, in that it comprises both a program and its state (which changes</span></div>
<div style="position:absolute;left:90.00px;top:207.60px" class="cls_007"><span class="cls_007">over time).</span></div>
<div style="position:absolute;left:106.94px;top:221.15px" class="cls_007"><span class="cls_007">Canister programs are encoded in WebAssembly, or Wasm for short, which is a binary</span></div>
<div style="position:absolute;left:90.00px;top:233.68px" class="cls_007"><span class="cls_007">instruction format for a stack-based virtual machine. Wasm is an open standard.</span><span class="cls_004"><sup>2</sup></span><span class="cls_007">  While it</span></div>
<div style="position:absolute;left:90.00px;top:248.25px" class="cls_007"><span class="cls_007">was initially designed to enable high-performance applications on web pages, it is actually</span></div>
<div style="position:absolute;left:90.00px;top:261.80px" class="cls_007"><span class="cls_007">very well suited to general-purpose computation.</span></div>
<div style="position:absolute;left:106.94px;top:275.35px" class="cls_007"><span class="cls_007">The IC provides a run-time environment for executing Wasm programs in a canister, and</span></div>
<div style="position:absolute;left:90.00px;top:288.90px" class="cls_007"><span class="cls_007">to communicate with other canisters and external users (via message passing).  While, in</span></div>
<div style="position:absolute;left:90.00px;top:302.45px" class="cls_007"><span class="cls_007">principle, one can write a canister program in any language that may be compiled to Wasm,</span></div>
<div style="position:absolute;left:90.00px;top:316.00px" class="cls_007"><span class="cls_007">a language called Motoko has been designed that is well aligned with the operational se-</span></div>
<div style="position:absolute;left:90.00px;top:328.53px" class="cls_007"><span class="cls_007">mantics of the IC. Motoko is a strongly typed, actor-based</span><span class="cls_004"><sup>3</sup></span><span class="cls_007">  programming language with</span></div>
<div style="position:absolute;left:90.00px;top:342.07px" class="cls_007"><span class="cls_007">built-in support for orthogonal persistence</span><span class="cls_004"><sup>4</sup></span><span class="cls_007">  and asynchronous message passing.  Orthogo-</span></div>
<div style="position:absolute;left:90.00px;top:356.64px" class="cls_007"><span class="cls_007">nal persistence simply means that all memory maintained by a canister is automatically</span></div>
<div style="position:absolute;left:90.00px;top:370.19px" class="cls_007"><span class="cls_007">persisted (i.e., it does not have to be written to a file). Motoko has a number of productiv-</span></div>
<div style="position:absolute;left:90.00px;top:383.74px" class="cls_007"><span class="cls_007">ity and safety features, including automatic memory management, generics, type inference,</span></div>
<div style="position:absolute;left:90.00px;top:397.29px" class="cls_007"><span class="cls_007">pattern matching, and both arbitrary and fixed-precision arithmetic.</span></div>
<div style="position:absolute;left:106.94px;top:410.84px" class="cls_007"><span class="cls_007">In addition to Motoko, the IC also provides a messaging interface definition language</span></div>
<div style="position:absolute;left:90.00px;top:424.39px" class="cls_007"><span class="cls_007">and wire format called Candid, for typed, high-level, and cross-language interoperability.</span></div>
<div style="position:absolute;left:90.00px;top:437.94px" class="cls_007"><span class="cls_007">This allows any two canisters, even if written in different high-level languages, to easily</span></div>
<div style="position:absolute;left:90.00px;top:451.49px" class="cls_007"><span class="cls_007">communicate with one another.</span></div>
<div style="position:absolute;left:106.94px;top:465.04px" class="cls_007"><span class="cls_007">To fully support canister development in any given programming language, besides a</span></div>
<div style="position:absolute;left:90.00px;top:478.59px" class="cls_007"><span class="cls_007">Wasm compiler for that language, certain run-time support must also be provided. At the</span></div>
<div style="position:absolute;left:90.00px;top:492.14px" class="cls_007"><span class="cls_007">present time, in addition to Motoko, the IC also fully supports canister development in the</span></div>
<div style="position:absolute;left:90.00px;top:505.68px" class="cls_007"><span class="cls_007">Rust programming language.</span></div>
<div style="position:absolute;left:90.00px;top:533.85px" class="cls_003"><span class="cls_003">1.8</span></div>
<div style="position:absolute;left:120.64px;top:533.85px" class="cls_003"><span class="cls_003">Utility token</span></div>
<div style="position:absolute;left:90.00px;top:555.49px" class="cls_007"><span class="cls_007">The IC makes use of a utility token called ICP. This token is used for the following</span></div>
<div style="position:absolute;left:90.00px;top:569.04px" class="cls_007"><span class="cls_007">functions:</span></div>
<div style="position:absolute;left:90.00px;top:594.55px" class="cls_007"><span class="cls_007">Staking in the NNS: As already discussed in Section 1.5, ICP tokens may be staked in</span></div>
<div style="position:absolute;left:117.27px;top:608.10px" class="cls_007"><span class="cls_007">the NNS to acquire voting rights so as to participate in the DAO that controls the</span></div>
<div style="position:absolute;left:117.27px;top:621.64px" class="cls_007"><span class="cls_007">IC network.  Users that have ICP tokens staked in the NNS and who participate in</span></div>
<div style="position:absolute;left:102.44px;top:642.52px" class="cls_008"><span class="cls_008"><sup>2</sup></span><span class="cls_009">See <A HREF="https://webassembly.org/">https://webassembly.org/</A>.</span></div>
<div style="position:absolute;left:102.44px;top:653.48px" class="cls_008"><span class="cls_008"><sup>3</sup></span><span class="cls_009">See <A HREF="https://en.wikipedia.org/wiki/Actor_model">https://en.wikipedia.org/wiki/Actor_model</A>.</span></div>
<div style="position:absolute;left:102.44px;top:664.44px" class="cls_008"><span class="cls_008"><sup>4</sup></span><span class="cls_009">See</span></div>
<div style="position:absolute;left:168.95px;top:665.26px" class="cls_009"><span class="cls_009"> </span><A HREF="https://en.wikipedia.org/wiki/Persistence_(computer_science)#Orthogonal_or_transparent_persistence">https://en.wikipedia.org/wiki/Persistence_(computer_science)#Orthogonal_or_</A> </div>
<div style="position:absolute;left:90.00px;top:676.22px" class="cls_009"><span class="cls_009"> </span><A HREF="https://en.wikipedia.org/wiki/Persistence_(computer_science)#Orthogonal_or_transparent_persistence">transparent_persistence</A>.</div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">8</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:6416px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background09.jpg" width=612 height=792></div>
<div style="position:absolute;left:117.27px;top:90.05px" class="cls_007"><span class="cls_007">the NNS governance also receive newly minted ICP tokens as a voting reward.  The</span></div>
<div style="position:absolute;left:117.27px;top:103.60px" class="cls_007"><span class="cls_007">amount of the award is determined by policies established and enforced by the NNS.</span></div>
<div style="position:absolute;left:90.00px;top:126.11px" class="cls_007"><span class="cls_007">Conversion to Cycles: ICP is used to pay for the usage of the IC. More specifically, ICP</span></div>
<div style="position:absolute;left:117.27px;top:139.66px" class="cls_007"><span class="cls_007">tokens can be converted to cycles (i.e., burned), and these cycles are used to pay for</span></div>
<div style="position:absolute;left:117.27px;top:153.21px" class="cls_007"><span class="cls_007">creating canisters (see Section 1.7) and for the resources that canisters use (storage,</span></div>
<div style="position:absolute;left:117.27px;top:166.76px" class="cls_007"><span class="cls_007">CPU, and bandwidth).  The rate at which ICP is converted to cycles is determined</span></div>
<div style="position:absolute;left:117.27px;top:180.31px" class="cls_007"><span class="cls_007">by the NNS.</span></div>
<div style="position:absolute;left:90.00px;top:202.83px" class="cls_007"><span class="cls_007">Payment to Node Providers: ICP tokens are used to pay the node providers—these</span></div>
<div style="position:absolute;left:117.27px;top:216.38px" class="cls_007"><span class="cls_007">are the entities that own and operate the computing nodes that host the replicas that</span></div>
<div style="position:absolute;left:117.27px;top:229.92px" class="cls_007"><span class="cls_007">make up the IC. At regular intervals (currently monthly), the NNS decides on the</span></div>
<div style="position:absolute;left:117.27px;top:243.47px" class="cls_007"><span class="cls_007">number of newly minted tokens that each node provider should receive, and sends the</span></div>
<div style="position:absolute;left:117.27px;top:257.02px" class="cls_007"><span class="cls_007">tokens to the node provider’s account. Payment of tokens is conditioned on providing</span></div>
<div style="position:absolute;left:117.27px;top:270.57px" class="cls_007"><span class="cls_007">reliable service to the IC, according to specific policies established and enforced by</span></div>
<div style="position:absolute;left:117.27px;top:284.12px" class="cls_007"><span class="cls_007">the NNS.</span></div>
<div style="position:absolute;left:90.00px;top:312.29px" class="cls_003"><span class="cls_003">1.9</span></div>
<div style="position:absolute;left:120.64px;top:312.29px" class="cls_003"><span class="cls_003">Boundary Nodes</span></div>
<div style="position:absolute;left:90.00px;top:333.93px" class="cls_007"><span class="cls_007">Boundary nodes provide the network edge services of the IC. In particular, they offer</span></div>
<div style="position:absolute;left:106.39px;top:356.44px" class="cls_007"><span class="cls_007">• clearly defined entry points to the IC,</span></div>
<div style="position:absolute;left:106.39px;top:378.96px" class="cls_007"><span class="cls_007">• denial of service protection for the IC,</span></div>
<div style="position:absolute;left:106.39px;top:401.48px" class="cls_007"><span class="cls_007">• seamless access to the IC from legacy clients (e.g., web browsers).</span></div>
<div style="position:absolute;left:90.00px;top:423.99px" class="cls_007"><span class="cls_007">To facilitate seamless access to the IC from a legacy client, boundary nodes provide func-</span></div>
<div style="position:absolute;left:90.00px;top:437.54px" class="cls_007"><span class="cls_007">tionality to translate a standard HTTPS request from a user to an ingress message directed</span></div>
<div style="position:absolute;left:90.00px;top:451.09px" class="cls_007"><span class="cls_007">toward a canister on the IC, and then route this ingress message to specific replicas on the</span></div>
<div style="position:absolute;left:90.00px;top:464.64px" class="cls_007"><span class="cls_007">subnet where this canister resides.  Furthermore, boundary nodes offer additional services</span></div>
<div style="position:absolute;left:90.00px;top:478.19px" class="cls_007"><span class="cls_007">to improve the user experience: caching, load balancing, rate limiting, and the ability for</span></div>
<div style="position:absolute;left:90.00px;top:491.74px" class="cls_007"><span class="cls_007">legacy clients to authenticate responses from the IC.</span></div>
<div style="position:absolute;left:106.94px;top:505.29px" class="cls_007"><span class="cls_007">A canister is identified by a URL on the ic0.app domain. Initially, a legacy client looks</span></div>
<div style="position:absolute;left:90.00px;top:518.84px" class="cls_007"><span class="cls_007">up the corresponding DNS record for the URL, obtains an IP address of a boundary node,</span></div>
<div style="position:absolute;left:90.00px;top:532.38px" class="cls_007"><span class="cls_007">and then sends an initial HTTPS request to this address.  The boundary node returns a</span></div>
<div style="position:absolute;left:90.00px;top:545.93px" class="cls_007"><span class="cls_007">javascript-based “service worker” that will be executed in the legacy client. After this, all</span></div>
<div style="position:absolute;left:90.00px;top:559.48px" class="cls_007"><span class="cls_007">interactions between the legacy client and the boundary node will be done via this service</span></div>
<div style="position:absolute;left:90.00px;top:573.03px" class="cls_007"><span class="cls_007">worker.</span></div>
<div style="position:absolute;left:106.94px;top:586.58px" class="cls_007"><span class="cls_007">One of the essential tasks carried out by the service worker is to authenticate responses</span></div>
<div style="position:absolute;left:90.00px;top:600.13px" class="cls_007"><span class="cls_007">from the IC using chain-key cryptography (see Section 1.6). To do this, the public verifica-</span></div>
<div style="position:absolute;left:90.00px;top:613.68px" class="cls_007"><span class="cls_007">tion key for the NNS is hard-coded in the service worker.</span></div>
<div style="position:absolute;left:106.94px;top:627.23px" class="cls_007"><span class="cls_007">The boundary node itself is responsible for routing requests to a replica on the subnet</span></div>
<div style="position:absolute;left:90.00px;top:640.78px" class="cls_007"><span class="cls_007">on which the specified canister is hosted. The information needed to perform this routing is</span></div>
<div style="position:absolute;left:90.00px;top:654.33px" class="cls_007"><span class="cls_007">obtained by the boundary node from the NNS. The boundary node keeps a list with replicas</span></div>
<div style="position:absolute;left:90.00px;top:667.88px" class="cls_007"><span class="cls_007">that provide timely replies and selects a random replica from this list.</span></div>
<div style="position:absolute;left:303.27px;top:720.98px" class="cls_007"><span class="cls_007">9</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:7218px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background10.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">All communication between legacy clients and boundary nodes and between boundary</span></div>
<div style="position:absolute;left:90.00px;top:102.58px" class="cls_007"><span class="cls_007">nodes and replicas is secured via TLS.</span><span class="cls_004"><sup>5</sup></span></div>
<div style="position:absolute;left:106.94px;top:117.15px" class="cls_007"><span class="cls_007">In addition to legacy clients, it is also possible to interact with boundary nodes using “IC</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">native” clients, which already include the service-worker logic, and do not need to retrieve</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">the service worker program from the boundary node.</span></div>
<div style="position:absolute;left:106.94px;top:157.80px" class="cls_007"><span class="cls_007">Just as for replicas, the deployment and configuration of boundary nodes is controlled</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">by the NNS.</span></div>
<div style="position:absolute;left:90.00px;top:199.51px" class="cls_003"><span class="cls_003">1.10</span></div>
<div style="position:absolute;left:127.36px;top:199.51px" class="cls_003"><span class="cls_003">More details of the NNS</span></div>
<div style="position:absolute;left:90.00px;top:221.15px" class="cls_007"><span class="cls_007">As already mentioned in Section 1.5, the network nervous system (NNS) is an algorithmic</span></div>
<div style="position:absolute;left:90.00px;top:234.70px" class="cls_007"><span class="cls_007">governance system that controls the IC. It is realized by a set of canisters on a special sys-</span></div>
<div style="position:absolute;left:90.00px;top:248.25px" class="cls_007"><span class="cls_007">tem subnet. This subnet is like any other subnet, but is configured somewhat differently</span></div>
<div style="position:absolute;left:90.00px;top:261.80px" class="cls_007"><span class="cls_007">(as one example, canisters on the system subnet are not charged for the cycles they use).</span></div>
<div style="position:absolute;left:106.94px;top:275.35px" class="cls_007"><span class="cls_007">Some of the most relevant NNS canisters are</span></div>
<div style="position:absolute;left:106.39px;top:297.86px" class="cls_007"><span class="cls_007">• the registry canister, which stores the configuration of the IC, i.e., which repli-</span></div>
<div style="position:absolute;left:117.27px;top:311.41px" class="cls_007"><span class="cls_007">cas belong to which subnet, the public keys associated with subnets and individual</span></div>
<div style="position:absolute;left:117.27px;top:324.96px" class="cls_007"><span class="cls_007">replicas, and so on.</span></div>
<div style="position:absolute;left:106.39px;top:347.48px" class="cls_007"><span class="cls_007">• the governance canister, which manages the decision making and voting on how</span></div>
<div style="position:absolute;left:117.27px;top:361.03px" class="cls_007"><span class="cls_007">the IC should be evolved, and</span></div>
<div style="position:absolute;left:106.39px;top:383.54px" class="cls_007"><span class="cls_007">• the ledger canister, which keeps track of the users’ ICP utility token accounts and</span></div>
<div style="position:absolute;left:117.27px;top:397.09px" class="cls_007"><span class="cls_007">the transactions between them.</span></div>
<div style="position:absolute;left:90.00px;top:425.91px" class="cls_007"><span class="cls_007">1.10.1</span></div>
<div style="position:absolute;left:134.61px;top:425.91px" class="cls_007"><span class="cls_007">Decision making on the NNS</span></div>
<div style="position:absolute;left:90.00px;top:446.50px" class="cls_007"><span class="cls_007">Anyone can participate in NNS governance by staking ICP tokens in so-called neurons.</span></div>
<div style="position:absolute;left:90.00px;top:460.05px" class="cls_007"><span class="cls_007">Neuron holders can then suggest and vote on proposals, which are suggestions on how the</span></div>
<div style="position:absolute;left:90.00px;top:473.60px" class="cls_007"><span class="cls_007">IC should be changed, e.g., how the subnet topology or the protocol should be changed. The</span></div>
<div style="position:absolute;left:90.00px;top:487.15px" class="cls_007"><span class="cls_007">neurons’ voting power for decision making is based on proof of stake. Intuitively, neurons</span></div>
<div style="position:absolute;left:90.00px;top:500.70px" class="cls_007"><span class="cls_007">with more staked ICP tokens have more voting power.  However, the voting power also</span></div>
<div style="position:absolute;left:90.00px;top:514.25px" class="cls_007"><span class="cls_007">depends on some other neuron characteristics, e.g., more voting power is given to neuron</span></div>
<div style="position:absolute;left:90.00px;top:527.80px" class="cls_007"><span class="cls_007">holders that are committed to keep their tokens staked for a longer period of time.</span></div>
<div style="position:absolute;left:106.94px;top:541.35px" class="cls_007"><span class="cls_007">Each proposal has a determined voting period. A proposal is adopted if at the voting</span></div>
<div style="position:absolute;left:90.00px;top:554.89px" class="cls_007"><span class="cls_007">period’s end, a simple majority of the total voting power has voted in favor of the proposal</span></div>
<div style="position:absolute;left:90.00px;top:568.44px" class="cls_007"><span class="cls_007">and these Yes-votes constitute a given quorum (currently 3%) of the total voting power.</span></div>
<div style="position:absolute;left:90.00px;top:581.99px" class="cls_007"><span class="cls_007">Otherwise, the proposal is rejected. In addition, a proposal is adopted or rejected at any</span></div>
<div style="position:absolute;left:90.00px;top:595.54px" class="cls_007"><span class="cls_007">point if an absolute majority (more than half of the total voting power) is in favor or against</span></div>
<div style="position:absolute;left:90.00px;top:609.09px" class="cls_007"><span class="cls_007">the proposal, respectively.</span></div>
<div style="position:absolute;left:106.94px;top:622.64px" class="cls_007"><span class="cls_007">If a proposal is adopted, the governance canister automatically executes the decision.</span></div>
<div style="position:absolute;left:90.00px;top:636.19px" class="cls_007"><span class="cls_007">For example, if a proposal suggests changing the network topology and is adopted, the</span></div>
<div style="position:absolute;left:90.00px;top:649.74px" class="cls_007"><span class="cls_007">governance canister automatically updates the registry with the new configurations.</span></div>
<div style="position:absolute;left:102.44px;top:670.62px" class="cls_008"><span class="cls_008"><sup>5</sup></span><span class="cls_009">See <A HREF="https://en.wikipedia.org/wiki/Transport_Layer_Security">https://en.wikipedia.org/wiki/Transport_Layer_Security</A>.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">10</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:8020px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background11.jpg" width=612 height=792></div>
<div style="position:absolute;left:173.01px;top:266.23px" class="cls_007"><span class="cls_007">Figure 1: The layers of the Internet Computer Protocol</span></div>
<div style="position:absolute;left:90.00px;top:296.96px" class="cls_003"><span class="cls_003">1.11</span></div>
<div style="position:absolute;left:127.36px;top:296.96px" class="cls_003"><span class="cls_003">Work in progress</span></div>
<div style="position:absolute;left:90.00px;top:318.60px" class="cls_007"><span class="cls_007">The architecture of the IC is still evolving and expanding. Here are a few new features that</span></div>
<div style="position:absolute;left:90.00px;top:332.15px" class="cls_007"><span class="cls_007">will be deployed soon:</span></div>
<div style="position:absolute;left:90.00px;top:353.13px" class="cls_007"><span class="cls_007">DAO-controlled canisters. Just like the overall configuration of the IC is controlled by</span></div>
<div style="position:absolute;left:117.27px;top:366.68px" class="cls_007"><span class="cls_007">the NNS, any canister may also be controlled by its own DAO, called the service</span></div>
<div style="position:absolute;left:117.27px;top:380.23px" class="cls_007"><span class="cls_007">nervous system (SNS). The DAO controlling a canister can control updates to the</span></div>
<div style="position:absolute;left:117.27px;top:393.78px" class="cls_007"><span class="cls_007">canister logic, as well as issuing privileged commands to be carried out by the canister.</span></div>
<div style="position:absolute;left:90.00px;top:415.68px" class="cls_007"><span class="cls_007">Threshold ECDSA. ECDSA signatures [JMV01] are used in cryptocurrencies, such as</span></div>
<div style="position:absolute;left:117.27px;top:429.23px" class="cls_007"><span class="cls_007">Bitcoin and Ethereum, as well as in many other applications. While threshold signa-</span></div>
<div style="position:absolute;left:117.27px;top:442.78px" class="cls_007"><span class="cls_007">tures are already an essential ingredient in the IC, these are not threshold ECDSA</span></div>
<div style="position:absolute;left:117.27px;top:456.33px" class="cls_007"><span class="cls_007">signatures. This new feature will allow individual canisters to control an ECDSA sign-</span></div>
<div style="position:absolute;left:117.27px;top:469.88px" class="cls_007"><span class="cls_007">ing key, which is securely distributed among all of the replicas on the subnet hosting</span></div>
<div style="position:absolute;left:117.27px;top:483.42px" class="cls_007"><span class="cls_007">the canister.</span></div>
<div style="position:absolute;left:90.00px;top:505.33px" class="cls_007"><span class="cls_007">Bitcoin and Ethereum integration. Building on the new threshold ECDSA feature,</span></div>
<div style="position:absolute;left:117.27px;top:518.88px" class="cls_007"><span class="cls_007">this feature will allow canisters to interact with the Bitcoin and Ethereum blockchains,</span></div>
<div style="position:absolute;left:117.27px;top:532.42px" class="cls_007"><span class="cls_007">including the ability to sign transactions.</span></div>
<div style="position:absolute;left:90.00px;top:554.33px" class="cls_007"><span class="cls_007">HTTP integration. This feature will allow canisters to read arbitrary web pages (external</span></div>
<div style="position:absolute;left:117.27px;top:567.87px" class="cls_007"><span class="cls_007">to the IC).</span></div>
<div style="position:absolute;left:90.00px;top:598.52px" class="cls_006"><span class="cls_006">2</span></div>
<div style="position:absolute;left:114.21px;top:598.52px" class="cls_006"><span class="cls_006">Architecture overview</span></div>
<div style="position:absolute;left:90.00px;top:626.31px" class="cls_007"><span class="cls_007">As illustrated in Figure 1, the Internet Computer Protocol consists of four layers:</span></div>
<div style="position:absolute;left:106.39px;top:647.29px" class="cls_007"><span class="cls_007">• peer-to-peer layer (see Section 4);</span></div>
<div style="position:absolute;left:106.39px;top:669.19px" class="cls_007"><span class="cls_007">• consensus layer (see Section 5);</span></div>
<div style="position:absolute;left:106.39px;top:691.09px" class="cls_007"><span class="cls_007">• routing layer (see Section 6);</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">11</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:8822px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background12.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.39px;top:90.05px" class="cls_007"><span class="cls_007">• execution layer (see Section 7).</span></div>
<div style="position:absolute;left:90.00px;top:112.56px" class="cls_007"><span class="cls_007">Chain-key cryptography impacts several layers, and is discussed in detail in Sections 3</span></div>
<div style="position:absolute;left:90.00px;top:126.11px" class="cls_007"><span class="cls_007">(threshold signatures) and 8 (chain-evolution technology).</span></div>
<div style="position:absolute;left:90.00px;top:154.28px" class="cls_003"><span class="cls_003">2.1</span></div>
<div style="position:absolute;left:120.64px;top:154.28px" class="cls_003"><span class="cls_003">Peer-to-peer layer</span></div>
<div style="position:absolute;left:90.00px;top:175.92px" class="cls_007"><span class="cls_007">The peer-to-peer layer’s task is to transport protocol messages between the replicas in a</span></div>
<div style="position:absolute;left:90.00px;top:189.47px" class="cls_007"><span class="cls_007">subnet. These protocol messages consist of</span></div>
<div style="position:absolute;left:106.39px;top:211.99px" class="cls_007"><span class="cls_007">• messages used to implement consensus,</span></div>
<div style="position:absolute;left:106.39px;top:234.50px" class="cls_007"><span class="cls_007">• input messages generated by an external user.</span></div>
<div style="position:absolute;left:90.00px;top:257.02px" class="cls_007"><span class="cls_007">Basically, the service provided by the peer-to-peer is a “best effort” broadcast channel:</span></div>
<div style="position:absolute;left:117.27px;top:279.53px" class="cls_007"><span class="cls_007">if an honest replica broadcasts a message, then that message will eventually be</span></div>
<div style="position:absolute;left:117.27px;top:293.08px" class="cls_007"><span class="cls_007">received by all honest replicas in the subnet.</span></div>
<div style="position:absolute;left:106.94px;top:315.60px" class="cls_007"><span class="cls_007">Design goals include the following:</span></div>
<div style="position:absolute;left:106.39px;top:338.11px" class="cls_007"><span class="cls_007">• Bounded resources.  All algorithms must work with bounded resources (memory,</span></div>
<div style="position:absolute;left:117.27px;top:351.66px" class="cls_007"><span class="cls_007">bandwidth, CPU).</span></div>
<div style="position:absolute;left:106.39px;top:374.18px" class="cls_007"><span class="cls_007">• Prioritization. Different messages may be treated with different priorities, depend-</span></div>
<div style="position:absolute;left:117.27px;top:387.73px" class="cls_007"><span class="cls_007">ing on certain attributes (e.g., type, size, round), and these priorities may change over</span></div>
<div style="position:absolute;left:117.27px;top:401.28px" class="cls_007"><span class="cls_007">time.</span></div>
<div style="position:absolute;left:106.39px;top:423.79px" class="cls_007"><span class="cls_007">• Efficiency. High throughput is more important than low latency.</span></div>
<div style="position:absolute;left:106.39px;top:446.31px" class="cls_007"><span class="cls_007">• DOS/SPAM resilience. Corrupt replicas should not prevent honest replicas from</span></div>
<div style="position:absolute;left:117.27px;top:459.86px" class="cls_007"><span class="cls_007">communicating with one another.</span></div>
<div style="position:absolute;left:90.00px;top:488.02px" class="cls_003"><span class="cls_003">2.2</span></div>
<div style="position:absolute;left:120.64px;top:488.02px" class="cls_003"><span class="cls_003">Consensus layer</span></div>
<div style="position:absolute;left:90.00px;top:509.66px" class="cls_007"><span class="cls_007">The job of the consensus layer of the IC is to order inputs so that all replicas in a subnet</span></div>
<div style="position:absolute;left:90.00px;top:523.21px" class="cls_007"><span class="cls_007">will process such inputs in the same order. There are many protocols in the literature for</span></div>
<div style="position:absolute;left:90.00px;top:536.76px" class="cls_007"><span class="cls_007">this problem. The IC uses a new consensus protocol, which is described here at a high level.</span></div>
<div style="position:absolute;left:106.94px;top:550.31px" class="cls_007"><span class="cls_007">Any secure consensus protocol should guarantee two properties, which (roughly stated)</span></div>
<div style="position:absolute;left:90.00px;top:563.86px" class="cls_007"><span class="cls_007">are:</span></div>
<div style="position:absolute;left:106.39px;top:586.38px" class="cls_007"><span class="cls_007">• safety: all replicas in fact agree on the same ordering of inputs, and</span></div>
<div style="position:absolute;left:106.39px;top:608.89px" class="cls_007"><span class="cls_007">• liveness: all replicas should make steady progress.</span></div>
<div style="position:absolute;left:106.94px;top:631.41px" class="cls_007"><span class="cls_007">The IC consensus protocol is designed to be</span></div>
<div style="position:absolute;left:106.39px;top:653.92px" class="cls_007"><span class="cls_007">• extremely simple, and</span></div>
<div style="position:absolute;left:106.39px;top:676.44px" class="cls_007"><span class="cls_007">• robust: performance degrades gracefully when some replicas are malicious.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">12</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:9624px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background13.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">As discussed above, we assume f &lt; n/3 faulty (i.e., Byzantine) replicas. Also, liveness</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">holds under a partial synchrony assumption, while safety is guaranteed, even in a completely</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">asynchronous network.</span></div>
<div style="position:absolute;left:106.94px;top:130.70px" class="cls_007"><span class="cls_007">Like a number of consensus protocols, the IC consensus protocol is based on a blockchain.</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">As the protocol progresses, a tree of blocks is grown, starting from a special genesis block</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">that is the root of the tree.  Each non-genesis block in the tree contains (among other</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">things) a payload, consisting of a sequence of inputs, and a hash of the block’s parent in</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">the tree.  The honest replicas have a consistent view of this tree:  while each replica may</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">have a different, partial view of this tree, all the replicas have a view of the same tree. In</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">addition, as the protocol progresses, there is always a path of finalized blocks in this tree.</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">Again, the honest replicas have a consistent view of this path: while each replica may have</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">a different, partial view of this path, all the replicas have a view of the same path.  The</span></div>
<div style="position:absolute;left:90.00px;top:252.64px" class="cls_007"><span class="cls_007">inputs in the payloads of the blocks along this path are the ordered inputs will be processed</span></div>
<div style="position:absolute;left:90.00px;top:266.19px" class="cls_007"><span class="cls_007">by the execution layer of the Internet Computer.</span></div>
<div style="position:absolute;left:106.94px;top:279.74px" class="cls_007"><span class="cls_007">The protocol proceeds in rounds.  In round h of the protocol, one or more blocks of</span></div>
<div style="position:absolute;left:90.00px;top:293.29px" class="cls_007"><span class="cls_007">height h are added to the tree. That is, the blocks added in round h are always at a distance</span></div>
<div style="position:absolute;left:90.00px;top:306.84px" class="cls_007"><span class="cls_007">of exactly h from the root. In each round, a pseudo-random process is used to assign each</span></div>
<div style="position:absolute;left:90.00px;top:320.39px" class="cls_007"><span class="cls_007">replica a unique rank, which is an integer in the range 0, . . . , n − 1. This pseudo-random</span></div>
<div style="position:absolute;left:90.00px;top:333.93px" class="cls_007"><span class="cls_007">process is implemented using a Random Beacon (this makes use of threshold signatures,</span></div>
<div style="position:absolute;left:90.00px;top:347.48px" class="cls_007"><span class="cls_007">mentioned above in Section 1.6.1 and discussed in more detail in Section 3).  The replica</span></div>
<div style="position:absolute;left:90.00px;top:361.03px" class="cls_007"><span class="cls_007">of lowest rank is the leader of that round. When the leader is honest and the network is</span></div>
<div style="position:absolute;left:90.00px;top:374.58px" class="cls_007"><span class="cls_007">synchronous, the leader will propose a block, which will be added to the tree; moreover,</span></div>
<div style="position:absolute;left:90.00px;top:388.13px" class="cls_007"><span class="cls_007">this will be the only block added to the tree in this round and it will extend the finalized</span></div>
<div style="position:absolute;left:90.00px;top:401.68px" class="cls_007"><span class="cls_007">path.  If the leader is not honest or the network is not synchronous, some other replicas</span></div>
<div style="position:absolute;left:90.00px;top:415.23px" class="cls_007"><span class="cls_007">of higher rank may also propose blocks, and also have their blocks added to the tree.  In</span></div>
<div style="position:absolute;left:90.00px;top:428.78px" class="cls_007"><span class="cls_007">any case, the logic of the protocol gives highest priority to the leader’s proposed block</span></div>
<div style="position:absolute;left:90.00px;top:442.33px" class="cls_007"><span class="cls_007">and some block or blocks will be added to this tree in this round.  Even if the protocol</span></div>
<div style="position:absolute;left:90.00px;top:455.88px" class="cls_007"><span class="cls_007">proceeds for a few rounds without extending the finalized path, the height of the tree will</span></div>
<div style="position:absolute;left:90.00px;top:469.43px" class="cls_007"><span class="cls_007">continue to grow with each round, so that when the finalized path is extended in round h,</span></div>
<div style="position:absolute;left:90.00px;top:482.98px" class="cls_007"><span class="cls_007">the finalized path will be of length h. A consequence of this, even if the latency occasionally</span></div>
<div style="position:absolute;left:90.00px;top:496.53px" class="cls_007"><span class="cls_007">increases because of faulty replicas or unexpectedly high network latency, the throughput of</span></div>
<div style="position:absolute;left:90.00px;top:510.07px" class="cls_007"><span class="cls_007">the protocol remains essentially constant.</span></div>
<div style="position:absolute;left:106.94px;top:523.62px" class="cls_007"><span class="cls_007">The consensus protocol relies on digital signatures to authenticate messages sent between</span></div>
<div style="position:absolute;left:90.00px;top:537.17px" class="cls_007"><span class="cls_007">replicas.  To implement the protocol, each replica is associated with a public verification</span></div>
<div style="position:absolute;left:90.00px;top:550.72px" class="cls_007"><span class="cls_007">key for a signature scheme. The association of replicas to public keys is obtained from the</span></div>
<div style="position:absolute;left:90.00px;top:564.27px" class="cls_007"><span class="cls_007">registry maintained by the NNS.</span></div>
<div style="position:absolute;left:90.00px;top:592.44px" class="cls_003"><span class="cls_003">2.3</span></div>
<div style="position:absolute;left:120.64px;top:592.44px" class="cls_003"><span class="cls_003">Message routing</span></div>
<div style="position:absolute;left:90.00px;top:614.08px" class="cls_007"><span class="cls_007">As discussed in Section 1.7, basic computational unit in the IC is called a canister. The IC</span></div>
<div style="position:absolute;left:90.00px;top:627.63px" class="cls_007"><span class="cls_007">provides a run-time environment for executing programs in a canister, and to communicate</span></div>
<div style="position:absolute;left:90.00px;top:641.18px" class="cls_007"><span class="cls_007">with other canisters and external users (via message passing).</span></div>
<div style="position:absolute;left:106.94px;top:654.73px" class="cls_007"><span class="cls_007">The consensus layer bundles inputs into payloads, which get placed into blocks, and</span></div>
<div style="position:absolute;left:90.00px;top:668.28px" class="cls_007"><span class="cls_007">as blocks are finalized, the corresponding payloads are delivered to the message routing</span></div>
<div style="position:absolute;left:90.00px;top:681.82px" class="cls_007"><span class="cls_007">layer, then processed by the execution environment, which updates the state of the</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">13</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:10426px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background14.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">canisters on the replicated state machine and generates outputs, and these outputs are</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">processed by the message routing layer.</span></div>
<div style="position:absolute;left:106.94px;top:117.15px" class="cls_007"><span class="cls_007">It is useful to distinguish between two types of inputs:</span></div>
<div style="position:absolute;left:90.00px;top:139.66px" class="cls_007"><span class="cls_007">ingress messages: these are messages from external users;</span></div>
<div style="position:absolute;left:90.00px;top:162.18px" class="cls_007"><span class="cls_007">cross-subnet messages: these are messages from canisters on other subnets.</span></div>
<div style="position:absolute;left:90.00px;top:184.69px" class="cls_007"><span class="cls_007">We can also distinguish between two types of outputs:</span></div>
<div style="position:absolute;left:90.00px;top:207.21px" class="cls_007"><span class="cls_007">ingress message responses: these are responses to ingress messages (which may be re-</span></div>
<div style="position:absolute;left:117.27px;top:220.76px" class="cls_007"><span class="cls_007">trieved by external users);</span></div>
<div style="position:absolute;left:90.00px;top:243.27px" class="cls_007"><span class="cls_007">cross-subnet messages: these are messages to canisters on other subnets.</span></div>
<div style="position:absolute;left:106.94px;top:265.79px" class="cls_007"><span class="cls_007">Upon receiving a payload from consensus, the inputs in that payload are placed into</span></div>
<div style="position:absolute;left:90.00px;top:279.34px" class="cls_007"><span class="cls_007">various input queues.  For each canister C running on a subnet, there are several in-</span></div>
<div style="position:absolute;left:90.00px;top:291.87px" class="cls_007"><span class="cls_007">put queues:  one for ingress messages to C, and for each other canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  with whom C</span></div>
<div style="position:absolute;left:90.00px;top:305.42px" class="cls_007"><span class="cls_007">communicates, one for cross-subnet messages to C from C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">.</span></div>
<div style="position:absolute;left:106.94px;top:319.99px" class="cls_007"><span class="cls_007">In a each round, the execution layer will consume some of the inputs in these queues,</span></div>
<div style="position:absolute;left:90.00px;top:333.54px" class="cls_007"><span class="cls_007">update the replicated state of the relevant canisters, and place outputs in various output</span></div>
<div style="position:absolute;left:90.00px;top:347.09px" class="cls_007"><span class="cls_007">queues. For each canister C running on a subnet, there are several output queues: for each</span></div>
<div style="position:absolute;left:90.00px;top:359.61px" class="cls_007"><span class="cls_007">other canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> with whom C communicates, one for cross-subnet messages to C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> from C.</span></div>
<div style="position:absolute;left:90.00px;top:374.18px" class="cls_007"><span class="cls_007">The message routing layer will take the messages in these output queues and place them into</span></div>
<div style="position:absolute;left:90.00px;top:387.73px" class="cls_007"><span class="cls_007">subnet-to-subnet streams to be processed by an crossnet transfer protocol, whose</span></div>
<div style="position:absolute;left:90.00px;top:401.28px" class="cls_007"><span class="cls_007">job it is to actually transport these messages to other subnets.</span></div>
<div style="position:absolute;left:106.94px;top:414.83px" class="cls_007"><span class="cls_007">In addition to these output queues, there is also an ingress history data structure.</span></div>
<div style="position:absolute;left:90.00px;top:428.38px" class="cls_007"><span class="cls_007">Once an ingress message has been processed by a canister, a response to that ingress</span></div>
<div style="position:absolute;left:90.00px;top:441.93px" class="cls_007"><span class="cls_007">message will be recorded in this data structure.  At that point, the external user who</span></div>
<div style="position:absolute;left:90.00px;top:455.48px" class="cls_007"><span class="cls_007">provided the ingress message will be able to retrieve the corresponding response.</span></div>
<div style="position:absolute;left:495.03px;top:455.48px" class="cls_007"><span class="cls_007">(Note</span></div>
<div style="position:absolute;left:90.00px;top:469.03px" class="cls_007"><span class="cls_007">that ingress history does not maintain the full history of all ingress messages.)</span></div>
<div style="position:absolute;left:106.94px;top:482.58px" class="cls_007"><span class="cls_007">Note that the replicated state comprises the state of the canisters, as well as “system</span></div>
<div style="position:absolute;left:90.00px;top:496.13px" class="cls_007"><span class="cls_007">state”, including the above-mentioned queues and streams, as well as the ingress history data</span></div>
<div style="position:absolute;left:90.00px;top:509.68px" class="cls_007"><span class="cls_007">structure.  Thus, both the message routing and execution layers are involved in updating</span></div>
<div style="position:absolute;left:90.00px;top:523.23px" class="cls_007"><span class="cls_007">and maintaining the replicated state of a subnet.  It is essential that all of this state is</span></div>
<div style="position:absolute;left:90.00px;top:536.77px" class="cls_007"><span class="cls_007">updated in a completely deterministic fashion, so that all replicas maintain exactly the</span></div>
<div style="position:absolute;left:90.00px;top:550.32px" class="cls_007"><span class="cls_007">same state.</span></div>
<div style="position:absolute;left:106.94px;top:563.87px" class="cls_007"><span class="cls_007">Also note that the consensus layer is decoupled from the message routing and execution</span></div>
<div style="position:absolute;left:90.00px;top:577.42px" class="cls_007"><span class="cls_007">layers, in the sense that any forks in the consensus blockchain are resolved before their</span></div>
<div style="position:absolute;left:90.00px;top:590.97px" class="cls_007"><span class="cls_007">payloads are passed to message routing, and in fact, consensus does not have to keep in</span></div>
<div style="position:absolute;left:90.00px;top:604.52px" class="cls_007"><span class="cls_007">lock step with message routing and consensus and is allowed to run a bit ahead.</span></div>
<div style="position:absolute;left:90.00px;top:633.33px" class="cls_007"><span class="cls_007">2.3.1</span></div>
<div style="position:absolute;left:128.33px;top:633.33px" class="cls_007"><span class="cls_007">Per-round certified state</span></div>
<div style="position:absolute;left:90.00px;top:653.93px" class="cls_007"><span class="cls_007">In each round, some of the state of a subnet will be certified.  The per-round certified</span></div>
<div style="position:absolute;left:90.00px;top:667.48px" class="cls_007"><span class="cls_007">state is certified using chain-key cryptography. Among other things, the certified state in</span></div>
<div style="position:absolute;left:90.00px;top:681.03px" class="cls_007"><span class="cls_007">a given round consists of</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">14</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:11228px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background15.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.39px;top:90.05px" class="cls_007"><span class="cls_007">• cross-subnet messages that were recently added to the subnet-to-subnet streams;</span></div>
<div style="position:absolute;left:106.39px;top:112.56px" class="cls_007"><span class="cls_007">• other metadata, including the ingress history data structure.</span></div>
<div style="position:absolute;left:90.00px;top:135.08px" class="cls_007"><span class="cls_007">The per-round certified state is certified using a threshold signature (see Section 1.6.1).</span></div>
<div style="position:absolute;left:90.00px;top:148.63px" class="cls_007"><span class="cls_007">Per-round certified state is used in several ways in the IC:</span></div>
<div style="position:absolute;left:106.39px;top:171.15px" class="cls_007"><span class="cls_007">• Output authentication. Cross-subnet messages and responses to ingress messages are</span></div>
<div style="position:absolute;left:117.27px;top:184.69px" class="cls_007"><span class="cls_007">authenticated using per-round certified state.</span></div>
<div style="position:absolute;left:106.39px;top:207.21px" class="cls_007"><span class="cls_007">• Preventing and detecting non-determinism.  Consensus guarantees that each replica</span></div>
<div style="position:absolute;left:117.27px;top:220.76px" class="cls_007"><span class="cls_007">processes inputs in the same order. Since each replica processes these inputs determin-</span></div>
<div style="position:absolute;left:117.27px;top:234.31px" class="cls_007"><span class="cls_007">istically, each replica should obtain the same state. However, the IC is designed with</span></div>
<div style="position:absolute;left:117.27px;top:247.86px" class="cls_007"><span class="cls_007">an extra layer of robustness to prevent and detect any (accidental) non-deterministic</span></div>
<div style="position:absolute;left:117.27px;top:261.41px" class="cls_007"><span class="cls_007">computation, should it arise. The per-round certified state is one of the mechanisms</span></div>
<div style="position:absolute;left:117.27px;top:274.96px" class="cls_007"><span class="cls_007">used to do this.</span></div>
<div style="position:absolute;left:106.39px;top:297.47px" class="cls_007"><span class="cls_007">• Coordination with consensus. The per-round certified state is also used to coordinate</span></div>
<div style="position:absolute;left:117.27px;top:311.02px" class="cls_007"><span class="cls_007">the execution and consensus layers, in two different ways:</span></div>
<div style="position:absolute;left:129.55px;top:333.54px" class="cls_007"><span class="cls_007">- If consensus is running ahead of execution (whose progress is determined by the</span></div>
<div style="position:absolute;left:141.27px;top:347.09px" class="cls_007"><span class="cls_007">last round whose state is certified), consensus will be “throttled”.</span></div>
<div style="position:absolute;left:129.55px;top:364.62px" class="cls_007"><span class="cls_007">- Inputs to consensus must pass certain validity checks, and these validity checks</span></div>
<div style="position:absolute;left:141.27px;top:378.17px" class="cls_007"><span class="cls_007">may depend on certified state, which all replicas must agree upon.</span></div>
<div style="position:absolute;left:90.00px;top:406.98px" class="cls_007"><span class="cls_007">2.3.2</span></div>
<div style="position:absolute;left:128.33px;top:406.98px" class="cls_007"><span class="cls_007">Query calls vs update calls</span></div>
<div style="position:absolute;left:90.00px;top:427.58px" class="cls_007"><span class="cls_007">As we have described it so far, an ingress messages must pass through consensus so that</span></div>
<div style="position:absolute;left:90.00px;top:441.13px" class="cls_007"><span class="cls_007">they are processed in the same order by all replicas on a subnet.  However, an important</span></div>
<div style="position:absolute;left:90.00px;top:454.68px" class="cls_007"><span class="cls_007">optimization is available to those ingress messages whose processing does not modify the</span></div>
<div style="position:absolute;left:90.00px;top:468.23px" class="cls_007"><span class="cls_007">replicated state of a subnet. These are called query calls — as opposed to other ingress</span></div>
<div style="position:absolute;left:90.00px;top:481.77px" class="cls_007"><span class="cls_007">messages, which are called update calls. Query calls are allowed to perform computations</span></div>
<div style="position:absolute;left:90.00px;top:495.32px" class="cls_007"><span class="cls_007">which read and possibly update the state of a canister, but any updates to the state of a</span></div>
<div style="position:absolute;left:90.00px;top:508.87px" class="cls_007"><span class="cls_007">canister are never committed to the replicated state. As such, a query call may be processed</span></div>
<div style="position:absolute;left:90.00px;top:522.42px" class="cls_007"><span class="cls_007">directly by a single replica without passing through consensus, which greatly reduces the</span></div>
<div style="position:absolute;left:90.00px;top:535.97px" class="cls_007"><span class="cls_007">latency for obtaining a response from a query call.</span></div>
<div style="position:absolute;left:106.94px;top:549.52px" class="cls_007"><span class="cls_007">In general, a response to a query call is not recorded in the ingress history data structure,</span></div>
<div style="position:absolute;left:90.00px;top:563.07px" class="cls_007"><span class="cls_007">and therefore cannot be authenticated using the per-round certified state mechanism as</span></div>
<div style="position:absolute;left:90.00px;top:576.62px" class="cls_007"><span class="cls_007">described above.  However, the IC makes it possible for canisters to store data (while</span></div>
<div style="position:absolute;left:90.00px;top:590.17px" class="cls_007"><span class="cls_007">processing update calls) in special certified variables, which can be authenticated by this</span></div>
<div style="position:absolute;left:90.00px;top:603.72px" class="cls_007"><span class="cls_007">mechanism; as such, query calls that return as their value a certified variable can still be</span></div>
<div style="position:absolute;left:90.00px;top:617.27px" class="cls_007"><span class="cls_007">authenticated.</span></div>
<div style="position:absolute;left:90.00px;top:646.08px" class="cls_007"><span class="cls_007">2.3.3</span></div>
<div style="position:absolute;left:128.33px;top:646.08px" class="cls_007"><span class="cls_007">External user authentication</span></div>
<div style="position:absolute;left:90.00px;top:666.68px" class="cls_007"><span class="cls_007">One of the main differences between an ingress message and a cross-subnet message is the</span></div>
<div style="position:absolute;left:90.00px;top:680.22px" class="cls_007"><span class="cls_007">mechanism used for authenticating these messages. While chain-key cryptography is used</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">15</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:12030px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background16.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">to authenticate cross-subnet messages, a different mechanism is used to authenticate ingress</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">messages from external users.</span></div>
<div style="position:absolute;left:106.94px;top:117.15px" class="cls_007"><span class="cls_007">There is no central registry for external users. Rather, an external user identifies himself</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">to a canister using a user identifier, which is a hash of a public signature-verification key.</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">The user holds a corresponding secret signing key, which is used to sign ingress messages.</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">Such a signature, as well as the corresponding public key, is sent along with the ingress</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">message. The IC automatically authenticates the signature and passes the user identifier to</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">the appropriate canister. The canister may then authorize the requested operation, based</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">on the user identifier and other parameters to the operation specified in the ingress message.</span></div>
<div style="position:absolute;left:106.94px;top:211.99px" class="cls_007"><span class="cls_007">First-time users generate a key pair and derive their user identifier from the public key</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">during their first interaction with the IC. Returning users are authenticated using the secret</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">key that is stored by the user agent. A user may associate several key pairs with a single</span></div>
<div style="position:absolute;left:90.00px;top:252.64px" class="cls_007"><span class="cls_007">user identity, using signature delegation. This is useful, as it allows a single user to access</span></div>
<div style="position:absolute;left:90.00px;top:266.19px" class="cls_007"><span class="cls_007">the IC from several devices using the same user identity.</span></div>
<div style="position:absolute;left:90.00px;top:293.60px" class="cls_003"><span class="cls_003">2.4</span></div>
<div style="position:absolute;left:120.64px;top:293.60px" class="cls_003"><span class="cls_003">Execution layer</span></div>
<div style="position:absolute;left:90.00px;top:315.24px" class="cls_007"><span class="cls_007">The execution layer processes one input at a time.  This input is taken from one of the</span></div>
<div style="position:absolute;left:90.00px;top:328.79px" class="cls_007"><span class="cls_007">input queues, and is directed to one canister.  Based on this input and the state of the</span></div>
<div style="position:absolute;left:90.00px;top:342.34px" class="cls_007"><span class="cls_007">canister, the execution environment updates the state of the canister, and additionally may</span></div>
<div style="position:absolute;left:90.00px;top:355.88px" class="cls_007"><span class="cls_007">add messages to output queues and update the ingress history (possibly with a response to</span></div>
<div style="position:absolute;left:90.00px;top:369.43px" class="cls_007"><span class="cls_007">an earlier ingress message).</span></div>
<div style="position:absolute;left:106.94px;top:387.35px" class="cls_007"><span class="cls_007">Each subnet has access to a distributed pseudorandom generator (PRG). Pseudo-</span></div>
<div style="position:absolute;left:90.00px;top:400.90px" class="cls_007"><span class="cls_007">random bits are derived from a seed that itself is a threshold signature called the Random</span></div>
<div style="position:absolute;left:90.00px;top:414.45px" class="cls_007"><span class="cls_007">Tape (see Section 1.6.1 and more detail in Section 3). There is a different Random Tape</span></div>
<div style="position:absolute;left:90.00px;top:428.00px" class="cls_007"><span class="cls_007">for each round of the consensus protocol.</span></div>
<div style="position:absolute;left:106.94px;top:441.55px" class="cls_007"><span class="cls_007">The basic properties of the random tape are:</span></div>
<div style="position:absolute;left:103.33px;top:460.03px" class="cls_007"><span class="cls_007">1. Before a block at height h is finalized by any honest replica, the Random Tape at</span></div>
<div style="position:absolute;left:117.27px;top:473.58px" class="cls_007"><span class="cls_007">height h + 1 is guaranteed to be unpredictable.</span></div>
<div style="position:absolute;left:103.33px;top:494.49px" class="cls_007"><span class="cls_007">2. By the time block at height h + 1 is finalized by any honest replica, that replica will</span></div>
<div style="position:absolute;left:117.27px;top:508.04px" class="cls_007"><span class="cls_007">typically have all the shares it needs to construct the Random Tape at height h + 1.</span></div>
<div style="position:absolute;left:106.94px;top:526.53px" class="cls_007"><span class="cls_007">To obtain pseudorandom bits, a subnet must make a request for these bits via a “system</span></div>
<div style="position:absolute;left:90.00px;top:540.08px" class="cls_007"><span class="cls_007">call” from the execution layer in some round, say h. The system will then respond to that</span></div>
<div style="position:absolute;left:90.00px;top:553.62px" class="cls_007"><span class="cls_007">request later, using the Random Tape at height h+1. By property (1) above, it is guaranteed</span></div>
<div style="position:absolute;left:90.00px;top:567.17px" class="cls_007"><span class="cls_007">that the requested pseudorandom bits are unpredictable at the time the request is made.</span></div>
<div style="position:absolute;left:90.00px;top:580.72px" class="cls_007"><span class="cls_007">By property (2) above, the requested random bits will typically be available at the time the</span></div>
<div style="position:absolute;left:90.00px;top:594.27px" class="cls_007"><span class="cls_007">next block is finalized.</span></div>
<div style="position:absolute;left:90.00px;top:621.68px" class="cls_003"><span class="cls_003">2.5</span></div>
<div style="position:absolute;left:120.64px;top:621.68px" class="cls_003"><span class="cls_003">Putting it all together</span></div>
<div style="position:absolute;left:90.00px;top:643.32px" class="cls_007"><span class="cls_007">We trace through the typical flow to process a user request on the IC.</span></div>
<div style="position:absolute;left:103.33px;top:663.99px" class="cls_007"><span class="cls_007">1. A user’s request M to a canister C is sent by the user’s client to a boundary node (see</span></div>
<div style="position:absolute;left:117.27px;top:677.54px" class="cls_007"><span class="cls_007">Section 1.9), and the boundary node sends M to a replica on the subnet that hosts</span></div>
<div style="position:absolute;left:117.27px;top:691.09px" class="cls_007"><span class="cls_007">canister C.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">16</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:12832px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background17.jpg" width=612 height=792></div>
<div style="position:absolute;left:103.33px;top:90.05px" class="cls_007"><span class="cls_007">2.</span></div>
<div style="position:absolute;left:117.27px;top:90.05px" class="cls_007"><span class="cls_007">After receiving M , this replica will broadcast M to all other replicas on the subnet,</span></div>
<div style="position:absolute;left:117.27px;top:103.60px" class="cls_007"><span class="cls_007">using the peer-to-peer layer (see Section 2.1).</span></div>
<div style="position:absolute;left:103.33px;top:126.11px" class="cls_007"><span class="cls_007">3.</span></div>
<div style="position:absolute;left:117.27px;top:126.11px" class="cls_007"><span class="cls_007">Having received M , the leader for the next round of consensus (see Section 2.2) will</span></div>
<div style="position:absolute;left:117.27px;top:139.66px" class="cls_007"><span class="cls_007">bundle M with other inputs to form the payload for a block B that the leader proposes.</span></div>
<div style="position:absolute;left:103.33px;top:162.18px" class="cls_007"><span class="cls_007">4.</span></div>
<div style="position:absolute;left:117.27px;top:162.18px" class="cls_007"><span class="cls_007">Some time later, block B is finalized and the payload is sent to the message routing</span></div>
<div style="position:absolute;left:117.27px;top:175.73px" class="cls_007"><span class="cls_007">layer (see Section 2.3) for processing. Note that the peer-to-peer layer is also used by</span></div>
<div style="position:absolute;left:117.27px;top:189.28px" class="cls_007"><span class="cls_007">consensus to finalize this block.</span></div>
<div style="position:absolute;left:103.33px;top:211.79px" class="cls_007"><span class="cls_007">5.</span></div>
<div style="position:absolute;left:117.27px;top:211.79px" class="cls_007"><span class="cls_007">The message routing layer will place M in the input queue of the canister C.</span></div>
<div style="position:absolute;left:103.33px;top:234.31px" class="cls_007"><span class="cls_007">6.</span></div>
<div style="position:absolute;left:117.27px;top:234.31px" class="cls_007"><span class="cls_007">Some time later, the execution layer (see Section 2.4) will process M , updating the</span></div>
<div style="position:absolute;left:117.27px;top:247.86px" class="cls_007"><span class="cls_007">internal state of the canister C.</span></div>
<div style="position:absolute;left:117.27px;top:265.89px" class="cls_007"><span class="cls_007">In some situations, the canister C will be able to immediately compute a response R</span></div>
<div style="position:absolute;left:117.27px;top:279.44px" class="cls_007"><span class="cls_007">to the request M . In this case, R is placed in the ingress history data structure.</span></div>
<div style="position:absolute;left:117.27px;top:297.47px" class="cls_007"><span class="cls_007">In other situations, processing the request M  may require making a request to a</span></div>
<div style="position:absolute;left:117.27px;top:311.02px" class="cls_007"><span class="cls_007">another canister.  In this example, let us suppose that to process this particular</span></div>
<div style="position:absolute;left:117.27px;top:323.55px" class="cls_007"><span class="cls_007">request M , the canister C must make a request M</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> to another canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> that resides</span></div>
<div style="position:absolute;left:117.27px;top:337.10px" class="cls_007"><span class="cls_007">on another subnet. This second request M</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> will be placed in the output queue of the</span></div>
<div style="position:absolute;left:117.27px;top:351.67px" class="cls_007"><span class="cls_007">C, and then the following steps are performed.</span></div>
<div style="position:absolute;left:103.33px;top:374.18px" class="cls_007"><span class="cls_007">7.</span></div>
<div style="position:absolute;left:117.27px;top:373.16px" class="cls_007"><span class="cls_007">Some time later, message routing will move M</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  into an appropriate cross-subnet</span></div>
<div style="position:absolute;left:117.27px;top:386.71px" class="cls_007"><span class="cls_007">stream, and this will eventually be transported to the subnet hosting C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">.</span></div>
<div style="position:absolute;left:103.33px;top:410.25px" class="cls_007"><span class="cls_007">8.</span></div>
<div style="position:absolute;left:117.27px;top:409.23px" class="cls_007"><span class="cls_007">On the second subnet, the request M</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  will be obtained from the first subnet, and</span></div>
<div style="position:absolute;left:117.27px;top:423.80px" class="cls_007"><span class="cls_007">eventually pass through consensus and message routing on the second subnet and</span></div>
<div style="position:absolute;left:117.27px;top:437.35px" class="cls_007"><span class="cls_007">then be processed by execution. The execution layer will update the internal state of</span></div>
<div style="position:absolute;left:117.27px;top:449.88px" class="cls_007"><span class="cls_007">canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  and generate a response R</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  to the request M</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">.  The response R</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  will go</span></div>
<div style="position:absolute;left:117.27px;top:463.43px" class="cls_007"><span class="cls_007">in the output queue of canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">, and eventually be placed in a cross-subnet stream</span></div>
<div style="position:absolute;left:117.27px;top:477.99px" class="cls_007"><span class="cls_007">and transported back to the first subnet.</span></div>
<div style="position:absolute;left:103.33px;top:500.51px" class="cls_007"><span class="cls_007">9.</span></div>
<div style="position:absolute;left:117.27px;top:499.49px" class="cls_007"><span class="cls_007">Back on the first subnet, the response R</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  will be obtained from the second subnet,</span></div>
<div style="position:absolute;left:117.27px;top:514.06px" class="cls_007"><span class="cls_007">and eventually pass through consensus and message routing on the first subnet and</span></div>
<div style="position:absolute;left:117.27px;top:527.61px" class="cls_007"><span class="cls_007">then be processed by execution.  The execution layer will update the internal state</span></div>
<div style="position:absolute;left:117.27px;top:541.16px" class="cls_007"><span class="cls_007">of canister C and generate a response R to the original request message M .  This</span></div>
<div style="position:absolute;left:117.27px;top:554.71px" class="cls_007"><span class="cls_007">response will be recorded in the ingress history data structure.</span></div>
<div style="position:absolute;left:106.94px;top:580.21px" class="cls_007"><span class="cls_007">Regardless of which execution path is taken, the response R to request M will eventually</span></div>
<div style="position:absolute;left:90.00px;top:593.76px" class="cls_007"><span class="cls_007">be recorded in the ingress history data structure on the subnet that hosts canister C. To</span></div>
<div style="position:absolute;left:90.00px;top:607.31px" class="cls_007"><span class="cls_007">obtain this response, the user’s client must perform a kind of “query call” (see Section 2.3.2).</span></div>
<div style="position:absolute;left:90.00px;top:620.86px" class="cls_007"><span class="cls_007">As discussed in Section 2.3.1, this response will be authenticated via chain-key cryptography</span></div>
<div style="position:absolute;left:90.00px;top:634.41px" class="cls_007"><span class="cls_007">(specifically, using a threshold signature).  The authentication logic itself (i.e., threshold</span></div>
<div style="position:absolute;left:90.00px;top:647.96px" class="cls_007"><span class="cls_007">signature verification) will be performed by the client using the service worker originally</span></div>
<div style="position:absolute;left:90.00px;top:661.51px" class="cls_007"><span class="cls_007">obtained by the client from the boundary node.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">17</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:13634px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background18.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:86.61px" class="cls_006"><span class="cls_006">3</span></div>
<div style="position:absolute;left:114.21px;top:86.61px" class="cls_006"><span class="cls_006">Chain-key crytography I: threshold signatures</span></div>
<div style="position:absolute;left:90.00px;top:114.40px" class="cls_007"><span class="cls_007">A critical component of the IC’s chain-key cryptography is a threshold signature scheme</span></div>
<div style="position:absolute;left:90.00px;top:127.95px" class="cls_007"><span class="cls_007">[Des87]. The IC uses threshold signatures for a number of purposes. Let n be the number</span></div>
<div style="position:absolute;left:90.00px;top:141.50px" class="cls_007"><span class="cls_007">of replicas in a subnet and let f be a bound on the number of corrupt replicas.</span></div>
<div style="position:absolute;left:106.39px;top:162.17px" class="cls_007"><span class="cls_007">• The Consensus Layer makes use of an (f + 1)-out-of-n threshold signature to realize</span></div>
<div style="position:absolute;left:117.27px;top:175.72px" class="cls_007"><span class="cls_007">a random beacon (see Section 5.5).</span></div>
<div style="position:absolute;left:106.39px;top:197.50px" class="cls_007"><span class="cls_007">• The Execution Layer makes use of an (f + 1)-out-of-n threshold signature to realize</span></div>
<div style="position:absolute;left:117.27px;top:211.05px" class="cls_007"><span class="cls_007">a random tape, which is used to provide unpredictable pseudorandom numbers to</span></div>
<div style="position:absolute;left:117.27px;top:224.60px" class="cls_007"><span class="cls_007">canisters (see Section 7.1).</span></div>
<div style="position:absolute;left:106.39px;top:246.38px" class="cls_007"><span class="cls_007">• The Execution Layer makes use of an (n − f )-out-of-n threshold signature to certify</span></div>
<div style="position:absolute;left:117.27px;top:259.93px" class="cls_007"><span class="cls_007">the replicated state.  This is used both to authenticate the outputs of a subnet (see</span></div>
<div style="position:absolute;left:117.27px;top:273.48px" class="cls_007"><span class="cls_007">Section 6.1) and to implement the fast-forwarding feature of the IC’s chain-evolution</span></div>
<div style="position:absolute;left:117.27px;top:287.03px" class="cls_007"><span class="cls_007">technology (see Section 8.2).</span></div>
<div style="position:absolute;left:90.00px;top:307.70px" class="cls_007"><span class="cls_007">For the first two applications (the random beacon and random tape), it is essential that</span></div>
<div style="position:absolute;left:90.00px;top:321.25px" class="cls_007"><span class="cls_007">the threshold signatures are unique, i.e., for a given public key and message, there is only</span></div>
<div style="position:absolute;left:90.00px;top:334.80px" class="cls_007"><span class="cls_007">one valid signature. This is required as we use the signature as a seed to a pseudorandom</span></div>
<div style="position:absolute;left:90.00px;top:348.35px" class="cls_007"><span class="cls_007">generator, and all replicas who compute such a threshold signature must agree on the same</span></div>
<div style="position:absolute;left:90.00px;top:361.90px" class="cls_007"><span class="cls_007">seed.</span></div>
<div style="position:absolute;left:90.00px;top:389.72px" class="cls_003"><span class="cls_003">3.1</span></div>
<div style="position:absolute;left:120.64px;top:389.72px" class="cls_003"><span class="cls_003">Threshold BLS signatures</span></div>
<div style="position:absolute;left:90.00px;top:411.36px" class="cls_007"><span class="cls_007">We implement threshold signatures based on the BLS signature scheme [BLS01], which is</span></div>
<div style="position:absolute;left:90.00px;top:424.91px" class="cls_007"><span class="cls_007">trivial to adapt to the threshold setting.</span></div>
<div style="position:absolute;left:106.94px;top:438.46px" class="cls_007"><span class="cls_007">The ordinary (i.e., non-threshold) BLS signature scheme makes use of two groups, G</span></div>
<div style="position:absolute;left:90.00px;top:450.99px" class="cls_007"><span class="cls_007">and G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">, both of prime order q. We assume that G is generated by g ∈ G and G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> is generated</span></div>
<div style="position:absolute;left:90.00px;top:464.53px" class="cls_007"><span class="cls_007">by g</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> ∈ G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">. We also assume a hash function H</span><span class="cls_004"><sub>G</sub></span><span class="cls_008">′</span><span class="cls_007">  that maps its inputs to G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> (and which is</span></div>
<div style="position:absolute;left:90.00px;top:479.10px" class="cls_007"><span class="cls_007">modeled as a random oracle). The secret signing key is an element x ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007">  and the public</span></div>
<div style="position:absolute;left:90.00px;top:491.63px" class="cls_007"><span class="cls_007">verification key is V := g</span><span class="cls_004"><sup>x</sup></span><span class="cls_007"> ∈ G.</span></div>
<div style="position:absolute;left:106.94px;top:505.18px" class="cls_007"><span class="cls_007">In the non-threshold setting, to sign a message m, the signer computes h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> ← H</span><span class="cls_004"><sub>G</sub></span><span class="cls_008">′</span><span class="cls_007"> (m) ∈</span></div>
<div style="position:absolute;left:90.00px;top:518.73px" class="cls_007"><span class="cls_007">G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> and then computes the signature σ := (h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">)</span><span class="cls_004"><sup>x</sup></span><span class="cls_007"> ∈ G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">.  To verify that such a signature is</span></div>
<div style="position:absolute;left:90.00px;top:533.30px" class="cls_007"><span class="cls_007">valid, one must test if log</span><span class="cls_004"><sub>h</sub></span><span class="cls_008">′</span><span class="cls_007"> σ = log</span><span class="cls_004"><sub>g</sub></span><span class="cls_007"> V . To be able to perform this test efficiently, the BLS</span></div>
<div style="position:absolute;left:90.00px;top:545.83px" class="cls_007"><span class="cls_007">scheme uses the notion of a pairing on the groups G and G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">, which is a special algebraic</span></div>
<div style="position:absolute;left:90.00px;top:559.38px" class="cls_007"><span class="cls_007">tool that is available when G and G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> are elliptic curves of a special type. We shall not be</span></div>
<div style="position:absolute;left:90.00px;top:573.95px" class="cls_007"><span class="cls_007">able to go into the details of pairings and elliptic curves here. See [BLS01] for more details.</span></div>
<div style="position:absolute;left:90.00px;top:587.50px" class="cls_007"><span class="cls_007">BLS signatures have the nice property (mentioned above) that signatures are unique.</span></div>
<div style="position:absolute;left:106.94px;top:601.05px" class="cls_007"><span class="cls_007">In the t-out-of-n threshold setting, we have n replicas, any t of which may be used</span></div>
<div style="position:absolute;left:90.00px;top:614.60px" class="cls_007"><span class="cls_007">to generate a signature on a message.  On somewhat more detail, each replica P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  holds</span></div>
<div style="position:absolute;left:90.00px;top:628.14px" class="cls_007"><span class="cls_007">a share x</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007">  of the secret signing key x ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007"> , which is privately held by P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> , while</span></div>
<div style="position:absolute;left:90.00px;top:640.67px" class="cls_007"><span class="cls_007">the group element V</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  := g</span><span class="cls_004">x</span><span class="cls_008">j</span><span class="cls_007">  is publicly available. The shares (x</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, . . . , x</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">) are a t-out-of-n</span></div>
<div style="position:absolute;left:90.00px;top:655.24px" class="cls_007"><span class="cls_007">secret-sharing of x (see Section 3.4).</span></div>
<div style="position:absolute;left:106.94px;top:668.79px" class="cls_007"><span class="cls_007">Given a message m, replica P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  can generate a signature share</span></div>
<div style="position:absolute;left:265.08px;top:689.53px" class="cls_007"><span class="cls_007">σ</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> := (h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">)</span><span class="cls_004">x</span><span class="cls_008">j</span><span class="cls_007">  ∈ G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">,</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">18</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:14436px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background19.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:89.03px" class="cls_007"><span class="cls_007">where h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> := H</span><span class="cls_004"><sub>G</sub></span><span class="cls_008">′</span><span class="cls_007"> (m) as before. To verify that such a signature share is valid, one must test</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">if log</span><span class="cls_004"><sub>h</sub></span><span class="cls_008">′</span><span class="cls_007"> σ</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> = log</span><span class="cls_004"><sub>g</sub></span><span class="cls_007"> V</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> . This can be done using a pairing, as discussed above — in fact, this is</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">exactly the same as the validity test for an ordinary BLS signature with public key V</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> .</span></div>
<div style="position:absolute;left:106.94px;top:130.70px" class="cls_007"><span class="cls_007">This scheme satisfies the following reconstruction property:</span></div>
<div style="position:absolute;left:117.27px;top:153.05px" class="cls_007"><span class="cls_007">Given any collection of t valid signature shares σ</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  on a message m (contributed</span></div>
<div style="position:absolute;left:117.27px;top:166.60px" class="cls_007"><span class="cls_007">by distinct replicas), we can efficiently compute a valid BLS signature σ on m</span></div>
<div style="position:absolute;left:117.27px;top:180.14px" class="cls_007"><span class="cls_007">under the public verification key.</span></div>
<div style="position:absolute;left:117.27px;top:198.14px" class="cls_007"><span class="cls_007">In fact, σ can be computed as</span></div>
<div style="position:absolute;left:300.42px;top:213.33px" class="cls_007"><span class="cls_007">∏</span></div>
<div style="position:absolute;left:276.83px;top:220.50px" class="cls_007"><span class="cls_007">σ←   σ</span><span class="cls_004">λ</span><span class="cls_008">j</span><span class="cls_007">,</span></div>
<div style="position:absolute;left:480.79px;top:223.69px" class="cls_007"><span class="cls_007">(1)</span></div>
<div style="position:absolute;left:322.41px;top:229.89px" class="cls_004"><span class="cls_004">j</span></div>
<div style="position:absolute;left:305.45px;top:239.72px" class="cls_004"><span class="cls_004">j</span></div>
<div style="position:absolute;left:117.27px;top:258.75px" class="cls_007"><span class="cls_007">where the λ</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> ’s can be efficiently computed just from the indices of the t con-</span></div>
<div style="position:absolute;left:117.27px;top:272.30px" class="cls_007"><span class="cls_007">tributing replicas.</span></div>
<div style="position:absolute;left:106.94px;top:294.65px" class="cls_007"><span class="cls_007">Under reasonable intractability assumptions for G, and modeling H</span><span class="cls_004"><sub>G</sub></span><span class="cls_008">′</span><span class="cls_007">   as a random</span></div>
<div style="position:absolute;left:90.00px;top:308.20px" class="cls_007"><span class="cls_007">oracle, this scheme satisfies the following security property:</span></div>
<div style="position:absolute;left:117.27px;top:330.55px" class="cls_007"><span class="cls_007">Assume that at most f replicas may be corrupted by an adversary.  Then it is</span></div>
<div style="position:absolute;left:117.27px;top:344.10px" class="cls_007"><span class="cls_007">infeasible for the adversary to compute a valid signature on a message unless it</span></div>
<div style="position:absolute;left:117.27px;top:357.65px" class="cls_007"><span class="cls_007">obtains signature shares on that message from at least t − f honest replicas.</span></div>
<div style="position:absolute;left:90.00px;top:385.78px" class="cls_003"><span class="cls_003">3.2</span></div>
<div style="position:absolute;left:120.64px;top:385.78px" class="cls_003"><span class="cls_003">Distributed key distribution</span></div>
<div style="position:absolute;left:90.00px;top:407.42px" class="cls_007"><span class="cls_007">To implement threshold BLS, we need a way to distribute the shares of the secret signing</span></div>
<div style="position:absolute;left:90.00px;top:420.97px" class="cls_007"><span class="cls_007">key to the replicas.  One way to do this would be to have a trusted party compute all</span></div>
<div style="position:absolute;left:90.00px;top:434.52px" class="cls_007"><span class="cls_007">of these shares directly and distribute them to all the replicas.  Unfortunately, this would</span></div>
<div style="position:absolute;left:90.00px;top:448.07px" class="cls_007"><span class="cls_007">create a single point of failure.  Instead, we use a distributed key generation (DKG)</span></div>
<div style="position:absolute;left:90.00px;top:461.62px" class="cls_007"><span class="cls_007">protocol, which allows the replicas to essentially carry out the logic of such a trusted party</span></div>
<div style="position:absolute;left:90.00px;top:475.17px" class="cls_007"><span class="cls_007">using a secure distributed protocol.</span></div>
<div style="position:absolute;left:106.94px;top:488.72px" class="cls_007"><span class="cls_007">We sketch the high level ideas of the protocol currently implemented.  We refer the</span></div>
<div style="position:absolute;left:90.00px;top:502.27px" class="cls_007"><span class="cls_007">reader to [Gro21] for more details.  The DKG protocol used is essentially non-interactive.</span></div>
<div style="position:absolute;left:90.00px;top:515.82px" class="cls_007"><span class="cls_007">It uses two essential ingredients:</span></div>
<div style="position:absolute;left:106.39px;top:538.17px" class="cls_007"><span class="cls_007">• a publicly verifiable secret sharing (PVSS) scheme, and</span></div>
<div style="position:absolute;left:106.39px;top:560.62px" class="cls_007"><span class="cls_007">• a consensus protocol.</span></div>
<div style="position:absolute;left:90.00px;top:582.97px" class="cls_007"><span class="cls_007">Although any consensus protocol could be used, not surprisingly, the one we use is that in</span></div>
<div style="position:absolute;left:90.00px;top:596.52px" class="cls_007"><span class="cls_007">Section 5 (see also Section 8).</span></div>
<div style="position:absolute;left:90.00px;top:624.65px" class="cls_003"><span class="cls_003">3.3</span></div>
<div style="position:absolute;left:120.64px;top:624.65px" class="cls_003"><span class="cls_003">Assumptions</span></div>
<div style="position:absolute;left:90.00px;top:646.29px" class="cls_007"><span class="cls_007">The basic assumptions made are the same as outlined in Section 1:</span></div>
<div style="position:absolute;left:106.39px;top:668.64px" class="cls_007"><span class="cls_007">• asynchronous communication, and</span></div>
<div style="position:absolute;left:106.39px;top:691.09px" class="cls_007"><span class="cls_007">• f &lt; n/3.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">19</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:15238px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background20.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">We only indirectly make use of a partial synchrony assumption (as in Section 5.1) to ensure</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">that the consensus protocol attains liveness.</span></div>
<div style="position:absolute;left:106.94px;top:117.15px" class="cls_007"><span class="cls_007">We also assume that for a t-out-of-n threshold signature scheme, we have</span></div>
<div style="position:absolute;left:271.82px;top:141.22px" class="cls_007"><span class="cls_007">f &lt;t≤n−f,</span></div>
<div style="position:absolute;left:90.00px;top:165.30px" class="cls_007"><span class="cls_007">which (among other things) ensures that (1) the corrupt replicas cannot sign all by them-</span></div>
<div style="position:absolute;left:90.00px;top:178.85px" class="cls_007"><span class="cls_007">selves, and (2) the honest replicas can sign all by themselves.</span></div>
<div style="position:absolute;left:106.94px;top:192.40px" class="cls_007"><span class="cls_007">We also assume that every replica is associated with some public keys, where each replica</span></div>
<div style="position:absolute;left:90.00px;top:205.94px" class="cls_007"><span class="cls_007">also holds the corresponding private key. One public key is the signing key (the same one</span></div>
<div style="position:absolute;left:90.00px;top:219.49px" class="cls_007"><span class="cls_007">as in Section 5.4). Another public key is a public encryption key for a specific public-key</span></div>
<div style="position:absolute;left:90.00px;top:233.04px" class="cls_007"><span class="cls_007">encryption scheme needed to implement the PVSS scheme (details follow).</span></div>
<div style="position:absolute;left:90.00px;top:261.14px" class="cls_003"><span class="cls_003">3.4</span></div>
<div style="position:absolute;left:120.64px;top:261.14px" class="cls_003"><span class="cls_003">PVSS scheme</span></div>
<div style="position:absolute;left:90.00px;top:282.78px" class="cls_007"><span class="cls_007">Let G be the group of prime order q generated by g ∈ G introduced above. Let s ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007">  be</span></div>
<div style="position:absolute;left:90.00px;top:295.31px" class="cls_007"><span class="cls_007">a secret.  Recall that a t-out-of-n Shamir secret-sharing of s is a vector (s</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, . . . , s</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">) ∈ Z</span><span class="cls_004"><sup>n</sup></span></div>
<div style="position:absolute;left:513.33px;top:296.33px" class="cls_004"><span class="cls_004">q</span><span class="cls_007">,</span></div>
<div style="position:absolute;left:90.00px;top:309.88px" class="cls_007"><span class="cls_007">where</span></div>
<div style="position:absolute;left:243.98px;top:323.05px" class="cls_007"><span class="cls_007">s</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> := a(j)</span></div>
<div style="position:absolute;left:300.60px;top:323.43px" class="cls_007"><span class="cls_007">(j = 1, . . . , n).</span></div>
<div style="position:absolute;left:90.00px;top:343.24px" class="cls_007"><span class="cls_007">and</span></div>
<div style="position:absolute;left:208.24px;top:355.22px" class="cls_007"><span class="cls_007">a(x) := a</span><span class="cls_004"><sub>0</sub></span><span class="cls_007"> + a</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">x + · · · + a</span><span class="cls_004"><sub>t−1</sub></span><span class="cls_007">x</span><span class="cls_004"><sup>t−1</sup></span><span class="cls_007"> ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007"> [x]</span></div>
<div style="position:absolute;left:90.00px;top:376.22px" class="cls_007"><span class="cls_007">is a polynomial of degree less than t with a</span><span class="cls_004"><sub>0</sub></span><span class="cls_007">  := s.  The key properties of such a secret</span></div>
<div style="position:absolute;left:90.00px;top:390.15px" class="cls_007"><span class="cls_007">sharing are</span></div>
<div style="position:absolute;left:106.39px;top:412.30px" class="cls_007"><span class="cls_007">• from any collection of t of the s</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> ’s, we can efficiently compute (via polynomial inter-</span></div>
<div style="position:absolute;left:117.27px;top:425.85px" class="cls_007"><span class="cls_007">polation) the secret s = a</span><span class="cls_004"><sub>0</sub></span><span class="cls_007"> = a(0), and</span></div>
<div style="position:absolute;left:106.39px;top:448.22px" class="cls_007"><span class="cls_007">• if a</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, . . . , a</span><span class="cls_004"><sub>t−1</sub></span><span class="cls_007"> are chosen uniformly and independently over Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007"> , then any collection of</span></div>
<div style="position:absolute;left:117.27px;top:461.77px" class="cls_007"><span class="cls_007">fewer than t of the s</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> ’s reveals no information about the secret s.</span></div>
<div style="position:absolute;left:106.94px;top:483.92px" class="cls_007"><span class="cls_007">At a high level, a PVSS scheme allows one replica, P</span><span class="cls_004"><sub>i</sub></span><span class="cls_007">, called the dealer, to take such</span></div>
<div style="position:absolute;left:90.00px;top:497.47px" class="cls_007"><span class="cls_007">a sharing, and compute an object called a dealing, which contains</span></div>
<div style="position:absolute;left:106.39px;top:518.61px" class="cls_007"><span class="cls_007">• a vector of group elements (A</span><span class="cls_004"><sub>0</sub></span><span class="cls_007">,...,A</span><span class="cls_004"><sub>t−1</sub></span><span class="cls_007">), where A</span><span class="cls_004"><sub>k</sub></span><span class="cls_007"> := g</span><span class="cls_004">a</span><span class="cls_008">k</span><span class="cls_007"> for k = 0,...,t − 1,</span></div>
<div style="position:absolute;left:106.39px;top:542.00px" class="cls_007"><span class="cls_007">• a vector of ciphertexts (c</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">,...,c</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">), where c</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> is the encryption of s</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> under P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">’s public</span></div>
<div style="position:absolute;left:117.27px;top:555.55px" class="cls_007"><span class="cls_007">encryption key,</span></div>
<div style="position:absolute;left:106.39px;top:577.92px" class="cls_007"><span class="cls_007">• a non-interactive zero-knowledge proof π that each c</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> does indeed encrypt such a</span></div>
<div style="position:absolute;left:117.27px;top:591.47px" class="cls_007"><span class="cls_007">share — more precisely, that each c</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  decrypts the value s</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  satisfying</span></div>
<div style="position:absolute;left:298.10px;top:615.68px" class="cls_007"><span class="cls_007">∏</span></div>
<div style="position:absolute;left:268.89px;top:624.47px" class="cls_007"><span class="cls_007">g</span><span class="cls_004">s</span><span class="cls_008">j</span><span class="cls_007">  =</span></div>
<div style="position:absolute;left:314.61px;top:622.85px" class="cls_007"><span class="cls_007">A</span><span class="cls_004">j</span><span class="cls_008">k</span></div>
<div style="position:absolute;left:334.78px;top:624.47px" class="cls_007"><span class="cls_007">=g</span><span class="cls_004"><sup>a(j)</sup></span><span class="cls_007">.</span></div>
<div style="position:absolute;left:508.06px;top:626.04px" class="cls_007"><span class="cls_007">(2)</span></div>
<div style="position:absolute;left:322.79px;top:632.50px" class="cls_004"><span class="cls_004">k</span></div>
<div style="position:absolute;left:297.35px;top:642.33px" class="cls_004"><span class="cls_004">k=0</span></div>
<div style="position:absolute;left:106.94px;top:663.99px" class="cls_007"><span class="cls_007">We note that to establish the overall security of our DKG protocol, the PVSS scheme</span></div>
<div style="position:absolute;left:90.00px;top:677.54px" class="cls_007"><span class="cls_007">must provide an appropriate level of chosen ciphertext security.  Specifically, the dealer</span></div>
<div style="position:absolute;left:90.00px;top:691.09px" class="cls_007"><span class="cls_007">must embed its identity as associated data in the dealing, and the encrypted shares must</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">20</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:16040px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background21.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">remain hidden, even under a chosen ciphertext attack wherein an adversary is allowed to</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">decrypt arbitrary dealings which are decrypted under associated data that is distinct from</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">the associated data used to create the dealing.</span></div>
<div style="position:absolute;left:106.94px;top:130.70px" class="cls_007"><span class="cls_007">It is easy to realize a PVSS scheme, if one is not too concerned about efficiency.  The</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">idea is to use an ElGamal-like encryption scheme to encrypt each s</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> bit by bit, and then use</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">a standard non-interactive zero-knowledge proof for the relation (2), which would be based</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">on an a standard application of the Fiat-Shamir transform (see [FS86]) to an appropriate</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">Sigma protocol (see [CDS94]).  While this yields a polynomial-time scheme, it is not that</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">practical.  However, there are many possible ways to optimize this type of scheme.  See</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">[Gro21] for the details on the highly optimized PVSS scheme used in the IC.</span></div>
<div style="position:absolute;left:90.00px;top:240.16px" class="cls_003"><span class="cls_003">3.5</span></div>
<div style="position:absolute;left:120.64px;top:240.16px" class="cls_003"><span class="cls_003">The basic DKG protocol</span></div>
<div style="position:absolute;left:90.00px;top:261.80px" class="cls_007"><span class="cls_007">Using the PVSS scheme and a consensus protocol, the basic DKG protocol is very simple.</span></div>
<div style="position:absolute;left:103.33px;top:284.32px" class="cls_007"><span class="cls_007">1.</span></div>
<div style="position:absolute;left:117.27px;top:284.32px" class="cls_007"><span class="cls_007">Each replica broadcasts a signed dealing of a random secret to all other replicas.</span></div>
<div style="position:absolute;left:117.27px;top:302.35px" class="cls_007"><span class="cls_007">Such a signed dealing includes a dealing, along with the identity of the dealer and a</span></div>
<div style="position:absolute;left:117.27px;top:315.90px" class="cls_007"><span class="cls_007">signature on the dealing under the dealer’s public signing key.</span></div>
<div style="position:absolute;left:117.27px;top:333.93px" class="cls_007"><span class="cls_007">Such a signed dealing is called valid if it has the right syntactic form, and the signature</span></div>
<div style="position:absolute;left:117.27px;top:347.48px" class="cls_007"><span class="cls_007">and non-interactive zero knowledge proof are valid.</span></div>
<div style="position:absolute;left:103.33px;top:369.99px" class="cls_007"><span class="cls_007">2.</span></div>
<div style="position:absolute;left:117.27px;top:369.99px" class="cls_007"><span class="cls_007">Using consensus the replicas agree on a set S of f + 1 valid signed dealings (from</span></div>
<div style="position:absolute;left:117.27px;top:383.54px" class="cls_007"><span class="cls_007">distinct dealers).</span></div>
<div style="position:absolute;left:103.33px;top:406.06px" class="cls_007"><span class="cls_007">3.</span></div>
<div style="position:absolute;left:117.27px;top:406.06px" class="cls_007"><span class="cls_007">Suppose that the ith dealing in the set S contains the vector of group</span></div>
<div style="position:absolute;left:481.04px;top:406.06px" class="cls_007"><span class="cls_007">elements</span></div>
<div style="position:absolute;left:117.27px;top:419.61px" class="cls_007"><span class="cls_007">(A</span><span class="cls_004"><sub>i,0</sub></span><span class="cls_007">, . . . , A</span><span class="cls_004"><sub>i,t−1</sub></span><span class="cls_007">) and the vector of ciphertexts (c</span><span class="cls_004"><sub>i,1</sub></span><span class="cls_007">, . . . , c</span><span class="cls_004"><sub>i,n</sub></span><span class="cls_007">).</span></div>
<div style="position:absolute;left:117.27px;top:437.64px" class="cls_007"><span class="cls_007">Then the public verification key for the threshold signature scheme is</span></div>
<div style="position:absolute;left:313.99px;top:452.81px" class="cls_007"><span class="cls_007">∏</span></div>
<div style="position:absolute;left:288.35px;top:462.79px" class="cls_007"><span class="cls_007">V :=    A</span><span class="cls_004"><sub>i,0</sub></span><span class="cls_007">.</span></div>
<div style="position:absolute;left:319.51px;top:479.20px" class="cls_004"><span class="cls_004">i</span></div>
<div style="position:absolute;left:117.27px;top:501.36px" class="cls_007"><span class="cls_007">Note that the secret signing key is implicitly defined as</span></div>
<div style="position:absolute;left:292.73px;top:525.49px" class="cls_007"><span class="cls_007">x := log</span><span class="cls_004"><sub>g</sub></span><span class="cls_007"> V.</span></div>
<div style="position:absolute;left:117.27px;top:554.86px" class="cls_007"><span class="cls_007">P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">’s share of the secret signing key x is</span></div>
<div style="position:absolute;left:315.70px;top:571.09px" class="cls_007"><span class="cls_007">∑</span></div>
<div style="position:absolute;left:288.23px;top:581.08px" class="cls_007"><span class="cls_007">x</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> :=</span></div>
<div style="position:absolute;left:333.28px;top:581.46px" class="cls_007"><span class="cls_007">s</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007">,</span></div>
<div style="position:absolute;left:322.14px;top:597.48px" class="cls_004"><span class="cls_004">i</span></div>
<div style="position:absolute;left:117.27px;top:615.17px" class="cls_007"><span class="cls_007">where s</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007">  is the decryption of c</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007">  under P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> ’s secret decryption key.</span></div>
<div style="position:absolute;left:117.27px;top:633.20px" class="cls_007"><span class="cls_007">The public verification key for replica P</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  is</span></div>
<div style="position:absolute;left:291.49px;top:657.84px" class="cls_007"><span class="cls_007">∏</span></div>
<div style="position:absolute;left:308.00px;top:657.84px" class="cls_007"><span class="cls_007">∏</span></div>
<div style="position:absolute;left:263.89px;top:667.83px" class="cls_007"><span class="cls_007">V</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> :=</span></div>
<div style="position:absolute;left:324.51px;top:665.02px" class="cls_007"><span class="cls_007">A</span><span class="cls_004">j</span><span class="cls_008">k</span></div>
<div style="position:absolute;left:332.69px;top:666.64px" class="cls_004"><span class="cls_004">i,k</span><span class="cls_007"> =g</span><span class="cls_004">x</span><span class="cls_008">j</span><span class="cls_007"> .</span></div>
<div style="position:absolute;left:297.02px;top:684.23px" class="cls_004"><span class="cls_004">i  k=0</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">21</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:16842px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background22.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">Note that the shares x</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  comprise a t-out-of-n Shamir secret-sharing of x. As such, the</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">λ</span><span class="cls_004"><sub>j</sub></span><span class="cls_007">  values appearing in (1) are just Lagrange interpolation coefficients.  This establishes</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">the reconstruction property stated in Section 3.1.  As for the security property stated in</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">Section 3.1, this can be proved to hold modeling H</span><span class="cls_004"><sub>G</sub></span><span class="cls_008">′</span><span class="cls_007">  as a random oracle, and assuming</span></div>
<div style="position:absolute;left:90.00px;top:143.23px" class="cls_007"><span class="cls_007">that the PVSS scheme is secure, and that the groups G and G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  (with a pairing) satisfy a</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">certain type of one-more Diffie-Hellman hardness assumption, which can be stated as</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">saying that no efficient adversary can win the following game with non-negligible probability:</span></div>
<div style="position:absolute;left:117.27px;top:193.86px" class="cls_007"><span class="cls_007">The challenger chooses µ</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, . . . , µ</span><span class="cls_004"><sub>k</sub></span><span class="cls_007"> ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007"> and ν</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, . . . , ν</span><span class="cls_004"><sub>ℓ</sub></span><span class="cls_007"> ∈ Z</span><span class="cls_004"><sub>q</sub></span><span class="cls_007"> at random, and gives</span></div>
<div style="position:absolute;left:117.27px;top:206.39px" class="cls_007"><span class="cls_007">{g</span><span class="cls_004">µ</span><span class="cls_008">i</span><span class="cls_007"> }</span><span class="cls_004"><sup>k</sup></span></div>
<div style="position:absolute;left:142.53px;top:206.39px" class="cls_004"><span class="cls_004">i=1</span><span class="cls_007"> and{(g</span><span class="cls_004">′</span><span class="cls_007">)</span><span class="cls_004">ν</span><span class="cls_008">j</span><span class="cls_007"> }</span><span class="cls_004">j=1</span><span class="cls_007"> totheadversary.</span></div>
<div style="position:absolute;left:117.27px;top:225.44px" class="cls_007"><span class="cls_007">The adversary makes a sequence of queries to the challenger, each of which is a</span></div>
<div style="position:absolute;left:117.27px;top:238.99px" class="cls_007"><span class="cls_007">vector of the form {κ</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007"> }</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007"> , to which the challenger responds with</span></div>
<div style="position:absolute;left:266.14px;top:254.85px" class="cls_007"><span class="cls_007">∏(</span></div>
<div style="position:absolute;left:322.10px;top:254.85px" class="cls_007"><span class="cls_007">)</span><span class="cls_004">κ</span><span class="cls_008">i,j</span></div>
<div style="position:absolute;left:288.41px;top:265.39px" class="cls_007"><span class="cls_007">(g</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">)</span><span class="cls_004">µ</span><span class="cls_008">i</span><span class="cls_004">ν</span><span class="cls_008"><sup>j</sup></span></div>
<div style="position:absolute;left:268.55px;top:282.98px" class="cls_004"><span class="cls_004">i,j</span></div>
<div style="position:absolute;left:117.27px;top:307.30px" class="cls_007"><span class="cls_007">To end the game, the adversary outputs a vector {λ</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007"> }</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007">  and a group element</span></div>
<div style="position:absolute;left:117.27px;top:319.83px" class="cls_007"><span class="cls_007">h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> ∈ G</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">, and wins the game if</span></div>
<div style="position:absolute;left:279.43px;top:339.49px" class="cls_007"><span class="cls_007">∏(</span></div>
<div style="position:absolute;left:335.40px;top:337.74px" class="cls_007"><span class="cls_007">)</span><span class="cls_004">λ</span><span class="cls_008">i,j</span></div>
<div style="position:absolute;left:255.81px;top:348.29px" class="cls_007"><span class="cls_007">h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> =</span></div>
<div style="position:absolute;left:301.71px;top:348.29px" class="cls_007"><span class="cls_007">(g</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">)</span><span class="cls_004">µ</span><span class="cls_008">i</span><span class="cls_004">ν</span><span class="cls_008"><sup>j</sup></span></div>
<div style="position:absolute;left:281.85px;top:365.88px" class="cls_004"><span class="cls_004">i,j</span></div>
<div style="position:absolute;left:117.27px;top:385.72px" class="cls_007"><span class="cls_007">and the output vector {λ</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007"> }</span><span class="cls_004"><sub>i,j</sub></span><span class="cls_007">  is not a linear combination of the query vectors.</span></div>
<div style="position:absolute;left:106.94px;top:408.23px" class="cls_007"><span class="cls_007">While this type of one-more Diffie-Hellman assumption is needed in the case where</span></div>
<div style="position:absolute;left:90.00px;top:421.78px" class="cls_007"><span class="cls_007">t > f + 1, one can get by with a weaker assumption when t = f + 1 (the so-called co-CDH</span></div>
<div style="position:absolute;left:90.00px;top:435.33px" class="cls_007"><span class="cls_007">assumption, on which the security of the ordinary BLS scheme is based).</span></div>
<div style="position:absolute;left:90.00px;top:463.50px" class="cls_003"><span class="cls_003">3.6</span></div>
<div style="position:absolute;left:120.64px;top:463.50px" class="cls_003"><span class="cls_003">A resharing protocol</span></div>
<div style="position:absolute;left:90.00px;top:485.14px" class="cls_007"><span class="cls_007">The basic DKG protocol can be easily modified so that instead of creating a sharing of a</span></div>
<div style="position:absolute;left:90.00px;top:498.69px" class="cls_007"><span class="cls_007">fresh random secret x, it instead creates a fresh, random sharing of a previously shared</span></div>
<div style="position:absolute;left:90.00px;top:512.24px" class="cls_007"><span class="cls_007">secret.</span></div>
<div style="position:absolute;left:106.39px;top:534.75px" class="cls_007"><span class="cls_007">• Step 1 of the basic protocol is modified so that each replica broadcasts a signed dealing</span></div>
<div style="position:absolute;left:117.27px;top:548.30px" class="cls_007"><span class="cls_007">of its existing share.</span></div>
<div style="position:absolute;left:106.39px;top:570.82px" class="cls_007"><span class="cls_007">• Step 2 is modified so that a set of t valid signed dealings is agreed upon. Also, each</span></div>
<div style="position:absolute;left:117.27px;top:584.37px" class="cls_007"><span class="cls_007">dealing is verified to ensure that it is indeed a dealing of the appropriate existing share</span></div>
<div style="position:absolute;left:117.27px;top:597.92px" class="cls_007"><span class="cls_007">(this means that the value of A</span><span class="cls_004"><sub>i,0</sub></span><span class="cls_007"> in the ith dealing should be equal to the old value</span></div>
<div style="position:absolute;left:117.27px;top:611.47px" class="cls_007"><span class="cls_007">of V</span><span class="cls_004"><sub>i</sub></span><span class="cls_007">).</span></div>
<div style="position:absolute;left:106.39px;top:633.98px" class="cls_007"><span class="cls_007">• In Step 3, the computation of the new x</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> (and V</span><span class="cls_004"><sub>j</sub></span><span class="cls_007"> ) values weight the sum (and product)</span></div>
<div style="position:absolute;left:117.27px;top:647.53px" class="cls_007"><span class="cls_007">on i Lagrange interpolation coefficients.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">22</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:17644px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background23.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:86.61px" class="cls_006"><span class="cls_006">4</span></div>
<div style="position:absolute;left:114.21px;top:86.61px" class="cls_006"><span class="cls_006">Peer-to-peer layer</span></div>
<div style="position:absolute;left:90.00px;top:114.40px" class="cls_007"><span class="cls_007">The peer-to-peer layer’s task is to transport protocol messages between the replicas in a</span></div>
<div style="position:absolute;left:90.00px;top:127.95px" class="cls_007"><span class="cls_007">subnet. These protocol messages consist of</span></div>
<div style="position:absolute;left:106.39px;top:146.80px" class="cls_007"><span class="cls_007">• messages used to implement consensus, e.g., block proposals, notarizations, etc. (see</span></div>
<div style="position:absolute;left:117.27px;top:160.35px" class="cls_007"><span class="cls_007">Section 5);</span></div>
<div style="position:absolute;left:106.39px;top:181.40px" class="cls_007"><span class="cls_007">• ingress messages (see Section 6).</span></div>
<div style="position:absolute;left:90.00px;top:200.25px" class="cls_007"><span class="cls_007">Basically, the service provided by the peer-to-peer is a “best effort” broadcast channel:</span></div>
<div style="position:absolute;left:117.27px;top:219.11px" class="cls_007"><span class="cls_007">if an honest replica broadcasts a messages, then that message will eventually be</span></div>
<div style="position:absolute;left:117.27px;top:232.65px" class="cls_007"><span class="cls_007">received by all honest replicas in the subnet.</span></div>
<div style="position:absolute;left:106.94px;top:251.51px" class="cls_007"><span class="cls_007">Design goals include the following:</span></div>
<div style="position:absolute;left:106.39px;top:270.36px" class="cls_007"><span class="cls_007">• Bounded resources.  All algorithms must work with bounded resources (memory,</span></div>
<div style="position:absolute;left:117.27px;top:283.91px" class="cls_007"><span class="cls_007">bandwidth, CPU).</span></div>
<div style="position:absolute;left:106.39px;top:304.96px" class="cls_007"><span class="cls_007">• Prioritization. Different messages may be treated with different priorities, depend-</span></div>
<div style="position:absolute;left:117.27px;top:318.51px" class="cls_007"><span class="cls_007">ing on certain attributes (e.g., type, size, round), and these priorities may change over</span></div>
<div style="position:absolute;left:117.27px;top:332.06px" class="cls_007"><span class="cls_007">time.</span></div>
<div style="position:absolute;left:106.39px;top:353.11px" class="cls_007"><span class="cls_007">• Efficiency. High throughput is more important than low latency.</span></div>
<div style="position:absolute;left:106.39px;top:374.16px" class="cls_007"><span class="cls_007">• DOS/SPAM resilience. Corrupt replicas should prevent honest replicas from com-</span></div>
<div style="position:absolute;left:117.27px;top:387.71px" class="cls_007"><span class="cls_007">municating with one another.</span></div>
<div style="position:absolute;left:106.94px;top:406.56px" class="cls_007"><span class="cls_007">Observe that in the consensus protocol, some messages, notably block proposals (which</span></div>
<div style="position:absolute;left:90.00px;top:420.11px" class="cls_007"><span class="cls_007">can be quite large), will be rebroadcast by all replicas. This is necessary to ensure correct</span></div>
<div style="position:absolute;left:90.00px;top:433.66px" class="cls_007"><span class="cls_007">behavior of that protocol.  However, if implemented naively, this would be a huge waste</span></div>
<div style="position:absolute;left:90.00px;top:447.20px" class="cls_007"><span class="cls_007">of resources. To avoid having all replicas broadcasting the same message, the peer-to-peer</span></div>
<div style="position:absolute;left:90.00px;top:460.75px" class="cls_007"><span class="cls_007">layer makes use of an advertise-request-deliver mechanism.  Instead of broadcasting a</span></div>
<div style="position:absolute;left:90.00px;top:474.30px" class="cls_007"><span class="cls_007">(large) message directly, it will instead broadcast a (small) advertisement for the message:</span></div>
<div style="position:absolute;left:90.00px;top:487.85px" class="cls_007"><span class="cls_007">if a replica receives such an advertisement, has not already received, and deems the message</span></div>
<div style="position:absolute;left:90.00px;top:501.40px" class="cls_007"><span class="cls_007">to be important, it will request that the message is delivered.  This strategy decreases</span></div>
<div style="position:absolute;left:90.00px;top:514.95px" class="cls_007"><span class="cls_007">bandwidth utilization at the cost of higher latency.  For small messages, this trade-off is</span></div>
<div style="position:absolute;left:90.00px;top:528.50px" class="cls_007"><span class="cls_007">not worthwhile, and it makes more sense to just send the message directly, rather than an</span></div>
<div style="position:absolute;left:90.00px;top:542.05px" class="cls_007"><span class="cls_007">advertisement.</span></div>
<div style="position:absolute;left:106.94px;top:555.60px" class="cls_007"><span class="cls_007">For relatively small subnets, a replica that wishes to broadcast a message will send an</span></div>
<div style="position:absolute;left:90.00px;top:569.15px" class="cls_007"><span class="cls_007">advertisement to all replicas in the subnet, each of which may then request that the message</span></div>
<div style="position:absolute;left:90.00px;top:582.70px" class="cls_007"><span class="cls_007">is delivered. For larger subnets, this advertise-request-deliver mechanism may operate over</span></div>
<div style="position:absolute;left:90.00px;top:596.25px" class="cls_007"><span class="cls_007">an overlay network. An overlay network is a connected, undirected graph whose vertices</span></div>
<div style="position:absolute;left:90.00px;top:609.80px" class="cls_007"><span class="cls_007">comprise the replicas in a subnet.  Two replicas are peers if there is an edge connecting</span></div>
<div style="position:absolute;left:90.00px;top:623.34px" class="cls_007"><span class="cls_007">them in this graph, and replica only communicates with its peers. So when a replica wishes</span></div>
<div style="position:absolute;left:90.00px;top:636.89px" class="cls_007"><span class="cls_007">to broadcast a message, it sends an advertisement for that message to its peers.  Those</span></div>
<div style="position:absolute;left:90.00px;top:650.44px" class="cls_007"><span class="cls_007">peers may request that the message be delivered, and upon receiving the message, if certain</span></div>
<div style="position:absolute;left:90.00px;top:663.99px" class="cls_007"><span class="cls_007">conditions are met, those peers will advertise the message to their peers. This is essentially</span></div>
<div style="position:absolute;left:90.00px;top:677.54px" class="cls_007"><span class="cls_007">a gossip network. This strategy again decreases bandwidth utilization at the cost of even</span></div>
<div style="position:absolute;left:90.00px;top:691.09px" class="cls_007"><span class="cls_007">higher latency.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">23</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:18446px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background24.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:86.61px" class="cls_006"><span class="cls_006">5</span></div>
<div style="position:absolute;left:114.21px;top:86.61px" class="cls_006"><span class="cls_006">Consensus Layer</span></div>
<div style="position:absolute;left:90.00px;top:114.40px" class="cls_007"><span class="cls_007">The job of the consensus layer of the IC is to order inputs so that all replicas in a subnet</span></div>
<div style="position:absolute;left:90.00px;top:127.95px" class="cls_007"><span class="cls_007">will process such inputs in the same order. There are many protocols in the literature for</span></div>
<div style="position:absolute;left:90.00px;top:141.50px" class="cls_007"><span class="cls_007">this problem. The IC uses a new consensus protocol, which is described here at a high level.</span></div>
<div style="position:absolute;left:90.00px;top:154.03px" class="cls_007"><span class="cls_007">For more details, see the paper [CDH</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">21] (in particular, Protocol ICC1 in that paper).</span></div>
<div style="position:absolute;left:106.94px;top:168.60px" class="cls_007"><span class="cls_007">Any secure consensus protocol should guarantee two properties, which (roughly stated)</span></div>
<div style="position:absolute;left:90.00px;top:182.15px" class="cls_007"><span class="cls_007">are:</span></div>
<div style="position:absolute;left:106.39px;top:204.49px" class="cls_007"><span class="cls_007">• safety: all replicas in fact agree on the same ordering of inputs, and</span></div>
<div style="position:absolute;left:106.39px;top:226.94px" class="cls_007"><span class="cls_007">• liveness: all replicas should make steady progress.</span></div>
<div style="position:absolute;left:106.94px;top:248.26px" class="cls_007"><span class="cls_007">The paper [CDH</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">21] proves that the IC consensus protocol satisfies both of these prop-</span></div>
<div style="position:absolute;left:90.00px;top:262.83px" class="cls_007"><span class="cls_007">erties</span></div>
<div style="position:absolute;left:106.94px;top:276.38px" class="cls_007"><span class="cls_007">The IC consensus protocol is designed to be</span></div>
<div style="position:absolute;left:106.39px;top:298.72px" class="cls_007"><span class="cls_007">• extremely simple, and</span></div>
<div style="position:absolute;left:106.39px;top:321.17px" class="cls_007"><span class="cls_007">• robust: performance degrades gracefully when some replicas are malicious.</span></div>
<div style="position:absolute;left:90.00px;top:349.30px" class="cls_003"><span class="cls_003">5.1</span></div>
<div style="position:absolute;left:120.64px;top:349.30px" class="cls_003"><span class="cls_003">Assumptions</span></div>
<div style="position:absolute;left:90.00px;top:370.94px" class="cls_007"><span class="cls_007">As discussed in the introduction, we assume</span></div>
<div style="position:absolute;left:106.39px;top:393.29px" class="cls_007"><span class="cls_007">• a subnet of n replicas, and</span></div>
<div style="position:absolute;left:106.39px;top:415.73px" class="cls_007"><span class="cls_007">• at most f &lt; n/3 of the replicas are faulty.</span></div>
<div style="position:absolute;left:90.00px;top:438.08px" class="cls_007"><span class="cls_007">Faulty replicas may exhibit arbitrary, malicious (i.e., Byzantine) behavior.</span></div>
<div style="position:absolute;left:106.94px;top:451.63px" class="cls_007"><span class="cls_007">We assume that communication is asynchronous, with no a priori bound on the delay</span></div>
<div style="position:absolute;left:90.00px;top:465.18px" class="cls_007"><span class="cls_007">of messages sent between replicas.  In fact, the scheduling of message delivery may be</span></div>
<div style="position:absolute;left:90.00px;top:478.73px" class="cls_007"><span class="cls_007">completely under adversarial control.  The IC consensus protocol guarantees safety under</span></div>
<div style="position:absolute;left:90.00px;top:492.27px" class="cls_007"><span class="cls_007">this very weak communication assumption.  However, to guarantee liveness, we need to</span></div>
<div style="position:absolute;left:90.00px;top:505.82px" class="cls_007"><span class="cls_007">assume a form of partial synchrony, which (roughly stated) says that the network will</span></div>
<div style="position:absolute;left:90.00px;top:519.37px" class="cls_007"><span class="cls_007">be periodically synchronous for short intervals of time. In such intervals of synchrony, all</span></div>
<div style="position:absolute;left:90.00px;top:532.92px" class="cls_007"><span class="cls_007">undelivered messages will be delivered in less than time δ, for some fixed bound δ.  The</span></div>
<div style="position:absolute;left:90.00px;top:546.47px" class="cls_007"><span class="cls_007">bound δ does not have to be known in advance (the protocol is initialized with a reasonable</span></div>
<div style="position:absolute;left:90.00px;top:560.02px" class="cls_007"><span class="cls_007">bound, but will dynamically adapt and increase this bound if it is too small). Regardless of</span></div>
<div style="position:absolute;left:90.00px;top:573.57px" class="cls_007"><span class="cls_007">whether we are assuming an asynchronous or a partially synchronous network, we assume</span></div>
<div style="position:absolute;left:90.00px;top:587.12px" class="cls_007"><span class="cls_007">that every message sent from one honest replica to another will eventually be delivered.</span></div>
<div style="position:absolute;left:90.00px;top:615.25px" class="cls_003"><span class="cls_003">5.2</span></div>
<div style="position:absolute;left:120.64px;top:615.25px" class="cls_003"><span class="cls_003">Protocol overview</span></div>
<div style="position:absolute;left:90.00px;top:636.89px" class="cls_007"><span class="cls_007">Like a number of consensus protocols, the IC consensus protocol is based on a blockchain.</span></div>
<div style="position:absolute;left:90.00px;top:650.44px" class="cls_007"><span class="cls_007">As the protocol progresses, a tree of blocks is grown, starting from a special genesis block</span></div>
<div style="position:absolute;left:90.00px;top:663.99px" class="cls_007"><span class="cls_007">that is the root of the tree.  Each non-genesis block in the tree contains (among other</span></div>
<div style="position:absolute;left:90.00px;top:677.54px" class="cls_007"><span class="cls_007">things) a payload, consisting of a sequence of inputs, and a hash of the block’s parent in</span></div>
<div style="position:absolute;left:90.00px;top:691.09px" class="cls_007"><span class="cls_007">the tree.  The honest replicas have a consistent view of this tree:  while each replica may</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">24</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:19248px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background25.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">have a different, partial view of this tree, all the replicas have a view of the same tree. In</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">addition, as the protocol progresses, there is always a path of finalized blocks in this tree.</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">Again, the honest replicas have a consistent view of this path: while each replica may have</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">a different, partial view of this path, all the replicas have a view of the same path.  The</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">inputs in the payloads of the blocks along this path are the ordered inputs will be processed</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">by the execution layer of the Internet Computer (see Section 7).</span></div>
<div style="position:absolute;left:106.94px;top:171.34px" class="cls_007"><span class="cls_007">The protocol proceeds in rounds.  In round h of the protocol, one or more blocks of</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">height h are added to the tree.  That is, the blocks added in round h are always at a</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">distance of exactly h from the root.  In each round, a pseudo-random process is used to</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">assign each replica a unique rank, which is an integer in the range 0, . . . , n − 1.  This</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">pseudo-random process is implemented using a random beacon (see Section 5.5 below).</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">The replica of lowest rank is the leader of that round. When the leader is honest and the</span></div>
<div style="position:absolute;left:90.00px;top:252.64px" class="cls_007"><span class="cls_007">network is synchronous, the leader will propose a block, which will be added to the tree;</span></div>
<div style="position:absolute;left:90.00px;top:266.19px" class="cls_007"><span class="cls_007">moreover, this will be the only block added to the tree in this round and it will extend the</span></div>
<div style="position:absolute;left:90.00px;top:279.74px" class="cls_007"><span class="cls_007">finalized path.  If the leader is not honest or the network is not synchronous, some other</span></div>
<div style="position:absolute;left:90.00px;top:293.29px" class="cls_007"><span class="cls_007">replicas of higher rank may also propose blocks, and also have their blocks added to the</span></div>
<div style="position:absolute;left:90.00px;top:306.84px" class="cls_007"><span class="cls_007">tree.  In any case, the logic of the protocol gives highest priority to the leader’s proposed</span></div>
<div style="position:absolute;left:90.00px;top:320.39px" class="cls_007"><span class="cls_007">block and some block or blocks will be added to this tree in this round. Even if the protocol</span></div>
<div style="position:absolute;left:90.00px;top:333.93px" class="cls_007"><span class="cls_007">proceeds for a few rounds without extending the finalized path, the height of the tree will</span></div>
<div style="position:absolute;left:90.00px;top:347.48px" class="cls_007"><span class="cls_007">continue to grow with each round, so that when the finalized path is extended in round h,</span></div>
<div style="position:absolute;left:90.00px;top:361.03px" class="cls_007"><span class="cls_007">the finalized path will be of length h. A consequence of this, even if the latency occasionally</span></div>
<div style="position:absolute;left:90.00px;top:374.58px" class="cls_007"><span class="cls_007">increases because of faulty replicas or unexpectedly high network latency, the throughput of</span></div>
<div style="position:absolute;left:90.00px;top:388.13px" class="cls_007"><span class="cls_007">the protocol remains essentially constant.</span></div>
<div style="position:absolute;left:90.00px;top:416.30px" class="cls_003"><span class="cls_003">5.3</span></div>
<div style="position:absolute;left:120.64px;top:416.30px" class="cls_003"><span class="cls_003">Additional properties</span></div>
<div style="position:absolute;left:90.00px;top:437.94px" class="cls_007"><span class="cls_007">An additional property enjoyed by the IC consensus protocol (just like PBFT [CL99] and</span></div>
<div style="position:absolute;left:90.00px;top:450.47px" class="cls_007"><span class="cls_007">HotStuff [AMN</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">20], and unlike others, such as Tendermint [BKM18]) is optimistic respon-</span></div>
<div style="position:absolute;left:90.00px;top:465.04px" class="cls_007"><span class="cls_007">siveness [PS18], which means that when the leader is honest, the protocol may proceed at</span></div>
<div style="position:absolute;left:90.00px;top:478.59px" class="cls_007"><span class="cls_007">the pace of the actual network delay, rather than some upper bound on the network delay.</span></div>
<div style="position:absolute;left:106.94px;top:492.14px" class="cls_007"><span class="cls_007">We note that the simple design of the IC consensus protocol also ensures that its per-</span></div>
<div style="position:absolute;left:90.00px;top:505.69px" class="cls_007"><span class="cls_007">formance degrades quite gracefully when and if Byzantine failures actually do occur.  As</span></div>
<div style="position:absolute;left:90.00px;top:518.21px" class="cls_007"><span class="cls_007">pointed out in [CWA</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">09], much of the recent work on consensus has focused so much</span></div>
<div style="position:absolute;left:90.00px;top:532.78px" class="cls_007"><span class="cls_007">on improving the performance in the “optimistic case” where there are no failures, that</span></div>
<div style="position:absolute;left:90.00px;top:546.33px" class="cls_007"><span class="cls_007">the resulting protocols are dangerously fragile, and may become practically unusable when</span></div>
<div style="position:absolute;left:90.00px;top:558.86px" class="cls_007"><span class="cls_007">failures do occur. For example, [CWA</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">09] show that the throughput of existing implemen-</span></div>
<div style="position:absolute;left:90.00px;top:573.43px" class="cls_007"><span class="cls_007">tations of PBFT drops to zero under certain types of (quite simple) Byzantine behavior.</span></div>
<div style="position:absolute;left:90.00px;top:585.96px" class="cls_007"><span class="cls_007">The paper [CWA</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">09] advocates for robust consensus, in which peak performance under</span></div>
<div style="position:absolute;left:90.00px;top:600.53px" class="cls_007"><span class="cls_007">optimal conditions is partially sacrificed in order to ensure reasonable performance when</span></div>
<div style="position:absolute;left:90.00px;top:614.08px" class="cls_007"><span class="cls_007">some parties actually are corrupt (but still assuming the network is synchronous). The IC</span></div>
<div style="position:absolute;left:90.00px;top:626.61px" class="cls_007"><span class="cls_007">consesus protocols is indeed robust in the sense of [CWA</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">09]: in any round where the leader</span></div>
<div style="position:absolute;left:90.00px;top:641.18px" class="cls_007"><span class="cls_007">is corrupt (which itself happens with probability less than 1/3), the protocol will effectively</span></div>
<div style="position:absolute;left:90.00px;top:654.73px" class="cls_007"><span class="cls_007">allow another party to take over as leader for that round, with very little fuss, to move the</span></div>
<div style="position:absolute;left:90.00px;top:668.28px" class="cls_007"><span class="cls_007">protocol forward to the next round in a timely fashion.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">25</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:20050px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background26.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:89.00px" class="cls_003"><span class="cls_003">5.4</span></div>
<div style="position:absolute;left:120.64px;top:89.00px" class="cls_003"><span class="cls_003">Public keys</span></div>
<div style="position:absolute;left:90.00px;top:110.64px" class="cls_007"><span class="cls_007">To implement the protocol, each replica is associated with a public key for the BLS signature</span></div>
<div style="position:absolute;left:90.00px;top:124.19px" class="cls_007"><span class="cls_007">scheme [BLS01], and each replica also holds the corresponding secret signing key.  The</span></div>
<div style="position:absolute;left:90.00px;top:137.74px" class="cls_007"><span class="cls_007">association of replicas to public keys is obtained from the registry maintained by the NNS</span></div>
<div style="position:absolute;left:90.00px;top:151.29px" class="cls_007"><span class="cls_007">(see Section 1.5).  These BLS signatures will be used to authenticate messages sent by</span></div>
<div style="position:absolute;left:90.00px;top:164.84px" class="cls_007"><span class="cls_007">replicas.</span></div>
<div style="position:absolute;left:106.94px;top:178.39px" class="cls_007"><span class="cls_007">The protocol also uses the signature aggregation feature of BLS signatures [BGLS03],</span></div>
<div style="position:absolute;left:90.00px;top:191.94px" class="cls_007"><span class="cls_007">which allows many signatures on the same message to be aggregated into a compact multi-</span></div>
<div style="position:absolute;left:90.00px;top:205.49px" class="cls_007"><span class="cls_007">signature. The protocol will use these multi-signatures for notarizations (see Section 5.7)</span></div>
<div style="position:absolute;left:90.00px;top:219.04px" class="cls_007"><span class="cls_007">and finalizations (see Section 5.8), which are aggregations of n − f signatures on messages</span></div>
<div style="position:absolute;left:90.00px;top:232.59px" class="cls_007"><span class="cls_007">of a certain form.</span></div>
<div style="position:absolute;left:90.00px;top:260.75px" class="cls_003"><span class="cls_003">5.5</span></div>
<div style="position:absolute;left:120.64px;top:260.75px" class="cls_003"><span class="cls_003">Random Beacon</span></div>
<div style="position:absolute;left:90.00px;top:282.39px" class="cls_007"><span class="cls_007">In addition to BLS signatures and multi-signatures as discussed above, the protocol makes</span></div>
<div style="position:absolute;left:90.00px;top:295.94px" class="cls_007"><span class="cls_007">use of a BLS threshold signature scheme to implement the above-mentioned random beacon.</span></div>
<div style="position:absolute;left:90.00px;top:309.49px" class="cls_007"><span class="cls_007">The random beacon for height h is a (f + 1)-threshold signature on a message unique to</span></div>
<div style="position:absolute;left:90.00px;top:323.04px" class="cls_007"><span class="cls_007">height h. In each round of the protocol, each replica broadcasts its share of the beacon for</span></div>
<div style="position:absolute;left:90.00px;top:336.59px" class="cls_007"><span class="cls_007">the next round, so that when the next round begins, all replicas should have enough shares</span></div>
<div style="position:absolute;left:90.00px;top:350.14px" class="cls_007"><span class="cls_007">to reconstruct the beacon for that round. As discussed above, the random beacon at height</span></div>
<div style="position:absolute;left:90.00px;top:363.69px" class="cls_007"><span class="cls_007">h is used to assign a pseudo-random rank to each replica that will be used in round h of</span></div>
<div style="position:absolute;left:90.00px;top:377.24px" class="cls_007"><span class="cls_007">the protocol.  Because of the security properties of the threshold signature, an adversary</span></div>
<div style="position:absolute;left:90.00px;top:390.79px" class="cls_007"><span class="cls_007">will not be able to predict the ranking of the replicas more than one round in advance,</span></div>
<div style="position:absolute;left:90.00px;top:404.34px" class="cls_007"><span class="cls_007">and these rankings will effectively be as good as random.  See Section 3 for more on BLS</span></div>
<div style="position:absolute;left:90.00px;top:417.89px" class="cls_007"><span class="cls_007">threshold signatures.</span></div>
<div style="position:absolute;left:90.00px;top:446.05px" class="cls_003"><span class="cls_003">5.6</span></div>
<div style="position:absolute;left:120.64px;top:446.05px" class="cls_003"><span class="cls_003">Block making</span></div>
<div style="position:absolute;left:90.00px;top:467.69px" class="cls_007"><span class="cls_007">Each replica may at different points in time play the role of a block maker.  As a block</span></div>
<div style="position:absolute;left:90.00px;top:480.22px" class="cls_007"><span class="cls_007">maker in round h, the replica proposes a block B of height h that to be child of a block B</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:90.00px;top:494.79px" class="cls_007"><span class="cls_007">of height h − 1 in the tree of blocks.  To do this, the block maker first gathers together a</span></div>
<div style="position:absolute;left:90.00px;top:508.34px" class="cls_007"><span class="cls_007">payload consisting of all inputs it knows about (but not including those already included</span></div>
<div style="position:absolute;left:90.00px;top:520.87px" class="cls_007"><span class="cls_007">in payloads in blocks in the path through the tree ending at B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">). The block B consists of</span></div>
<div style="position:absolute;left:106.39px;top:544.41px" class="cls_007"><span class="cls_007">• the payload,</span></div>
<div style="position:absolute;left:106.39px;top:565.90px" class="cls_007"><span class="cls_007">• the hash of B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">,</span></div>
<div style="position:absolute;left:106.39px;top:589.44px" class="cls_007"><span class="cls_007">• the rank of the block maker,</span></div>
<div style="position:absolute;left:106.39px;top:611.95px" class="cls_007"><span class="cls_007">• the height h of the block.</span></div>
<div style="position:absolute;left:106.94px;top:634.47px" class="cls_007"><span class="cls_007">After forming the block B, the block maker forms a block proposal, consisting of</span></div>
<div style="position:absolute;left:106.39px;top:656.98px" class="cls_007"><span class="cls_007">• the block B,</span></div>
<div style="position:absolute;left:106.39px;top:679.50px" class="cls_007"><span class="cls_007">• the block maker’s identity, and</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">26</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:20852px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background27.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.39px;top:90.05px" class="cls_007"><span class="cls_007">• the block maker’s signature on B.</span></div>
<div style="position:absolute;left:106.94px;top:112.56px" class="cls_007"><span class="cls_007">A block maker will broadcast its block proposal to all other replicas.</span></div>
<div style="position:absolute;left:90.00px;top:140.73px" class="cls_003"><span class="cls_003">5.7</span></div>
<div style="position:absolute;left:120.64px;top:140.73px" class="cls_003"><span class="cls_003">Notarization</span></div>
<div style="position:absolute;left:90.00px;top:162.37px" class="cls_007"><span class="cls_007">A block is effectively added to the tree of blocks when it becomes notarized. For a block</span></div>
<div style="position:absolute;left:90.00px;top:175.92px" class="cls_007"><span class="cls_007">to become notarized, n − f distinct replicas must support its notarization.</span></div>
<div style="position:absolute;left:106.94px;top:189.47px" class="cls_007"><span class="cls_007">Given a proposed block B at height h, a replica will determine if the proposal is valid,</span></div>
<div style="position:absolute;left:90.00px;top:203.02px" class="cls_007"><span class="cls_007">which means that B has the syntactic form described above.  In particular, B should</span></div>
<div style="position:absolute;left:90.00px;top:215.55px" class="cls_007"><span class="cls_007">contain the hash of a block B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> of height h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> that is already in the tree of blocks (i.e., already</span></div>
<div style="position:absolute;left:90.00px;top:230.12px" class="cls_007"><span class="cls_007">notarized).  In addition, the payload of B must satisfy certain conditions (in particular,</span></div>
<div style="position:absolute;left:90.00px;top:243.67px" class="cls_007"><span class="cls_007">all of the inputs in the payload must satisfy various constraints, but these constraints are</span></div>
<div style="position:absolute;left:90.00px;top:257.22px" class="cls_007"><span class="cls_007">generally independent of the consensus protocol).  Also, the rank of the block maker (as</span></div>
<div style="position:absolute;left:90.00px;top:270.77px" class="cls_007"><span class="cls_007">recorded in the block B) must match the rank assigned in round h by the random beacon</span></div>
<div style="position:absolute;left:90.00px;top:284.32px" class="cls_007"><span class="cls_007">to the replica that proposed the block (as recorded in the block proposal) .</span></div>
<div style="position:absolute;left:106.94px;top:297.86px" class="cls_007"><span class="cls_007">If the block is valid and certain other constraints hold, the replica will support the</span></div>
<div style="position:absolute;left:90.00px;top:311.41px" class="cls_007"><span class="cls_007">notarization of the block by broadcasting a notarization share for B, consisting of</span></div>
<div style="position:absolute;left:106.39px;top:333.93px" class="cls_007"><span class="cls_007">• the hash of B,</span></div>
<div style="position:absolute;left:106.39px;top:356.44px" class="cls_007"><span class="cls_007">• the height h of B,</span></div>
<div style="position:absolute;left:106.39px;top:378.96px" class="cls_007"><span class="cls_007">• the identity of the supporting replica, and</span></div>
<div style="position:absolute;left:106.39px;top:401.48px" class="cls_007"><span class="cls_007">• the supporting replica’s signature on a message comprising the hash of B and the</span></div>
<div style="position:absolute;left:117.27px;top:415.03px" class="cls_007"><span class="cls_007">height h.</span></div>
<div style="position:absolute;left:106.94px;top:437.54px" class="cls_007"><span class="cls_007">Any set of n − f notarization shares on B may be aggregated together to form a nota-</span></div>
<div style="position:absolute;left:90.00px;top:451.09px" class="cls_007"><span class="cls_007">rization for B, consisting of</span></div>
<div style="position:absolute;left:106.39px;top:473.61px" class="cls_007"><span class="cls_007">• the hash of B,</span></div>
<div style="position:absolute;left:106.39px;top:496.12px" class="cls_007"><span class="cls_007">• the height h of B,</span></div>
<div style="position:absolute;left:106.39px;top:518.64px" class="cls_007"><span class="cls_007">• the set of identities of the n − f supporting replicas,</span></div>
<div style="position:absolute;left:106.39px;top:541.15px" class="cls_007"><span class="cls_007">• an aggregation of the n − f signatures on the message comprising the hash of B and</span></div>
<div style="position:absolute;left:117.27px;top:554.70px" class="cls_007"><span class="cls_007">the height h.</span></div>
<div style="position:absolute;left:106.94px;top:577.22px" class="cls_007"><span class="cls_007">As soon as a replica obtains a notarized block of height h, it will finish round h, and will</span></div>
<div style="position:absolute;left:90.00px;top:590.77px" class="cls_007"><span class="cls_007">subsequently not support the notarization of any other blocks at height h.  At this point</span></div>
<div style="position:absolute;left:90.00px;top:604.32px" class="cls_007"><span class="cls_007">in time, such a replica will also relay this notarization to all other replicas. Note that this</span></div>
<div style="position:absolute;left:90.00px;top:617.86px" class="cls_007"><span class="cls_007">replica may have obtained the notarization either by (1) receiving it from another replica,</span></div>
<div style="position:absolute;left:90.00px;top:631.41px" class="cls_007"><span class="cls_007">or (2) aggregating n − f notarization shares that it has received.</span></div>
<div style="position:absolute;left:106.94px;top:644.96px" class="cls_007"><span class="cls_007">The growth invariant states that each honest replica will eventually complete each</span></div>
<div style="position:absolute;left:90.00px;top:658.51px" class="cls_007"><span class="cls_007">round and start the next, so that the tree of notarized blocks continues to grow (and this</span></div>
<div style="position:absolute;left:90.00px;top:672.06px" class="cls_007"><span class="cls_007">holds only assuming asynchronous eventual delivery, and not partial synchrony). We prove</span></div>
<div style="position:absolute;left:90.00px;top:685.61px" class="cls_007"><span class="cls_007">the growth invariant below (see Section 5.11.4).</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">27</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:21654px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background28.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:89.00px" class="cls_003"><span class="cls_003">5.8</span></div>
<div style="position:absolute;left:120.64px;top:89.00px" class="cls_003"><span class="cls_003">Finalization</span></div>
<div style="position:absolute;left:90.00px;top:110.64px" class="cls_007"><span class="cls_007">There may be more than one notarized block at a given height h.  However, if a block is</span></div>
<div style="position:absolute;left:90.00px;top:124.19px" class="cls_007"><span class="cls_007">finalized, then we can be sure that there is no other notarized block at height h. Let us</span></div>
<div style="position:absolute;left:90.00px;top:137.74px" class="cls_007"><span class="cls_007">call this the safety invariant.</span></div>
<div style="position:absolute;left:106.94px;top:151.29px" class="cls_007"><span class="cls_007">For a block to become finalized, n − f distinct replicas must support its finalization.</span></div>
<div style="position:absolute;left:90.00px;top:164.84px" class="cls_007"><span class="cls_007">Recall that round h ends for a replica when it obtains a notarized block B of height h. At</span></div>
<div style="position:absolute;left:90.00px;top:178.39px" class="cls_007"><span class="cls_007">that point in time, such a replica will check if it supported the notarization of any block</span></div>
<div style="position:absolute;left:90.00px;top:191.94px" class="cls_007"><span class="cls_007">at height h other than block B (it may or may not have supported the notarization of B</span></div>
<div style="position:absolute;left:90.00px;top:205.49px" class="cls_007"><span class="cls_007">itself). If not, the replica will support the finalization of B by broadcasting a finalization</span></div>
<div style="position:absolute;left:90.00px;top:219.04px" class="cls_007"><span class="cls_007">share for B.  A finalization share has exactly the same format as a notarization share</span></div>
<div style="position:absolute;left:90.00px;top:232.59px" class="cls_007"><span class="cls_007">(but is tagged in such a way notarization shares and finalization shares cannot be confused</span></div>
<div style="position:absolute;left:90.00px;top:246.14px" class="cls_007"><span class="cls_007">with one another). Any set of n − f finalization shares on B may be aggregated together</span></div>
<div style="position:absolute;left:90.00px;top:259.69px" class="cls_007"><span class="cls_007">to form a finalization for B, which has exactly the same format as a notarization (but</span></div>
<div style="position:absolute;left:90.00px;top:273.23px" class="cls_007"><span class="cls_007">again, is appropriately tagged).  Any replica that obtains a finalized block will broadcast</span></div>
<div style="position:absolute;left:90.00px;top:286.78px" class="cls_007"><span class="cls_007">the finalization to all other replicas.</span></div>
<div style="position:absolute;left:106.94px;top:300.33px" class="cls_007"><span class="cls_007">We prove the safety invariant below (see Section 5.11.5). One consequence of the safety</span></div>
<div style="position:absolute;left:90.00px;top:312.86px" class="cls_007"><span class="cls_007">invariant is the following. Suppose two blocks B and B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> are finalized, where B has height h,</span></div>
<div style="position:absolute;left:90.00px;top:326.41px" class="cls_007"><span class="cls_007">B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> has height h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> ≤ h. Then the safety invariant implies that the path in the tree of notarized</span></div>
<div style="position:absolute;left:90.00px;top:339.96px" class="cls_007"><span class="cls_007">blocks ending at B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  is a prefix of the path ending at B (if not, then there would be two</span></div>
<div style="position:absolute;left:90.00px;top:353.51px" class="cls_007"><span class="cls_007">notarized blocks at height h</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">, contradicting the finalization invariant).  Thus, whenever</span></div>
<div style="position:absolute;left:90.00px;top:368.08px" class="cls_007"><span class="cls_007">a replica sees a finalized block B, it may view all ancestors of B as being implicitly</span></div>
<div style="position:absolute;left:90.00px;top:381.63px" class="cls_007"><span class="cls_007">finalized, and because of the safety invariant, the safety property is guaranteed to hold for</span></div>
<div style="position:absolute;left:90.00px;top:395.18px" class="cls_007"><span class="cls_007">these (explicitly and implicitly) finalized blocks — that is, all replicas agree on the ordering</span></div>
<div style="position:absolute;left:90.00px;top:408.73px" class="cls_007"><span class="cls_007">of these finalized blocks.</span></div>
<div style="position:absolute;left:90.00px;top:436.89px" class="cls_003"><span class="cls_003">5.9</span></div>
<div style="position:absolute;left:120.64px;top:436.89px" class="cls_003"><span class="cls_003">Delay functions</span></div>
<div style="position:absolute;left:90.00px;top:458.53px" class="cls_007"><span class="cls_007">The protocol makes use of two delay functions, Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">  and Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">, which control the timing</span></div>
<div style="position:absolute;left:90.00px;top:472.08px" class="cls_007"><span class="cls_007">of block making and notarization activity.  Both of these functions map the rank r of the</span></div>
<div style="position:absolute;left:90.00px;top:485.63px" class="cls_007"><span class="cls_007">proposing replica to a nonnegative delay amount, and it is assumed that each function</span></div>
<div style="position:absolute;left:90.00px;top:499.18px" class="cls_007"><span class="cls_007">is monotonely increasing in r, and that Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(r) ≤ Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(r) for all r = 0, . . . , n − 1.  The</span></div>
<div style="position:absolute;left:90.00px;top:512.73px" class="cls_007"><span class="cls_007">recommended definition of these functions is Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(r) = 2δr and Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(r) = 2δr + ϵ, where δ is</span></div>
<div style="position:absolute;left:90.00px;top:526.28px" class="cls_007"><span class="cls_007">an upper bound on the time to deliver messages from one honest replica to another, and</span></div>
<div style="position:absolute;left:90.00px;top:539.83px" class="cls_007"><span class="cls_007">ϵ ≥ 0 is a “governor” to keep the protocol from running too fast. With these definitions,</span></div>
<div style="position:absolute;left:90.00px;top:553.38px" class="cls_007"><span class="cls_007">liveness will be ensured in those rounds in which (1) the leader is honest, and (2) messages</span></div>
<div style="position:absolute;left:90.00px;top:566.93px" class="cls_007"><span class="cls_007">really are delivered between honest replicas within time δ. Indeed, if (1) and (2) both hold</span></div>
<div style="position:absolute;left:90.00px;top:580.48px" class="cls_007"><span class="cls_007">in a given round, then the block proposed by the leader in that round will be finalized. Let</span></div>
<div style="position:absolute;left:90.00px;top:594.03px" class="cls_007"><span class="cls_007">us call this the liveness invariant. We prove this below (see Section 5.11.6).</span></div>
<div style="position:absolute;left:90.00px;top:622.19px" class="cls_003"><span class="cls_003">5.10</span></div>
<div style="position:absolute;left:127.36px;top:622.19px" class="cls_003"><span class="cls_003">An example</span></div>
<div style="position:absolute;left:90.00px;top:643.83px" class="cls_007"><span class="cls_007">Figure 2 illustrates a block tree. Each block is labeled with its height (30, 31, 32, . . . ) and</span></div>
<div style="position:absolute;left:90.00px;top:657.38px" class="cls_007"><span class="cls_007">the rank of its block maker. The figure also shows that each block in the tree is notarized,</span></div>
<div style="position:absolute;left:191.47px;top:670.93px" class="cls_011"><span class="cls_011">N</span><span class="cls_007">   symbol.  This means that for each notarized block in the tree, at</span></div>
<div style="position:absolute;left:90.00px;top:684.48px" class="cls_007"><span class="cls_007">least n − f distinct replicas supported its notarization. As one can see, there can be more</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">28</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:22456px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background29.jpg" width=612 height=792></div>
<div style="position:absolute;left:336.85px;top:109.25px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:381.90px;top:109.27px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:426.94px;top:109.25px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:471.99px;top:109.51px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:201.72px;top:128.87px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:246.76px;top:128.38px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:291.81px;top:128.47px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:335.31px;top:135.42px" class="cls_012"><span class="cls_012">34</span></div>
<div style="position:absolute;left:380.35px;top:135.45px" class="cls_012"><span class="cls_012">35</span></div>
<div style="position:absolute;left:425.40px;top:135.42px" class="cls_012"><span class="cls_012">36</span></div>
<div style="position:absolute;left:470.27px;top:135.42px" class="cls_012"><span class="cls_012">37</span></div>
<div style="position:absolute;left:330.19px;top:145.08px" class="cls_013"><span class="cls_013">Rank 1</span></div>
<div style="position:absolute;left:375.24px;top:145.10px" class="cls_013"><span class="cls_013">Rank 0</span></div>
<div style="position:absolute;left:420.28px;top:145.08px" class="cls_013"><span class="cls_013">Rank 0</span></div>
<div style="position:absolute;left:465.15px;top:145.08px" class="cls_013"><span class="cls_013">Rank 0</span></div>
<div style="position:absolute;left:156.67px;top:154.68px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:200.17px;top:155.05px" class="cls_012"><span class="cls_012">31</span></div>
<div style="position:absolute;left:245.22px;top:154.55px" class="cls_012"><span class="cls_012">32</span></div>
<div style="position:absolute;left:290.26px;top:154.67px" class="cls_012"><span class="cls_012">33</span></div>
<div style="position:absolute;left:195.06px;top:164.70px" class="cls_013"><span class="cls_013">Rank 1</span></div>
<div style="position:absolute;left:240.10px;top:164.21px" class="cls_013"><span class="cls_013">Rank 0</span></div>
<div style="position:absolute;left:285.15px;top:164.32px" class="cls_013"><span class="cls_013">Rank 0</span></div>
<div style="position:absolute;left:337.30px;top:167.45px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:427.45px;top:168.60px" class="cls_012"><span class="cls_012">F</span></div>
<div style="position:absolute;left:114.49px;top:178.42px" class="cls_014"><span class="cls_014">…</span></div>
<div style="position:absolute;left:155.13px;top:180.82px" class="cls_012"><span class="cls_012">30</span></div>
<div style="position:absolute;left:150.01px;top:190.47px" class="cls_013"><span class="cls_013">Rank 0</span></div>
<div style="position:absolute;left:335.75px;top:193.75px" class="cls_012"><span class="cls_012">34</span></div>
<div style="position:absolute;left:201.72px;top:198.35px" class="cls_012"><span class="cls_012">N</span></div>
<div style="position:absolute;left:330.64px;top:203.40px" class="cls_013"><span class="cls_013">Rank 2</span></div>
<div style="position:absolute;left:200.17px;top:224.65px" class="cls_012"><span class="cls_012">31</span></div>
<div style="position:absolute;left:195.06px;top:234.30px" class="cls_013"><span class="cls_013">Rank 2</span></div>
<div style="position:absolute;left:219.95px;top:278.53px" class="cls_007"><span class="cls_007">Figure 2: An example tree of blocks</span></div>
<div style="position:absolute;left:90.00px;top:311.54px" class="cls_007"><span class="cls_007">than one notarized block in the tree at a given height.  For example, at height 32, we see</span></div>
<div style="position:absolute;left:90.00px;top:325.09px" class="cls_007"><span class="cls_007">there are two notarized blocks, one proposed by block makers of rank 1 and 2. The same</span></div>
<div style="position:absolute;left:90.00px;top:338.64px" class="cls_007"><span class="cls_007">thing happens at height 34.  We can also see that the block at height 36 is also explicitly</span></div>
<div style="position:absolute;left:233.93px;top:352.18px" class="cls_011"><span class="cls_011">F</span><span class="cls_007">  symbol. This means that n − f distinct replicas supported</span></div>
<div style="position:absolute;left:90.00px;top:365.73px" class="cls_007"><span class="cls_007">this block’s finalization, which means that these replicas (or at least, the honest replicas</span></div>
<div style="position:absolute;left:90.00px;top:379.28px" class="cls_007"><span class="cls_007">among these) did not support the notarization of any other block. All of the ancestors of</span></div>
<div style="position:absolute;left:90.00px;top:392.83px" class="cls_007"><span class="cls_007">this block, which are shaded gray, are considered implicitly finalized.</span></div>
<div style="position:absolute;left:90.00px;top:421.00px" class="cls_003"><span class="cls_003">5.11</span></div>
<div style="position:absolute;left:127.36px;top:421.00px" class="cls_003"><span class="cls_003">Putting it all together</span></div>
<div style="position:absolute;left:90.00px;top:442.64px" class="cls_007"><span class="cls_007">We now describe in more detail how the protocol works; specifically, we describe more</span></div>
<div style="position:absolute;left:90.00px;top:456.19px" class="cls_007"><span class="cls_007">precisely when a replica will propose a block and when a replica will support the notarization</span></div>
<div style="position:absolute;left:90.00px;top:469.74px" class="cls_007"><span class="cls_007">of a block. A given replica P will record the time at which it enters a given round h, which</span></div>
<div style="position:absolute;left:90.00px;top:483.29px" class="cls_007"><span class="cls_007">happens when it has obtained (1) some notarization for a block of height h − 1, and (2) the</span></div>
<div style="position:absolute;left:90.00px;top:496.84px" class="cls_007"><span class="cls_007">random beacon for round h. Since the random beacon for round h has been determined, P</span></div>
<div style="position:absolute;left:90.00px;top:510.39px" class="cls_007"><span class="cls_007">can determine its own rank r</span><span class="cls_004"><sub>P</sub></span><span class="cls_007"> , as well as the rank r</span><span class="cls_004"><sub>Q</sub></span><span class="cls_007"> of each other replica Q for round h.</span></div>
<div style="position:absolute;left:90.00px;top:539.20px" class="cls_007"><span class="cls_007">5.11.1</span></div>
<div style="position:absolute;left:134.61px;top:539.20px" class="cls_007"><span class="cls_007">Random beacon details</span></div>
<div style="position:absolute;left:90.00px;top:559.79px" class="cls_007"><span class="cls_007">As soon as a replica has received the random beacon for round h, or enough shares to</span></div>
<div style="position:absolute;left:90.00px;top:573.34px" class="cls_007"><span class="cls_007">contruct the random beacon for round h, it will relay the random beacom for round h to all</span></div>
<div style="position:absolute;left:90.00px;top:586.89px" class="cls_007"><span class="cls_007">other replicas. As soon as a replica enters round h, it will generate and broadcast its share</span></div>
<div style="position:absolute;left:90.00px;top:600.44px" class="cls_007"><span class="cls_007">of the random beacon at round h + 1.</span></div>
<div style="position:absolute;left:90.00px;top:629.26px" class="cls_007"><span class="cls_007">5.11.2</span></div>
<div style="position:absolute;left:134.61px;top:629.26px" class="cls_007"><span class="cls_007">Block making details</span></div>
<div style="position:absolute;left:90.00px;top:649.85px" class="cls_007"><span class="cls_007">Replica P  will only propose its own block B</span><span class="cls_004"><sub>P</sub></span><span class="cls_007">  provided (1) at least Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(r</span><span class="cls_004"><sub>P</sub></span><span class="cls_007"> ) time units</span></div>
<div style="position:absolute;left:90.00px;top:663.40px" class="cls_007"><span class="cls_007">have passed since the beginning of the round, and (2) there is no valid lower ranked block</span></div>
<div style="position:absolute;left:90.00px;top:676.95px" class="cls_007"><span class="cls_007">currently seen by P .</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">29</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:23258px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background30.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">Note that since P  is guaranteed to have a notarized block of height h − 1 when it</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">enters round h, it can make its proposed block a child of this notarized block (or any other</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">notarized block of height h − 1 that it may have).  Also note that when p broadcasts its</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">proposal for B</span><span class="cls_004"><sub>P</sub></span><span class="cls_007"> , it must also ensure that it also has relayed the notarization of B</span><span class="cls_004"><sub>P</sub></span><span class="cls_007"> ’s parent</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">to all replicas.</span></div>
<div style="position:absolute;left:106.94px;top:157.80px" class="cls_007"><span class="cls_007">Suppose a replica Q sees a valid block proposal from a replica P of rank r</span><span class="cls_004"><sub>P</sub></span><span class="cls_007">  &lt; r</span><span class="cls_004"><sub>Q</sub></span><span class="cls_007"> such</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">that (1) at least Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(r</span><span class="cls_004"><sub>P</sub></span><span class="cls_007"> ) time units have passed since the beginning of the round, and (2)</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">there is no block of rank less than r</span><span class="cls_004"><sub>P</sub></span><span class="cls_007">  currently seen by Q. Then at this point in time, if it</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">has not already done so, Q will relay this block proposal (along with the notarization of the</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">proposed block’s parent) to all other replicas.</span></div>
<div style="position:absolute;left:90.00px;top:240.81px" class="cls_007"><span class="cls_007">5.11.3</span></div>
<div style="position:absolute;left:134.61px;top:240.81px" class="cls_007"><span class="cls_007">Notarization details</span></div>
<div style="position:absolute;left:90.00px;top:261.40px" class="cls_007"><span class="cls_007">Replica P will support the notarization of a valid block B</span><span class="cls_004"><sub>Q</sub></span><span class="cls_007"> proposed by a replica Q of rank</span></div>
<div style="position:absolute;left:90.00px;top:274.95px" class="cls_007"><span class="cls_007">r</span><span class="cls_004"><sub>Q</sub></span><span class="cls_007"> provided (1) at least Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(r</span><span class="cls_004"><sub>Q</sub></span><span class="cls_007">) time units have passed since the beginning of the round,</span></div>
<div style="position:absolute;left:90.00px;top:288.50px" class="cls_007"><span class="cls_007">and (2) there is no block of rank less than r</span><span class="cls_004"><sub>Q</sub></span><span class="cls_007"> currently seen by P .</span></div>
<div style="position:absolute;left:90.00px;top:317.31px" class="cls_007"><span class="cls_007">5.11.4</span></div>
<div style="position:absolute;left:134.61px;top:317.31px" class="cls_007"><span class="cls_007">Proof of growth invariant</span></div>
<div style="position:absolute;left:90.00px;top:337.91px" class="cls_007"><span class="cls_007">The growth invariant states that each honest replica will eventually complete each round</span></div>
<div style="position:absolute;left:90.00px;top:350.44px" class="cls_007"><span class="cls_007">and start the next. Assume that all honest replicas have started round h. Let r</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> be the rank</span></div>
<div style="position:absolute;left:90.00px;top:363.99px" class="cls_007"><span class="cls_007">of the lowest ranked honest replica P</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007">  in round h.  Eventually, P</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007">  will either (1) propose</span></div>
<div style="position:absolute;left:90.00px;top:378.56px" class="cls_007"><span class="cls_007">its own block, or (2) relay a valid block proposed by a lower ranked replica. In either case,</span></div>
<div style="position:absolute;left:90.00px;top:392.11px" class="cls_007"><span class="cls_007">some block must eventually be supported by all honest replicas, which means that some</span></div>
<div style="position:absolute;left:90.00px;top:405.65px" class="cls_007"><span class="cls_007">block will become notarized and all honest replicas will finish round h. All honest replicas</span></div>
<div style="position:absolute;left:90.00px;top:419.20px" class="cls_007"><span class="cls_007">will also receive the shares needed to construct the random beacon for round h + 1, and so</span></div>
<div style="position:absolute;left:90.00px;top:432.75px" class="cls_007"><span class="cls_007">will start round h + 1.</span></div>
<div style="position:absolute;left:90.00px;top:461.57px" class="cls_007"><span class="cls_007">5.11.5</span></div>
<div style="position:absolute;left:134.61px;top:461.57px" class="cls_007"><span class="cls_007">Proof of safety invariant</span></div>
<div style="position:absolute;left:90.00px;top:482.16px" class="cls_007"><span class="cls_007">The safety invariant states that if a block is finalized in a given round, then no other</span></div>
<div style="position:absolute;left:90.00px;top:495.71px" class="cls_007"><span class="cls_007">block may be notarized in that round. Here is a proof of the safety invariant:</span></div>
<div style="position:absolute;left:103.33px;top:517.21px" class="cls_007"><span class="cls_007">1. Suppose that the number of corrupt replicas is exactly f</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> ≤ f &lt; n/3.</span></div>
<div style="position:absolute;left:103.33px;top:540.74px" class="cls_007"><span class="cls_007">2. If a block B is finalized, then its finalization must have been supported by a set S of</span></div>
<div style="position:absolute;left:117.27px;top:553.27px" class="cls_007"><span class="cls_007">at least n − f − f</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> honest replicas (by the security property for aggregate signatures).</span></div>
<div style="position:absolute;left:103.33px;top:575.79px" class="cls_007"><span class="cls_007">3. Suppose (by way of contradiction) that another block B</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> = B were notarized. Then</span></div>
<div style="position:absolute;left:117.27px;top:589.34px" class="cls_007"><span class="cls_007">its notarization must have been supported by a set S</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  of at least n − f − f</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007">  honest</span></div>
<div style="position:absolute;left:117.27px;top:603.91px" class="cls_007"><span class="cls_007">replicas (again, by the security property for aggregate signatures).</span></div>
<div style="position:absolute;left:103.33px;top:625.40px" class="cls_007"><span class="cls_007">4. The sets S and S</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> are disjoint (by the finalization logic).</span></div>
<div style="position:absolute;left:103.33px;top:647.92px" class="cls_007"><span class="cls_007">5. Therefore, n − f</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> ≥ |S ∪ S</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">| = |S| + |S</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">| ≥ 2(n − f − f</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007">), which implies n ≤ 3f , a</span></div>
<div style="position:absolute;left:117.27px;top:662.49px" class="cls_007"><span class="cls_007">contradiction.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">30</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:24060px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background31.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">5.11.6</span></div>
<div style="position:absolute;left:134.61px;top:90.05px" class="cls_007"><span class="cls_007">Proof of liveness invariant</span></div>
<div style="position:absolute;left:90.00px;top:110.64px" class="cls_007"><span class="cls_007">We say that the network is δ-synchronous at time t if all messages that have been sent</span></div>
<div style="position:absolute;left:90.00px;top:124.19px" class="cls_007"><span class="cls_007">by honest replicas at or before time t arrive at their destinations before time t.</span></div>
<div style="position:absolute;left:106.94px;top:137.74px" class="cls_007"><span class="cls_007">The liveness invariant may be stated as follows. Suppose that Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(1) ≥ Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0) + 2δ.</span></div>
<div style="position:absolute;left:90.00px;top:151.29px" class="cls_007"><span class="cls_007">Also suppose that in a given round h, we have</span></div>
<div style="position:absolute;left:106.39px;top:173.81px" class="cls_007"><span class="cls_007">• the leader P in round h is honest,</span></div>
<div style="position:absolute;left:106.39px;top:196.32px" class="cls_007"><span class="cls_007">• the first honest replica Q to enter round h does so at time t, and</span></div>
<div style="position:absolute;left:106.39px;top:218.84px" class="cls_007"><span class="cls_007">• the network is δ-synchronous at times t and t + δ + Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0).</span></div>
<div style="position:absolute;left:90.00px;top:241.35px" class="cls_007"><span class="cls_007">Then the block proposed by P in round h will be finalized.</span></div>
<div style="position:absolute;left:106.94px;top:254.90px" class="cls_007"><span class="cls_007">Here is a proof of the liveness invariant:</span></div>
<div style="position:absolute;left:103.33px;top:277.42px" class="cls_007"><span class="cls_007">1. Under partial synchrony at time t, all honest replicas will enter round h before time</span></div>
<div style="position:absolute;left:117.27px;top:290.97px" class="cls_007"><span class="cls_007">t+δ (the notarization that ended round h−1 for Q as well as the random beacon for</span></div>
<div style="position:absolute;left:117.27px;top:304.52px" class="cls_007"><span class="cls_007">round h random will arrive at all honest replicas before this time).</span></div>
<div style="position:absolute;left:103.33px;top:327.03px" class="cls_007"><span class="cls_007">2. The leader P in round h will propose a block B before time t + δ + Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0), and again</span></div>
<div style="position:absolute;left:117.27px;top:340.58px" class="cls_007"><span class="cls_007">by partial synchrony, this block proposal will be delivered to all other replicas before</span></div>
<div style="position:absolute;left:117.27px;top:354.13px" class="cls_007"><span class="cls_007">time t + 2δ + Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0).</span></div>
<div style="position:absolute;left:103.33px;top:376.65px" class="cls_007"><span class="cls_007">3. Since Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(1) ≥ Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0) + 2δ, the protocol logic guarantees that each honest replica</span></div>
<div style="position:absolute;left:117.27px;top:390.20px" class="cls_007"><span class="cls_007">supports the notarization of block B and no other block, and thus B will become</span></div>
<div style="position:absolute;left:117.27px;top:403.74px" class="cls_007"><span class="cls_007">notarized and finalized.</span></div>
<div style="position:absolute;left:90.00px;top:431.91px" class="cls_003"><span class="cls_003">5.12</span></div>
<div style="position:absolute;left:127.36px;top:431.91px" class="cls_003"><span class="cls_003">Other issues</span></div>
<div style="position:absolute;left:90.00px;top:453.55px" class="cls_007"><span class="cls_007">5.12.1</span></div>
<div style="position:absolute;left:134.61px;top:453.55px" class="cls_007"><span class="cls_007">Growth latency</span></div>
<div style="position:absolute;left:90.00px;top:474.15px" class="cls_007"><span class="cls_007">Under a partial synchrony assumption, we can also formulate and prove a quantitative</span></div>
<div style="position:absolute;left:90.00px;top:487.70px" class="cls_007"><span class="cls_007">version of the growth invariant. For simplicity, assume that the delay functions are defined</span></div>
<div style="position:absolute;left:90.00px;top:501.25px" class="cls_007"><span class="cls_007">as recommended above: Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(r) = 2δr and Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(r) = 2δr + ϵ, and further assume that ϵ ≤ δ.</span></div>
<div style="position:absolute;left:90.00px;top:514.79px" class="cls_007"><span class="cls_007">Suppose that at time t, the highest numbered round entered by any honest replica is h. Let</span></div>
<div style="position:absolute;left:90.00px;top:527.32px" class="cls_007"><span class="cls_007">r</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> be the rank of the lowest ranked honest replica P</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> in round h.  Finally, suppose that</span></div>
<div style="position:absolute;left:90.00px;top:540.87px" class="cls_007"><span class="cls_007">the network is δ-synchronous at all times in the interval [t, t + (3r</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> + 2)δ]. Then all honest</span></div>
<div style="position:absolute;left:90.00px;top:554.42px" class="cls_007"><span class="cls_007">replicas will start round h + 1 before time t + 3(r</span><span class="cls_004"><sup>∗</sup></span><span class="cls_007"> + 1)δ.</span></div>
<div style="position:absolute;left:90.00px;top:584.26px" class="cls_007"><span class="cls_007">5.12.2</span></div>
<div style="position:absolute;left:134.61px;top:584.26px" class="cls_007"><span class="cls_007">Locally adjusted delay functions</span></div>
<div style="position:absolute;left:90.00px;top:604.85px" class="cls_007"><span class="cls_007">When a replica does not see any finalized blocks for several rounds, it will start increasing</span></div>
<div style="position:absolute;left:90.00px;top:618.40px" class="cls_007"><span class="cls_007">its own delay function Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007"> for notarization. Replicas need not agree on these locally adjusted</span></div>
<div style="position:absolute;left:90.00px;top:631.95px" class="cls_007"><span class="cls_007">notarization delay functions.</span></div>
<div style="position:absolute;left:106.94px;top:645.50px" class="cls_007"><span class="cls_007">Also, while replicas do not explicitly adjust the delay function Δ</span><span class="cls_004"><sub>p</sub></span><span class="cls_007">, we can mathemati-</span></div>
<div style="position:absolute;left:90.00px;top:659.05px" class="cls_007"><span class="cls_007">cally model local clock drift by locally adjusting both delay functions.</span></div>
<div style="position:absolute;left:106.94px;top:672.60px" class="cls_007"><span class="cls_007">Thus, there are many delay functions, parameterized by replica and round. The critical</span></div>
<div style="position:absolute;left:90.00px;top:686.15px" class="cls_007"><span class="cls_007">condition Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(1) ≥ Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0) + 2δ needed for liveness then becomes max Δ</span><span class="cls_004"><sub>n</sub></span><span class="cls_007">(1) ≥ min Δ</span><span class="cls_004"><sub>m</sub></span><span class="cls_007">(0) +</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">31</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:24862px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background32.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">2δ, where the max and min are taken over all the honest replicas in a given round. Thus,</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">if finalization fails for enough rounds, all honest replicas will eventually increase their no-</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">tarization delay until this holds and finalization will then resume. If some honest replicas</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">increase their notarization latency function more than other replicas, there is no penalty in</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">terms of liveness (but there may be in terms of growth latency).</span></div>
<div style="position:absolute;left:90.00px;top:172.77px" class="cls_007"><span class="cls_007">5.12.3</span></div>
<div style="position:absolute;left:134.61px;top:172.77px" class="cls_007"><span class="cls_007">Fairness</span></div>
<div style="position:absolute;left:90.00px;top:193.36px" class="cls_007"><span class="cls_007">Another property that is important in consensus protocols is fairness. Rather than give a</span></div>
<div style="position:absolute;left:90.00px;top:206.91px" class="cls_007"><span class="cls_007">general definition, we simply observe that the liveness invariant also implies a useful fairness</span></div>
<div style="position:absolute;left:90.00px;top:220.46px" class="cls_007"><span class="cls_007">property. Recall that the liveness invariant basically says that in any round where the leader</span></div>
<div style="position:absolute;left:90.00px;top:234.01px" class="cls_007"><span class="cls_007">is honest and the network is synchronous, then the block proposed by the leader will be</span></div>
<div style="position:absolute;left:90.00px;top:247.56px" class="cls_007"><span class="cls_007">finalized.  In those rounds where this happens, the fact that the leader is honest ensures</span></div>
<div style="position:absolute;left:90.00px;top:261.11px" class="cls_007"><span class="cls_007">that it will include in the payload of its block all of the inputs it knows about (modulo</span></div>
<div style="position:absolute;left:90.00px;top:274.66px" class="cls_007"><span class="cls_007">limits on the payload size).  So, very roughly speaking, any input that is disseminated to</span></div>
<div style="position:absolute;left:90.00px;top:288.21px" class="cls_007"><span class="cls_007">enough replicas will be included in a finalized block in a reasonable amount of time with</span></div>
<div style="position:absolute;left:90.00px;top:301.76px" class="cls_007"><span class="cls_007">high probability.</span></div>
<div style="position:absolute;left:90.00px;top:332.40px" class="cls_006"><span class="cls_006">6</span></div>
<div style="position:absolute;left:114.21px;top:332.40px" class="cls_006"><span class="cls_006">Message Routing Layer</span></div>
<div style="position:absolute;left:90.00px;top:360.19px" class="cls_007"><span class="cls_007">As discussed in Section 1.7, basic computational unit in the IC is called a canister, which</span></div>
<div style="position:absolute;left:90.00px;top:373.74px" class="cls_007"><span class="cls_007">is roughly the same as the notion of a process, in that it comprises both a program and its</span></div>
<div style="position:absolute;left:90.00px;top:387.29px" class="cls_007"><span class="cls_007">state.  The IC provides a run-time environment for executing programs in a canister, and</span></div>
<div style="position:absolute;left:90.00px;top:400.84px" class="cls_007"><span class="cls_007">to communicate with other canisters and external users (via message passing).</span></div>
<div style="position:absolute;left:106.94px;top:414.39px" class="cls_007"><span class="cls_007">The consensus layer (see Section 5) bundles inputs into payloads, which get placed</span></div>
<div style="position:absolute;left:90.00px;top:427.94px" class="cls_007"><span class="cls_007">into blocks, and as blocks are finalized, the corresponding payloads are delivered to the</span></div>
<div style="position:absolute;left:90.00px;top:441.48px" class="cls_007"><span class="cls_007">message routing layer, then processed by the execution environment, which updates</span></div>
<div style="position:absolute;left:90.00px;top:455.03px" class="cls_007"><span class="cls_007">the state of the canisters on the replicated state machine and generates outputs, and these</span></div>
<div style="position:absolute;left:90.00px;top:468.58px" class="cls_007"><span class="cls_007">outputs are processed by the message routing layer.</span></div>
<div style="position:absolute;left:106.94px;top:482.13px" class="cls_007"><span class="cls_007">It is useful to distinguish between two types of inputs:</span></div>
<div style="position:absolute;left:90.00px;top:503.10px" class="cls_007"><span class="cls_007">ingress messages: these are messages from external users;</span></div>
<div style="position:absolute;left:90.00px;top:525.00px" class="cls_007"><span class="cls_007">cross-subnet messages: these are messages from canisters on other subnets.</span></div>
<div style="position:absolute;left:90.00px;top:545.96px" class="cls_007"><span class="cls_007">We can also distinguish between two types of outputs:</span></div>
<div style="position:absolute;left:90.00px;top:566.93px" class="cls_007"><span class="cls_007">ingress message responses: these are responses to ingress messages (which may be re-</span></div>
<div style="position:absolute;left:117.27px;top:580.48px" class="cls_007"><span class="cls_007">trieved by external users);</span></div>
<div style="position:absolute;left:90.00px;top:602.38px" class="cls_007"><span class="cls_007">cross-subnet messages: these are messages to canisters on other subnets.</span></div>
<div style="position:absolute;left:106.94px;top:623.34px" class="cls_007"><span class="cls_007">Upon receiving a payload from consensus, the inputs in that payload are placed into</span></div>
<div style="position:absolute;left:90.00px;top:636.89px" class="cls_007"><span class="cls_007">various input queues.  For each canister C running on a subnet, there are several in-</span></div>
<div style="position:absolute;left:90.00px;top:649.42px" class="cls_007"><span class="cls_007">put queues:  one for ingress messages to C, and for each other canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  with whom C</span></div>
<div style="position:absolute;left:90.00px;top:662.97px" class="cls_007"><span class="cls_007">communicates, one for cross-subnet messages to C from C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">.</span></div>
<div style="position:absolute;left:106.94px;top:677.54px" class="cls_007"><span class="cls_007">As described below in more detail, in a each round, the execution layer will consume</span></div>
<div style="position:absolute;left:90.00px;top:691.09px" class="cls_007"><span class="cls_007">some of the inputs in these queues, update the replicated state of the relevant canisters, and</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">32</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:25664px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background33.jpg" width=612 height=792></div>
<div style="position:absolute;left:266.02px;top:117.27px" class="cls_016"><span class="cls_016">Message Routing Layer</span></div>
<div style="position:absolute;left:445.62px;top:130.39px" class="cls_016"><span class="cls_016">Stream to subnet 2</span></div>
<div style="position:absolute;left:279.20px;top:137.34px" class="cls_016"><span class="cls_016">Execution Layer</span></div>
<div style="position:absolute;left:445.98px;top:160.74px" class="cls_016"><span class="cls_016">Stream to subnet 3</span></div>
<div style="position:absolute;left:243.45px;top:169.17px" class="cls_019"><span class="cls_019">Canister 1</span></div>
<div style="position:absolute;left:350.13px;top:177.60px" class="cls_018"><span class="cls_018">Canister 3</span></div>
<div style="position:absolute;left:104.14px;top:187.52px" class="cls_015"><span class="cls_015">Finalized Blocks</span></div>
<div style="position:absolute;left:279.66px;top:211.64px" class="cls_020"><span class="cls_020">Canister 2</span></div>
<div style="position:absolute;left:446.36px;top:220.90px" class="cls_016"><span class="cls_016">Stream to subnet </span><span class="cls_017">N</span></div>
<div style="position:absolute;left:104.19px;top:269.71px" class="cls_016"><span class="cls_016">Take inputs from finalized blocks</span></div>
<div style="position:absolute;left:253.18px;top:269.71px" class="cls_016"><span class="cls_016">Take input messages from input</span></div>
<div style="position:absolute;left:405.07px;top:269.71px" class="cls_016"><span class="cls_016">Take messages from output</span></div>
<div style="position:absolute;left:107.13px;top:278.57px" class="cls_016"><span class="cls_016">and put them into input queues</span></div>
<div style="position:absolute;left:256.12px;top:278.57px" class="cls_016"><span class="cls_016">queues, execute them and put</span></div>
<div style="position:absolute;left:415.07px;top:278.57px" class="cls_016"><span class="cls_016">queues, route them to</span></div>
<div style="position:absolute;left:115.20px;top:287.43px" class="cls_016"><span class="cls_016">of the respective canisters</span></div>
<div style="position:absolute;left:243.22px;top:287.43px" class="cls_016"><span class="cls_016">produced messages in output queues</span></div>
<div style="position:absolute;left:408.02px;top:287.43px" class="cls_016"><span class="cls_016">subnet-to-subnet streams</span></div>
<div style="position:absolute;left:193.06px;top:328.36px" class="cls_007"><span class="cls_007">Figure 3: Message routing and execution layers</span></div>
<div style="position:absolute;left:90.00px;top:361.37px" class="cls_007"><span class="cls_007">place outputs in various output queues. For each canister C running on a subnet, there</span></div>
<div style="position:absolute;left:90.00px;top:373.89px" class="cls_007"><span class="cls_007">are several output queues: for each other canister C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007"> with whom C communicates, one for</span></div>
<div style="position:absolute;left:90.00px;top:387.44px" class="cls_007"><span class="cls_007">cross-subnet messages to C</span><span class="cls_004"><sup>′</sup></span><span class="cls_007">  from C. The message routing layer will take the messages in</span></div>
<div style="position:absolute;left:90.00px;top:402.01px" class="cls_007"><span class="cls_007">these output queues and place them into subnet-to-subnet streams to be processed by</span></div>
<div style="position:absolute;left:90.00px;top:415.56px" class="cls_007"><span class="cls_007">an crossnet transfer protocol, whose job it is to actually transport these messages to</span></div>
<div style="position:absolute;left:90.00px;top:429.11px" class="cls_007"><span class="cls_007">other subnets.</span></div>
<div style="position:absolute;left:106.94px;top:442.66px" class="cls_007"><span class="cls_007">In addition to these output queues, there is also an ingress history data structure.</span></div>
<div style="position:absolute;left:90.00px;top:456.21px" class="cls_007"><span class="cls_007">Once an ingress message has been processed by a canister, a response to that ingress</span></div>
<div style="position:absolute;left:90.00px;top:469.76px" class="cls_007"><span class="cls_007">message will be recorded in this data structure.  At that point, the external user who</span></div>
<div style="position:absolute;left:90.00px;top:483.31px" class="cls_007"><span class="cls_007">provided the ingress message will be able to retrieve the corresponding response.</span></div>
<div style="position:absolute;left:495.03px;top:483.31px" class="cls_007"><span class="cls_007">(Note</span></div>
<div style="position:absolute;left:90.00px;top:496.86px" class="cls_007"><span class="cls_007">that ingress history does not maintain the full history of all ingress messages.)</span></div>
<div style="position:absolute;left:106.94px;top:510.41px" class="cls_007"><span class="cls_007">We also should mention that in addition to cross-subnet messages, there are also intra-</span></div>
<div style="position:absolute;left:90.00px;top:523.96px" class="cls_007"><span class="cls_007">subnet messages, which are messages from one canister to another on the same subnet.</span></div>
<div style="position:absolute;left:90.00px;top:537.50px" class="cls_007"><span class="cls_007">The message routing layer moves such messages directly from output queues to correspond-</span></div>
<div style="position:absolute;left:90.00px;top:551.05px" class="cls_007"><span class="cls_007">ing input queues.</span></div>
<div style="position:absolute;left:106.94px;top:564.60px" class="cls_007"><span class="cls_007">Figure 3 illustrates the basic functionality of the message routing and execution layers.</span></div>
<div style="position:absolute;left:106.94px;top:578.15px" class="cls_007"><span class="cls_007">Note that the replicated state comprises the the state of the canisters, as well as “system</span></div>
<div style="position:absolute;left:90.00px;top:591.70px" class="cls_007"><span class="cls_007">state”, including the above-mentioned queues and streams, as well as the ingress history data</span></div>
<div style="position:absolute;left:90.00px;top:605.25px" class="cls_007"><span class="cls_007">structure.  Thus, both the message routing and execution layers are involved in updating</span></div>
<div style="position:absolute;left:90.00px;top:618.80px" class="cls_007"><span class="cls_007">and maintaining the replicated state of a subnet.  It is essential that all of this state is</span></div>
<div style="position:absolute;left:90.00px;top:632.35px" class="cls_007"><span class="cls_007">updated in a completely deterministic fashion, so that all replicas maintain exactly the</span></div>
<div style="position:absolute;left:90.00px;top:645.90px" class="cls_007"><span class="cls_007">same state.</span></div>
<div style="position:absolute;left:106.94px;top:659.45px" class="cls_007"><span class="cls_007">Also note that the consensus layer is decoupled from the message routing and execution</span></div>
<div style="position:absolute;left:90.00px;top:673.00px" class="cls_007"><span class="cls_007">layers, in the sense that any forks in the consensus blockchain are resolved before their</span></div>
<div style="position:absolute;left:90.00px;top:686.55px" class="cls_007"><span class="cls_007">payloads are passed to message routing, and in fact, consensus does not have to keep in</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">33</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:26466px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background34.jpg" width=612 height=792></div>
<div style="position:absolute;left:231.68px;top:122.41px" class="cls_021"><span class="cls_021">canisters</span></div>
<div style="position:absolute;left:257.08px;top:137.21px" class="cls_021"><span class="cls_021">ingress history</span></div>
<div style="position:absolute;left:316.28px;top:139.22px" class="cls_021"><span class="cls_021">streams</span></div>
<div style="position:absolute;left:182.88px;top:182.85px" class="cls_021"><span class="cls_021">c</span><span class="cls_022"><sub>1</sub></span></div>
<div style="position:absolute;left:204.48px;top:185.65px" class="cls_021"><span class="cls_021">c</span><span class="cls_022"><sub>2</sub></span></div>
<div style="position:absolute;left:269.88px;top:185.05px" class="cls_021"><span class="cls_021">req</span><span class="cls_022"><sub>1</sub></span></div>
<div style="position:absolute;left:290.28px;top:187.55px" class="cls_021"><span class="cls_021">req</span><span class="cls_022"><sub>2</sub></span></div>
<div style="position:absolute;left:347.88px;top:189.31px" class="cls_021"><span class="cls_021">subnet</span><span class="cls_022"><sub>1</sub></span></div>
<div style="position:absolute;left:377.48px;top:193.81px" class="cls_021"><span class="cls_021">subnet</span><span class="cls_022"><sub>2</sub></span></div>
<div style="position:absolute;left:177.21px;top:276.75px" class="cls_007"><span class="cls_007">Figure 4: Per-round certified state organized as a tree</span></div>
<div style="position:absolute;left:90.00px;top:308.11px" class="cls_007"><span class="cls_007">lock step with message routing and consensus and is allowed to run a bit ahead.</span></div>
<div style="position:absolute;left:90.00px;top:335.89px" class="cls_003"><span class="cls_003">6.1</span></div>
<div style="position:absolute;left:120.64px;top:335.89px" class="cls_003"><span class="cls_003">Per-round certified state</span></div>
<div style="position:absolute;left:90.00px;top:357.53px" class="cls_007"><span class="cls_007">In each round, some of the state of a subnet will be certified.  The per-round certified</span></div>
<div style="position:absolute;left:90.00px;top:371.08px" class="cls_007"><span class="cls_007">state is certified using chain-key cryptography (see Section 1.6), specifically, using the</span></div>
<div style="position:absolute;left:90.00px;top:384.63px" class="cls_007"><span class="cls_007">(n − f )-out-of-n threshold signature scheme mentioned in Section 3. In more detail, after</span></div>
<div style="position:absolute;left:90.00px;top:398.18px" class="cls_007"><span class="cls_007">each replica generates the per-round certified state for a given round, it will generate a</span></div>
<div style="position:absolute;left:90.00px;top:411.73px" class="cls_007"><span class="cls_007">share of the corresponding threshold signature and broadcast this to all other replicas in its</span></div>
<div style="position:absolute;left:90.00px;top:425.28px" class="cls_007"><span class="cls_007">subnet. Upon collecting n−f such shares, each replica can construct the resulting threshold</span></div>
<div style="position:absolute;left:90.00px;top:438.83px" class="cls_007"><span class="cls_007">signature, which serves as the certificate for the per-round certified state for that round.</span></div>
<div style="position:absolute;left:90.00px;top:452.37px" class="cls_007"><span class="cls_007">Note that before signing, the per-round certified state is hashed as a Merkle tree [Mer87].</span></div>
<div style="position:absolute;left:106.94px;top:465.92px" class="cls_007"><span class="cls_007">The per-round certified state in a given round consists of</span></div>
<div style="position:absolute;left:103.33px;top:486.38px" class="cls_007"><span class="cls_007">1. cross-subnet messages that were recently added to the subnet-to-subnet streams;</span></div>
<div style="position:absolute;left:103.33px;top:508.07px" class="cls_007"><span class="cls_007">2. other metadata, including the ingress history data structure;</span></div>
<div style="position:absolute;left:103.33px;top:529.76px" class="cls_007"><span class="cls_007">3. the Merkle-tree root hash of the per-round certified state from the previous round.</span></div>
<div style="position:absolute;left:90.00px;top:550.22px" class="cls_007"><span class="cls_007">Note that the per-round certified state does not include the entire replicated state of a</span></div>
<div style="position:absolute;left:90.00px;top:563.77px" class="cls_007"><span class="cls_007">subnet, as this in general will be quite huge and it would be impractical to certify all of this</span></div>
<div style="position:absolute;left:90.00px;top:576.30px" class="cls_007"><span class="cls_007">state in every round.</span><span class="cls_004"><sup>6</sup></span></div>
<div style="position:absolute;left:106.94px;top:590.86px" class="cls_007"><span class="cls_007">Figure 4 illustrates how the per-round certified state may be organized into a tree. The</span></div>
<div style="position:absolute;left:90.00px;top:604.41px" class="cls_007"><span class="cls_007">first branch of the tree stores various metadata about each canister (but not the entire</span></div>
<div style="position:absolute;left:90.00px;top:617.96px" class="cls_007"><span class="cls_007">replicated state of the canister). The second branch stores the ingress history data struc-</span></div>
<div style="position:absolute;left:90.00px;top:631.51px" class="cls_007"><span class="cls_007">ture.  The third branch stores information about the subnet-to-subnet streams, including</span></div>
<div style="position:absolute;left:90.00px;top:645.06px" class="cls_007"><span class="cls_007">a “window” of recently added cross-subnet messages for each stream. The other branches</span></div>
<div style="position:absolute;left:90.00px;top:658.61px" class="cls_007"><span class="cls_007">store other types of metadata, not discussed here. This tree structure may then be hashed</span></div>
<div style="position:absolute;left:90.00px;top:672.16px" class="cls_007"><span class="cls_007">into a Merkle tree, which has essentially the same size and shape as this tree.</span></div>
<div style="position:absolute;left:102.44px;top:692.21px" class="cls_008"><span class="cls_008"><sup>6</sup></span><span class="cls_009">But see Section 8.2</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">34</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:27268px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background35.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">Per-round certified state is used in several ways in the IC:</span></div>
<div style="position:absolute;left:106.39px;top:112.56px" class="cls_007"><span class="cls_007">•</span></div>
<div style="position:absolute;left:117.27px;top:112.56px" class="cls_007"><span class="cls_007">Output authentication. Cross-subnet messages and responses to ingress messages</span></div>
<div style="position:absolute;left:117.27px;top:126.11px" class="cls_007"><span class="cls_007">are authenticated using per-round certified state. Using the Merkle tree structure, an</span></div>
<div style="position:absolute;left:117.27px;top:139.66px" class="cls_007"><span class="cls_007">individual output (cross-subnet message or ingress message response) may be authen-</span></div>
<div style="position:absolute;left:117.27px;top:153.21px" class="cls_007"><span class="cls_007">ticated to any party by providing a threshold signature on the root of the Merkle tree,</span></div>
<div style="position:absolute;left:117.27px;top:166.76px" class="cls_007"><span class="cls_007">along with hash values on (and adjacent to) the path in the Merkle from the root to</span></div>
<div style="position:absolute;left:117.27px;top:180.31px" class="cls_007"><span class="cls_007">the leaf representing that output. The number if hash values needed to authenticate</span></div>
<div style="position:absolute;left:117.27px;top:193.86px" class="cls_007"><span class="cls_007">an individual output is therefore proportional to the depth of the Merkle tree, which</span></div>
<div style="position:absolute;left:117.27px;top:207.41px" class="cls_007"><span class="cls_007">is typically quite small, even if the size of the Merkle tree is very large. Thus, a single</span></div>
<div style="position:absolute;left:117.27px;top:220.96px" class="cls_007"><span class="cls_007">threshold signature can be used to efficiently authenticate many individual outputs.</span></div>
<div style="position:absolute;left:106.39px;top:243.47px" class="cls_007"><span class="cls_007">•</span></div>
<div style="position:absolute;left:117.27px;top:243.47px" class="cls_007"><span class="cls_007">Preventing and detecting non-determinism.  Consensus guarantees that each</span></div>
<div style="position:absolute;left:117.27px;top:257.02px" class="cls_007"><span class="cls_007">replica processes inputs in the same order.  Since each replica processes these in-</span></div>
<div style="position:absolute;left:117.27px;top:270.57px" class="cls_007"><span class="cls_007">puts deterministically, each replica should obtain the same state.  However, the IC</span></div>
<div style="position:absolute;left:117.27px;top:284.12px" class="cls_007"><span class="cls_007">is designed with an extra layer of robustness to prevent and detect any (accidental)</span></div>
<div style="position:absolute;left:117.27px;top:297.67px" class="cls_007"><span class="cls_007">non-deterministic computation, should it arise. The per-round certified state is one of</span></div>
<div style="position:absolute;left:117.27px;top:311.22px" class="cls_007"><span class="cls_007">the mechanisms used to do this. Since we use an (n − f )-out-of-n threshold signature</span></div>
<div style="position:absolute;left:117.27px;top:324.77px" class="cls_007"><span class="cls_007">for certification, and since f &lt; n/3, there can only be one sequence of states that is</span></div>
<div style="position:absolute;left:117.27px;top:338.32px" class="cls_007"><span class="cls_007">certified.</span></div>
<div style="position:absolute;left:117.27px;top:356.35px" class="cls_007"><span class="cls_007">To see why state chaining is important, consider the following example.  Suppose</span></div>
<div style="position:absolute;left:117.27px;top:369.90px" class="cls_007"><span class="cls_007">we have 4 replicas, P</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>3</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>4</sub></span><span class="cls_007">, and one is corrupt, say P</span><span class="cls_004"><sub>4</sub></span><span class="cls_007">.  Each of the replicas</span></div>
<div style="position:absolute;left:117.27px;top:383.45px" class="cls_007"><span class="cls_007">P</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">,P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007">,P</span><span class="cls_004"><sub>3</sub></span><span class="cls_007"> start out in the same state.</span></div>
<div style="position:absolute;left:129.55px;top:405.96px" class="cls_007"><span class="cls_007">- In round 1, because of a non-deterministic computation, P</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> compute a mes-</span></div>
<div style="position:absolute;left:141.27px;top:418.49px" class="cls_007"><span class="cls_007">sage m</span><span class="cls_004"><sub>1</sub></span><span class="cls_007"> to send to subnet A, while P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> computes a message m</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:432.27px;top:419.51px" class="cls_004"><span class="cls_004">1</span><span class="cls_007"> tosendtosubnet</span></div>
<div style="position:absolute;left:141.27px;top:433.06px" class="cls_007"><span class="cls_007">A.</span></div>
<div style="position:absolute;left:129.55px;top:450.60px" class="cls_007"><span class="cls_007">- In round 2, P</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>3</sub></span><span class="cls_007"> compute a message m</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> to send to subnet B, while P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> computes</span></div>
<div style="position:absolute;left:141.27px;top:463.13px" class="cls_007"><span class="cls_007">a message m</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:201.88px;top:464.15px" class="cls_004"><span class="cls_004">2</span><span class="cls_007"> tosendtosubnetB.</span></div>
<div style="position:absolute;left:129.55px;top:481.68px" class="cls_007"><span class="cls_007">– In round 3, P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>3</sub></span><span class="cls_007"> compute a message m</span><span class="cls_004"><sub>3</sub></span><span class="cls_007"> to send to subnet C, while P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> computes</span></div>
<div style="position:absolute;left:141.27px;top:494.21px" class="cls_007"><span class="cls_007">a message m</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:201.88px;top:495.23px" class="cls_004"><span class="cls_004">3</span><span class="cls_007"> tosendtosubnetC.</span></div>
<div style="position:absolute;left:117.27px;top:517.75px" class="cls_007"><span class="cls_007">This is illustrated in the following table:</span></div>
<div style="position:absolute;left:236.13px;top:543.80px" class="cls_007"><span class="cls_007">P</span><span class="cls_004"><sub>1</sub></span></div>
<div style="position:absolute;left:259.82px;top:542.78px" class="cls_007"><span class="cls_007">m</span><span class="cls_004"><sub>1</sub></span><span class="cls_007"> → A  m</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> → B   m</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:372.87px;top:543.80px" class="cls_004"><span class="cls_004">3</span><span class="cls_007"> →C</span></div>
<div style="position:absolute;left:236.13px;top:557.35px" class="cls_007"><span class="cls_007">P</span><span class="cls_004"><sub>2</sub></span></div>
<div style="position:absolute;left:259.82px;top:556.33px" class="cls_007"><span class="cls_007">m</span><span class="cls_004"><sub>1</sub></span><span class="cls_007"> → A  m</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:320.81px;top:557.35px" class="cls_004"><span class="cls_004">2</span><span class="cls_007"> →Bm</span><span class="cls_004">3</span><span class="cls_007"> →C</span></div>
<div style="position:absolute;left:236.13px;top:570.90px" class="cls_007"><span class="cls_007">P</span><span class="cls_004"><sub>3</sub></span></div>
<div style="position:absolute;left:259.82px;top:569.88px" class="cls_007"><span class="cls_007">m</span><span class="cls_004"><sup>′</sup></span></div>
<div style="position:absolute;left:269.39px;top:570.90px" class="cls_004"><span class="cls_004">1</span><span class="cls_007"> →Am</span><span class="cls_004">2</span><span class="cls_007"> →Bm</span><span class="cls_004">3</span><span class="cls_007"> →C</span></div>
<div style="position:absolute;left:117.27px;top:596.98px" class="cls_007"><span class="cls_007">We are assuming that replicas P</span><span class="cls_004"><sub>1</sub></span><span class="cls_007">, P</span><span class="cls_004"><sub>2</sub></span><span class="cls_007">, and P</span><span class="cls_004"><sub>3</sub></span><span class="cls_007">  each individually perform a valid se-</span></div>
<div style="position:absolute;left:117.27px;top:610.53px" class="cls_007"><span class="cls_007">quence of computations, but that because of non-determinism, these sequences are</span></div>
<div style="position:absolute;left:117.27px;top:624.08px" class="cls_007"><span class="cls_007">not identical. (Even though there is not supposed to be any non-determinism, in this</span></div>
<div style="position:absolute;left:117.27px;top:637.63px" class="cls_007"><span class="cls_007">example, we are supposing that there is.)</span></div>
<div style="position:absolute;left:117.27px;top:655.66px" class="cls_007"><span class="cls_007">Now suppose we did not chain the states. Because P</span><span class="cls_004"><sub>4</sub></span><span class="cls_007"> is corrupt and may sign anything,</span></div>
<div style="position:absolute;left:117.27px;top:669.21px" class="cls_007"><span class="cls_007">he could create a 3-out-of-4 signature on a round-1 state that says “m</span><span class="cls_004"><sub>1</sub></span><span class="cls_007"> → A”, and</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">35</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:28070px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background36.jpg" width=612 height=792></div>
<div style="position:absolute;left:117.27px;top:90.05px" class="cls_007"><span class="cls_007">similarly on a round-2 state that says “m</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> → B”, and on a round-3 state that says</span></div>
<div style="position:absolute;left:117.27px;top:103.60px" class="cls_007"><span class="cls_007">“m</span><span class="cls_004"><sub>3</sub></span><span class="cls_007"> → C”, even though the corresponding sequence</span></div>
<div style="position:absolute;left:251.44px;top:128.11px" class="cls_007"><span class="cls_007">m</span><span class="cls_004"><sub>1</sub></span><span class="cls_007"> → A, m</span><span class="cls_004"><sub>2</sub></span><span class="cls_007"> → B, m</span><span class="cls_004"><sub>3</sub></span><span class="cls_007"> → C</span></div>
<div style="position:absolute;left:117.27px;top:152.61px" class="cls_007"><span class="cls_007">may not compatible with any valid sequence of computations.  Worse yet, such an</span></div>
<div style="position:absolute;left:117.27px;top:166.16px" class="cls_007"><span class="cls_007">invalid sequence of computations could then lead to inconsistent states on other sub-</span></div>
<div style="position:absolute;left:117.27px;top:179.71px" class="cls_007"><span class="cls_007">nets.</span></div>
<div style="position:absolute;left:117.27px;top:197.75px" class="cls_007"><span class="cls_007">By chaining, we ensure that even if there is some non-determinism, any sequence of</span></div>
<div style="position:absolute;left:117.27px;top:211.29px" class="cls_007"><span class="cls_007">certified states corresponds to some valid sequence of computations that was actually</span></div>
<div style="position:absolute;left:117.27px;top:224.84px" class="cls_007"><span class="cls_007">carried out by honest replicas.</span></div>
<div style="position:absolute;left:106.39px;top:247.36px" class="cls_007"><span class="cls_007">•</span></div>
<div style="position:absolute;left:117.27px;top:247.36px" class="cls_007"><span class="cls_007">Coordination with consensus. The per-round certified state is also used to coor-</span></div>
<div style="position:absolute;left:117.27px;top:260.91px" class="cls_007"><span class="cls_007">dinate the execution and consensus layers, in two different ways:</span></div>
<div style="position:absolute;left:129.55px;top:283.42px" class="cls_007"><span class="cls_007">- Consensus throttling. Each replica will keep track the latest round for which it</span></div>
<div style="position:absolute;left:141.27px;top:296.97px" class="cls_007"><span class="cls_007">is has a certified state — this is called the certified height.  It will also keep</span></div>
<div style="position:absolute;left:141.27px;top:310.52px" class="cls_007"><span class="cls_007">track of the latest round for which it is has a notarized block — this is called</span></div>
<div style="position:absolute;left:141.27px;top:324.07px" class="cls_007"><span class="cls_007">the notarized height. If the notarized height is significantly greater than the</span></div>
<div style="position:absolute;left:141.27px;top:337.62px" class="cls_007"><span class="cls_007">certified height, this is a signal that execution is lagging consensus, and that</span></div>
<div style="position:absolute;left:141.27px;top:351.17px" class="cls_007"><span class="cls_007">consensus needs to be throttled. This lagging could be due to non-deterministic</span></div>
<div style="position:absolute;left:141.27px;top:364.72px" class="cls_007"><span class="cls_007">computation, or it could just be due to a more benign performance mismatch</span></div>
<div style="position:absolute;left:141.27px;top:378.27px" class="cls_007"><span class="cls_007">between the layers.  Consensus is throttled by means of the delay functions</span></div>
<div style="position:absolute;left:141.27px;top:391.82px" class="cls_007"><span class="cls_007">discussed in Section 5.9 — specifically, each replica will increase the “governor”</span></div>
<div style="position:absolute;left:141.27px;top:405.37px" class="cls_007"><span class="cls_007">value ϵ as the gap between notarized height and certified height grows (this makes</span></div>
<div style="position:absolute;left:141.27px;top:418.92px" class="cls_007"><span class="cls_007">use of the notion of “locally adjusted delay functions, as in Section 5.12.2).</span></div>
<div style="position:absolute;left:129.55px;top:436.45px" class="cls_007"><span class="cls_007">- State-specific payload validation. As discussed in Section 5.7, the inputs in a pay-</span></div>
<div style="position:absolute;left:141.27px;top:450.00px" class="cls_007"><span class="cls_007">load must pass certain validity checks. In fact, these validity checks may depend</span></div>
<div style="position:absolute;left:141.27px;top:463.55px" class="cls_007"><span class="cls_007">to a certain degree on the state. A detail we skipped is that each block includes</span></div>
<div style="position:absolute;left:141.27px;top:477.10px" class="cls_007"><span class="cls_007">a round number, with the understanding that these validity checks should be</span></div>
<div style="position:absolute;left:141.27px;top:490.65px" class="cls_007"><span class="cls_007">made with respect to the certified state for that round number. A replica that</span></div>
<div style="position:absolute;left:141.27px;top:504.20px" class="cls_007"><span class="cls_007">needs to perform this validation will wait until the state for that round number</span></div>
<div style="position:absolute;left:141.27px;top:517.75px" class="cls_007"><span class="cls_007">has been certified, and then use the certified state for that round to perform</span></div>
<div style="position:absolute;left:141.27px;top:531.29px" class="cls_007"><span class="cls_007">the validation.  This ensures that even with non-deterministic computation, all</span></div>
<div style="position:absolute;left:141.27px;top:544.84px" class="cls_007"><span class="cls_007">replicas are performing the same validity tests (as otherwise, consensus could get</span></div>
<div style="position:absolute;left:141.27px;top:558.39px" class="cls_007"><span class="cls_007">stuck).</span></div>
<div style="position:absolute;left:90.00px;top:586.56px" class="cls_003"><span class="cls_003">6.2</span></div>
<div style="position:absolute;left:120.64px;top:586.56px" class="cls_003"><span class="cls_003">Query calls vs update calls</span></div>
<div style="position:absolute;left:90.00px;top:608.20px" class="cls_007"><span class="cls_007">As we have described it so far, an ingress messages must pass through consensus so that</span></div>
<div style="position:absolute;left:90.00px;top:621.75px" class="cls_007"><span class="cls_007">they are processed in the same order by all replicas on a subnet.  However, an important</span></div>
<div style="position:absolute;left:90.00px;top:635.30px" class="cls_007"><span class="cls_007">optimization is available to those ingress messages whose processing does not modify the</span></div>
<div style="position:absolute;left:90.00px;top:648.85px" class="cls_007"><span class="cls_007">replicated state of a subnet. These are called query calls — as opposed to other ingress</span></div>
<div style="position:absolute;left:90.00px;top:662.40px" class="cls_007"><span class="cls_007">messages, which are called update calls. Query calls are allowed to perform computations</span></div>
<div style="position:absolute;left:90.00px;top:675.95px" class="cls_007"><span class="cls_007">which read and possibly update the state of a canister, but any updates to the state of a</span></div>
<div style="position:absolute;left:90.00px;top:689.50px" class="cls_007"><span class="cls_007">canister are never committed to the replicated state. As such, a query call may be processed</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">36</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:28872px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background37.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">directly by a single replica without passing through consensus, which greatly reduces the</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">latency for obtaining a response from a query call.</span></div>
<div style="position:absolute;left:106.94px;top:117.15px" class="cls_007"><span class="cls_007">Note that a response to a query call is not recorded in the ingress history data structure.</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">As such, we cannot directly use the per-round certified state mechanism to authenticate</span></div>
<div style="position:absolute;left:90.00px;top:144.25px" class="cls_007"><span class="cls_007">responses to query calls. However, a separate mechanism for authenticating such responses</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">is provided: certified variables. As a part of the per-round certified state, each canister</span></div>
<div style="position:absolute;left:90.00px;top:171.34px" class="cls_007"><span class="cls_007">on a subnet is allocated a small number of bytes, which is the certified variable for that</span></div>
<div style="position:absolute;left:90.00px;top:184.89px" class="cls_007"><span class="cls_007">canister, whose value may be updated via update calls, and may be authenticated using</span></div>
<div style="position:absolute;left:90.00px;top:198.44px" class="cls_007"><span class="cls_007">the per-round certified state mechanism. Moreover, a canister may use its certified variable</span></div>
<div style="position:absolute;left:90.00px;top:211.99px" class="cls_007"><span class="cls_007">to store a root of a Merkle tree. In this way, a response to a query call to a canister may</span></div>
<div style="position:absolute;left:90.00px;top:225.54px" class="cls_007"><span class="cls_007">be authenticated so long the response is a leaf in the Merkle tree rooted at the certified</span></div>
<div style="position:absolute;left:90.00px;top:239.09px" class="cls_007"><span class="cls_007">variable for that canister.</span></div>
<div style="position:absolute;left:90.00px;top:267.26px" class="cls_003"><span class="cls_003">6.3</span></div>
<div style="position:absolute;left:120.64px;top:267.26px" class="cls_003"><span class="cls_003">External user authentication</span></div>
<div style="position:absolute;left:90.00px;top:288.90px" class="cls_007"><span class="cls_007">One of the main differences between an ingress message and a cross-subnet message is</span></div>
<div style="position:absolute;left:90.00px;top:302.45px" class="cls_007"><span class="cls_007">the mechanism used for authenticating these messages.  We have already seen above (see</span></div>
<div style="position:absolute;left:90.00px;top:316.00px" class="cls_007"><span class="cls_007">Section 6.1) how threshold signatures are used to authenticate cross-subnet messages. The</span></div>
<div style="position:absolute;left:90.00px;top:329.55px" class="cls_007"><span class="cls_007">NNS registry (see Section 1.5) holds the public verification keys for the threshold signatures</span></div>
<div style="position:absolute;left:90.00px;top:343.09px" class="cls_007"><span class="cls_007">used to authenticate cross-subnet messages.</span></div>
<div style="position:absolute;left:106.94px;top:356.64px" class="cls_007"><span class="cls_007">There is no central registry for external users. Rather, an external user identifies himself</span></div>
<div style="position:absolute;left:90.00px;top:370.19px" class="cls_007"><span class="cls_007">to a canister using a user identifier, which is a hash of a public signature-verification key.</span></div>
<div style="position:absolute;left:90.00px;top:383.74px" class="cls_007"><span class="cls_007">The user holds a corresponding secret signing key, which is used to sign ingress messages.</span></div>
<div style="position:absolute;left:90.00px;top:397.29px" class="cls_007"><span class="cls_007">Such a signature, as well as the corresponding public key, is sent along with the ingress</span></div>
<div style="position:absolute;left:90.00px;top:410.84px" class="cls_007"><span class="cls_007">message. The IC automatically authenticates the signature and passes the user identifier to</span></div>
<div style="position:absolute;left:90.00px;top:424.39px" class="cls_007"><span class="cls_007">the appropriate canister. The canister may then authorize the requested operation, based</span></div>
<div style="position:absolute;left:90.00px;top:437.94px" class="cls_007"><span class="cls_007">on the user identifier and other parameters to the operation specified in the ingress message.</span></div>
<div style="position:absolute;left:106.94px;top:451.49px" class="cls_007"><span class="cls_007">First-time users generate a key pair and derive their user identifier from the public key</span></div>
<div style="position:absolute;left:90.00px;top:465.04px" class="cls_007"><span class="cls_007">during their first interaction with the IC. Returning users are authenticated using the secret</span></div>
<div style="position:absolute;left:90.00px;top:478.59px" class="cls_007"><span class="cls_007">key that is stored by the user agent. A user may associate several key pairs with a single</span></div>
<div style="position:absolute;left:90.00px;top:492.14px" class="cls_007"><span class="cls_007">user identity, using signature delegation. This is useful, as it allows a single user to access</span></div>
<div style="position:absolute;left:90.00px;top:505.69px" class="cls_007"><span class="cls_007">the IC from several devices using the same user identity.</span></div>
<div style="position:absolute;left:90.00px;top:536.62px" class="cls_006"><span class="cls_006">7</span></div>
<div style="position:absolute;left:114.21px;top:536.62px" class="cls_006"><span class="cls_006">Execution Layer</span></div>
<div style="position:absolute;left:90.00px;top:564.41px" class="cls_007"><span class="cls_007">The execution environment processes one input at a time. This input is taken from one of</span></div>
<div style="position:absolute;left:90.00px;top:577.96px" class="cls_007"><span class="cls_007">the input queues, and is directed to one canister. Based on this input and the state of the</span></div>
<div style="position:absolute;left:90.00px;top:591.51px" class="cls_007"><span class="cls_007">canister, the execution environment updates the state of the canister, and additionally may</span></div>
<div style="position:absolute;left:90.00px;top:605.06px" class="cls_007"><span class="cls_007">add messages to output queues and update the ingress history (possibly with a response to</span></div>
<div style="position:absolute;left:90.00px;top:618.61px" class="cls_007"><span class="cls_007">an earlier ingress message).</span></div>
<div style="position:absolute;left:106.94px;top:632.16px" class="cls_007"><span class="cls_007">In a given round, the execution environment will process several inputs. A scheduler</span></div>
<div style="position:absolute;left:90.00px;top:645.70px" class="cls_007"><span class="cls_007">determines which inputs are executed in a given round, and in which order. Without going</span></div>
<div style="position:absolute;left:90.00px;top:659.25px" class="cls_007"><span class="cls_007">into all the details of the scheduler, we highlight some of the goals:</span></div>
<div style="position:absolute;left:106.39px;top:681.77px" class="cls_007"><span class="cls_007">• it must be deterministic, i.e., only depend on the given data;</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">37</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:29674px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background38.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.39px;top:90.05px" class="cls_007"><span class="cls_007">• it should distribute workloads fairly among canisters (but optimizing for throughput</span></div>
<div style="position:absolute;left:117.27px;top:103.60px" class="cls_007"><span class="cls_007">over latency).</span></div>
<div style="position:absolute;left:106.39px;top:126.11px" class="cls_007"><span class="cls_007">• the total amount of work done in each round, measured in terms of cycles (see Sec-</span></div>
<div style="position:absolute;left:117.27px;top:139.66px" class="cls_007"><span class="cls_007">tion 1.8), should be close to some pre-determined amount.</span></div>
<div style="position:absolute;left:106.94px;top:162.18px" class="cls_007"><span class="cls_007">Another task that the execution environment (together with the message router) must</span></div>
<div style="position:absolute;left:90.00px;top:175.73px" class="cls_007"><span class="cls_007">deal with are situations where a canister on one subnet is producing cross-subnet messages</span></div>
<div style="position:absolute;left:90.00px;top:189.28px" class="cls_007"><span class="cls_007">faster than they can be consumed by a canister on another subnet. For this, a self-regulating</span></div>
<div style="position:absolute;left:90.00px;top:202.83px" class="cls_007"><span class="cls_007">mechanism is implemented that throttles the producing canister.</span></div>
<div style="position:absolute;left:106.94px;top:216.38px" class="cls_007"><span class="cls_007">There are many other resource management and bookkeeping tasks that are dealt with</span></div>
<div style="position:absolute;left:90.00px;top:229.92px" class="cls_007"><span class="cls_007">by the execution environment. However, all of these tasks must be dealt with determinis-</span></div>
<div style="position:absolute;left:90.00px;top:243.47px" class="cls_007"><span class="cls_007">tically.</span></div>
<div style="position:absolute;left:90.00px;top:271.64px" class="cls_003"><span class="cls_003">7.1</span></div>
<div style="position:absolute;left:120.64px;top:271.64px" class="cls_003"><span class="cls_003">Random tape</span></div>
<div style="position:absolute;left:90.00px;top:293.28px" class="cls_007"><span class="cls_007">Each subnet has access to a distributed pseudorandom generator (PRG). As men-</span></div>
<div style="position:absolute;left:90.00px;top:306.83px" class="cls_007"><span class="cls_007">tioned in Section 3, pseudorandom bits are derived from a seed that itself is an (f + 1)-out-</span></div>
<div style="position:absolute;left:90.00px;top:320.38px" class="cls_007"><span class="cls_007">of-n BLS signature, called the Random Tape. There is a different Random Tape for each</span></div>
<div style="position:absolute;left:90.00px;top:333.93px" class="cls_007"><span class="cls_007">round of the consensus protocol. While this BLS signature is similar to that used for the</span></div>
<div style="position:absolute;left:90.00px;top:347.48px" class="cls_007"><span class="cls_007">Random Beacon used in consensus (see Section 5.5), the mechanics are somewhat different.</span></div>
<div style="position:absolute;left:106.94px;top:361.03px" class="cls_007"><span class="cls_007">In the consensus protocol, as soon as a block at height h is finalized, each honest replica</span></div>
<div style="position:absolute;left:90.00px;top:374.58px" class="cls_007"><span class="cls_007">will release its share of Random Tape for height h + 1. This has two implications:</span></div>
<div style="position:absolute;left:103.33px;top:397.09px" class="cls_007"><span class="cls_007">1. Before a block at height h is finalized by any honest replica, the Random Tape at</span></div>
<div style="position:absolute;left:117.27px;top:410.64px" class="cls_007"><span class="cls_007">height h + 1 is guaranteed to be unpredictable.</span></div>
<div style="position:absolute;left:103.33px;top:433.16px" class="cls_007"><span class="cls_007">2. By the time block at height h + 1 is finalized by any honest replica, that replica will</span></div>
<div style="position:absolute;left:117.27px;top:446.71px" class="cls_007"><span class="cls_007">typically have all the shares it needs to construct the Random Tape at height h + 1.</span></div>
<div style="position:absolute;left:106.94px;top:469.22px" class="cls_007"><span class="cls_007">To obtain pseudorandom bits, a subnet must make a request for these bits.  Such a</span></div>
<div style="position:absolute;left:90.00px;top:482.77px" class="cls_007"><span class="cls_007">pseudorandom-bit request will be made as a “system call” from the execution layer in some</span></div>
<div style="position:absolute;left:90.00px;top:496.32px" class="cls_007"><span class="cls_007">round, say h. The system will then respond to that request later, when the Random Tape</span></div>
<div style="position:absolute;left:90.00px;top:509.87px" class="cls_007"><span class="cls_007">of height h + 1 is available.  By property (1) above, it is guaranteed that the requested</span></div>
<div style="position:absolute;left:90.00px;top:523.42px" class="cls_007"><span class="cls_007">pseudorandom bits are unpredictable at the time the request is made.  By property (2)</span></div>
<div style="position:absolute;left:90.00px;top:536.97px" class="cls_007"><span class="cls_007">above, the requested random bits will typically be available at the time the next block is</span></div>
<div style="position:absolute;left:90.00px;top:550.52px" class="cls_007"><span class="cls_007">finalized. In fact, in the current implementation, at the time a block of height h is finalized,</span></div>
<div style="position:absolute;left:90.00px;top:564.07px" class="cls_007"><span class="cls_007">the Consensus Layer (see Section 5) will deliver both (the payload of) the block of height</span></div>
<div style="position:absolute;left:90.00px;top:577.62px" class="cls_007"><span class="cls_007">h and the Random Tape of height h + 1 simultaneously to the message routing layer for</span></div>
<div style="position:absolute;left:90.00px;top:591.16px" class="cls_007"><span class="cls_007">processing.</span></div>
<div style="position:absolute;left:90.00px;top:622.10px" class="cls_006"><span class="cls_006">8</span></div>
<div style="position:absolute;left:114.21px;top:622.10px" class="cls_006"><span class="cls_006">Chain-key cryptography II: chain-evolution technology</span></div>
<div style="position:absolute;left:90.00px;top:649.89px" class="cls_007"><span class="cls_007">As mentioned in Section 1.6.2, chain-key cryptography includes a collection of technologies</span></div>
<div style="position:absolute;left:90.00px;top:663.44px" class="cls_007"><span class="cls_007">for robustly and securely maintaining a blockchain-based replicated state machine over time,</span></div>
<div style="position:absolute;left:90.00px;top:676.99px" class="cls_007"><span class="cls_007">which together form what is called chain-evolution technology.  Each subnet operates</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">38</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:30476px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background39.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">in epochs of many rounds (typically on the order of a few hundreds of rounds).  Chain-</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">evolution technology implements many essential maintenance activities that are executed</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">periodically with a cadence that is tied to epochs: garbage collection, fast forwarding, subnet</span></div>
<div style="position:absolute;left:90.00px;top:130.70px" class="cls_007"><span class="cls_007">membership changes, pro-active resharing of secrets, and protocol upgrades.</span></div>
<div style="position:absolute;left:106.94px;top:144.25px" class="cls_007"><span class="cls_007">There are two essential ingredients to chain-evolution technology:  summary blocks</span></div>
<div style="position:absolute;left:90.00px;top:157.80px" class="cls_007"><span class="cls_007">and catch-up packages (CUPs).</span></div>
<div style="position:absolute;left:90.00px;top:185.96px" class="cls_003"><span class="cls_003">8.1</span></div>
<div style="position:absolute;left:120.64px;top:185.96px" class="cls_003"><span class="cls_003">Summary blocks</span></div>
<div style="position:absolute;left:90.00px;top:207.60px" class="cls_007"><span class="cls_007">The first block in each epoch is a summary block.  A summary block contains special</span></div>
<div style="position:absolute;left:90.00px;top:221.15px" class="cls_007"><span class="cls_007">data that will be used to manage the shares of the various threshold signature schemes (see</span></div>
<div style="position:absolute;left:90.00px;top:234.70px" class="cls_007"><span class="cls_007">Section 3). There are two threshold schemes:</span></div>
<div style="position:absolute;left:106.39px;top:257.22px" class="cls_007"><span class="cls_007">• one (f + 1)-out-of-n scheme, for which a new signing key is generated every epoch;</span></div>
<div style="position:absolute;left:106.39px;top:279.73px" class="cls_007"><span class="cls_007">• one (n − f )-out-of-n scheme, for which the signing key is reshared once every epoch.</span></div>
<div style="position:absolute;left:90.00px;top:302.25px" class="cls_007"><span class="cls_007">The low-threshold scheme is used for the random beacon and the random tape, while the</span></div>
<div style="position:absolute;left:90.00px;top:315.80px" class="cls_007"><span class="cls_007">high-threshold scheme is used to certify the replicated state of the subnet.</span></div>
<div style="position:absolute;left:106.94px;top:329.35px" class="cls_007"><span class="cls_007">Recall that the DKG protocol (see Section 3.5) requires that for each signing key, we</span></div>
<div style="position:absolute;left:90.00px;top:342.90px" class="cls_007"><span class="cls_007">have a set of dealings, and that each replica can non-interactively obtain its share of the</span></div>
<div style="position:absolute;left:90.00px;top:356.44px" class="cls_007"><span class="cls_007">signing key from this set of dealings.</span></div>
<div style="position:absolute;left:106.94px;top:369.99px" class="cls_007"><span class="cls_007">Also recall that NNS maintains a registry that, among other things, determines the</span></div>
<div style="position:absolute;left:90.00px;top:383.54px" class="cls_007"><span class="cls_007">membership of a subnet (see Section 1.5). The registry (and hence the subnet membership)</span></div>
<div style="position:absolute;left:90.00px;top:397.09px" class="cls_007"><span class="cls_007">may change over time. Thus, subnets must agree on which registry version they use at</span></div>
<div style="position:absolute;left:90.00px;top:410.64px" class="cls_007"><span class="cls_007">various times for various purposes. This information is also stored in the summary block.</span></div>
<div style="position:absolute;left:106.94px;top:430.17px" class="cls_007"><span class="cls_007">The summary block for epoch i contains the following data fields.</span></div>
<div style="position:absolute;left:106.39px;top:452.68px" class="cls_007"><span class="cls_007">• currentRegistryVersion. This registry version will determine the consensus committee</span></div>
<div style="position:absolute;left:117.27px;top:466.23px" class="cls_007"><span class="cls_007">used throughout epoch i — all tasks performed by the consensus layer (block making,</span></div>
<div style="position:absolute;left:117.27px;top:479.78px" class="cls_007"><span class="cls_007">notarization, finalization) will be performed by this committee.</span></div>
<div style="position:absolute;left:106.39px;top:502.30px" class="cls_007"><span class="cls_007">• nextRegistryVersion.  In each round of consensus, a block maker will include in its</span></div>
<div style="position:absolute;left:117.27px;top:515.85px" class="cls_007"><span class="cls_007">proposal the latest registry version it knows about (which must be no earlier than the</span></div>
<div style="position:absolute;left:117.27px;top:529.40px" class="cls_007"><span class="cls_007">block the proposed block extends).  This ensures that the value nextRegistryVersion</span></div>
<div style="position:absolute;left:117.27px;top:542.95px" class="cls_007"><span class="cls_007">in the summary block of epoch i is fairly up to date.</span></div>
<div style="position:absolute;left:117.27px;top:560.98px" class="cls_007"><span class="cls_007">The value of currentRegistryVersion in epoch i is set to the value of nextRegistryVer-</span></div>
<div style="position:absolute;left:117.27px;top:574.53px" class="cls_007"><span class="cls_007">sion in epoch i − 1.</span></div>
<div style="position:absolute;left:106.39px;top:597.04px" class="cls_007"><span class="cls_007">• currentDealingSets.  These are the dealing sets that determine the threshold signing</span></div>
<div style="position:absolute;left:117.27px;top:610.59px" class="cls_007"><span class="cls_007">keys that will be used to sign messages in epoch i.</span></div>
<div style="position:absolute;left:117.27px;top:628.62px" class="cls_007"><span class="cls_007">As we will see, the threshold signing committee for epoch i (i.e., the replicas that hold</span></div>
<div style="position:absolute;left:117.27px;top:642.17px" class="cls_007"><span class="cls_007">the corresponding threshold signing key shares) is the consensus committee for epoch</span></div>
<div style="position:absolute;left:117.27px;top:655.72px" class="cls_007"><span class="cls_007">i−1.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">39</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:31278px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background40.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.39px;top:90.05px" class="cls_007"><span class="cls_007">• nextDealingSets.  This is where dealings that are collected during epoch i − 1 are</span></div>
<div style="position:absolute;left:117.27px;top:102.58px" class="cls_007"><span class="cls_007">gathered and stored.</span><span class="cls_004"><sup>7</sup></span></div>
<div style="position:absolute;left:227.62px;top:103.60px" class="cls_007"><span class="cls_007">The value of currentDealingSets in epoch i will be set to the</span></div>
<div style="position:absolute;left:117.27px;top:117.15px" class="cls_007"><span class="cls_007">value of nextDealingSets in epoch i − 1 (which itself consists of dealings collected in</span></div>
<div style="position:absolute;left:117.27px;top:130.70px" class="cls_007"><span class="cls_007">epoch i − 2).</span></div>
<div style="position:absolute;left:106.39px;top:152.68px" class="cls_007"><span class="cls_007">• collectDealingParams.  This describes the parameters that define the dealing sets to</span></div>
<div style="position:absolute;left:117.27px;top:166.23px" class="cls_007"><span class="cls_007">be collected during epoch i.  During epoch i, block makers will include dealings in</span></div>
<div style="position:absolute;left:117.27px;top:179.78px" class="cls_007"><span class="cls_007">their proposed blocks that are validated relative to these parameters.</span></div>
<div style="position:absolute;left:117.27px;top:197.54px" class="cls_007"><span class="cls_007">The receiving committee for these dealings is based on the nextRegistryVersion  value</span></div>
<div style="position:absolute;left:117.27px;top:211.09px" class="cls_007"><span class="cls_007">of the summary block of epoch i.</span></div>
<div style="position:absolute;left:117.27px;top:228.86px" class="cls_007"><span class="cls_007">For the low-threshold scheme, the dealing committee is the consensus committee for</span></div>
<div style="position:absolute;left:117.27px;top:242.41px" class="cls_007"><span class="cls_007">epoch i.</span></div>
<div style="position:absolute;left:117.27px;top:260.17px" class="cls_007"><span class="cls_007">For the high-threshold scheme, the shares to be reshared are based on the value of</span></div>
<div style="position:absolute;left:117.27px;top:273.72px" class="cls_007"><span class="cls_007">nextDealingSets of epoch i. Therefore, the dealing committee is the receiving committee</span></div>
<div style="position:absolute;left:117.27px;top:287.27px" class="cls_007"><span class="cls_007">for epoch i − 1, which is also the consensus committee for epoch i .</span></div>
<div style="position:absolute;left:117.27px;top:305.04px" class="cls_007"><span class="cls_007">Also observe that the threshold signing committee for epoch i is the receiving committee</span></div>
<div style="position:absolute;left:117.27px;top:318.59px" class="cls_007"><span class="cls_007">in epoch i − 2, which is the consensus committee for epoch i − 1 .</span></div>
<div style="position:absolute;left:106.94px;top:339.77px" class="cls_007"><span class="cls_007">Consensus in epoch i relies on the values currentRegistryVersion and currentDealingSets</span></div>
<div style="position:absolute;left:90.00px;top:353.32px" class="cls_007"><span class="cls_007">in epoch i — in particular, the makeup of the consensus committee itself is based on curren-</span></div>
<div style="position:absolute;left:90.00px;top:366.87px" class="cls_007"><span class="cls_007">tRegistryVersion and the random beacon used in consensus is based on currentDealingSets.</span></div>
<div style="position:absolute;left:90.00px;top:380.42px" class="cls_007"><span class="cls_007">Moreover, just like any other block, there could be more than one summary block notarized</span></div>
<div style="position:absolute;left:90.00px;top:393.97px" class="cls_007"><span class="cls_007">at the beginning of epoch i, and that ambiguity needs to be resolved by consensus in epoch</span></div>
<div style="position:absolute;left:90.00px;top:407.52px" class="cls_007"><span class="cls_007">i. This seeming circularity is resolved by insisting that a summary block at the beginning</span></div>
<div style="position:absolute;left:90.00px;top:421.07px" class="cls_007"><span class="cls_007">of epoch i − 1 has been finalized before epoch i starts, since the relevant values in the newer</span></div>
<div style="position:absolute;left:90.00px;top:434.62px" class="cls_007"><span class="cls_007">summary block are copied directly from that older summary block.  This is actually an</span></div>
<div style="position:absolute;left:90.00px;top:448.16px" class="cls_007"><span class="cls_007">implicit synchrony assumption, but it is quite an academic assumption.  Indeed, because</span></div>
<div style="position:absolute;left:90.00px;top:461.71px" class="cls_007"><span class="cls_007">of the “consensus throttling” discussed in Section 5.12.2 to ensure liveness, and because of</span></div>
<div style="position:absolute;left:90.00px;top:475.26px" class="cls_007"><span class="cls_007">the length of an epoch is quite large, this can essentially never happen in practice:  long</span></div>
<div style="position:absolute;left:90.00px;top:488.81px" class="cls_007"><span class="cls_007">before consensus could reach the end of epoch i − 1 without finalizing a summary block for</span></div>
<div style="position:absolute;left:90.00px;top:502.36px" class="cls_007"><span class="cls_007">epoch i − 1, the notarization delay function would grow to be astronomically large, and so</span></div>
<div style="position:absolute;left:90.00px;top:515.91px" class="cls_007"><span class="cls_007">the partial synchrony assumption needed for finalization will be satisfied (essentially) with</span></div>
<div style="position:absolute;left:90.00px;top:528.44px" class="cls_007"><span class="cls_007">certainty (for all practical purposes).</span><span class="cls_004"><sup>8</sup></span></div>
<div style="position:absolute;left:90.00px;top:557.38px" class="cls_003"><span class="cls_003">8.2</span></div>
<div style="position:absolute;left:120.64px;top:557.38px" class="cls_003"><span class="cls_003">CUPs</span></div>
<div style="position:absolute;left:90.00px;top:579.02px" class="cls_007"><span class="cls_007">Before describing a CUP, we first point out one detail of random beacon:  the random</span></div>
<div style="position:absolute;left:90.00px;top:592.57px" class="cls_007"><span class="cls_007">beacon for each round depends on the random beacon for the previous round. This is not</span></div>
<div style="position:absolute;left:90.00px;top:606.11px" class="cls_007"><span class="cls_007">an essential feature, but it impacts the design of the CUP.</span></div>
<div style="position:absolute;left:102.44px;top:626.46px" class="cls_008"><span class="cls_008"><sup>7</sup></span><span class="cls_009">A detail we have omitted is that if we fail to collect all the required dealings in epoch i − 1, then as</span></div>
<div style="position:absolute;left:90.00px;top:638.24px" class="cls_009"><span class="cls_009">a fallback, the value of nextDealingSets in epoch i will effectively be set to the value of currentDealingSets</span></div>
<div style="position:absolute;left:90.00px;top:649.20px" class="cls_009"><span class="cls_009">in epoch i.  If this happens, then the protocol will make use of dealing committees and threshold signing</span></div>
<div style="position:absolute;left:90.00px;top:660.16px" class="cls_009"><span class="cls_009">committees from further in the past, as appropriate.</span></div>
<div style="position:absolute;left:102.44px;top:670.30px" class="cls_008"><span class="cls_008"><sup>8</sup></span><span class="cls_009">Also note that dealings that are collected in epoch i depend on data in the summary block for epoch i,</span></div>
<div style="position:absolute;left:90.00px;top:682.07px" class="cls_009"><span class="cls_009">in particular, the values of nextDealingSets and nextRegistryVersion . As such, these dealings should not be</span></div>
<div style="position:absolute;left:90.00px;top:693.03px" class="cls_009"><span class="cls_009">generated and cannot be validated until a summary block for epoch i has been finalized.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">40</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:32080px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background41.jpg" width=612 height=792></div>
<div style="position:absolute;left:106.94px;top:90.05px" class="cls_007"><span class="cls_007">A CUP is a special message (not on the blockchain) that has (mostly) everything a</span></div>
<div style="position:absolute;left:90.00px;top:103.60px" class="cls_007"><span class="cls_007">replica needs to begin working in a given epoch, without knowing anything about previous</span></div>
<div style="position:absolute;left:90.00px;top:117.15px" class="cls_007"><span class="cls_007">epochs. It consists of the following data fields:</span></div>
<div style="position:absolute;left:106.39px;top:139.66px" class="cls_007"><span class="cls_007">• The root of a Merkle hash tree for the entire replicated state (as opposed to the</span></div>
<div style="position:absolute;left:117.27px;top:153.21px" class="cls_007"><span class="cls_007">partial, per-round certified state as in Section 6.1).</span></div>
<div style="position:absolute;left:106.39px;top:175.73px" class="cls_007"><span class="cls_007">• The summary block for the epoch.</span></div>
<div style="position:absolute;left:106.39px;top:198.24px" class="cls_007"><span class="cls_007">• The random beacon for the first round of the epoch.</span></div>
<div style="position:absolute;left:106.39px;top:220.76px" class="cls_007"><span class="cls_007">• A signature on the above fields under the (n − f)-out-of-n threshold signing key for</span></div>
<div style="position:absolute;left:117.27px;top:234.31px" class="cls_007"><span class="cls_007">the subnet.</span></div>
<div style="position:absolute;left:106.94px;top:256.82px" class="cls_007"><span class="cls_007">To generate a CUP for a given epoch, a replica must wait until the summary block</span></div>
<div style="position:absolute;left:90.00px;top:270.37px" class="cls_007"><span class="cls_007">for that epoch is finalized and the corresponding per-round state is certified.  As already</span></div>
<div style="position:absolute;left:90.00px;top:283.92px" class="cls_007"><span class="cls_007">mentioned, the entire replicated state must be hashed as a Merkle tree — even though a</span></div>
<div style="position:absolute;left:90.00px;top:297.47px" class="cls_007"><span class="cls_007">number of techniques are used to accelerate this process, this is still quite expensive, which</span></div>
<div style="position:absolute;left:90.00px;top:311.02px" class="cls_007"><span class="cls_007">is why it is only done once per epoch. Since a CUP contains only the root of this Merkle</span></div>
<div style="position:absolute;left:90.00px;top:324.57px" class="cls_007"><span class="cls_007">tree, a special state sync subprotocol is used that allows a replica to pull any state that it</span></div>
<div style="position:absolute;left:90.00px;top:338.12px" class="cls_007"><span class="cls_007">needs from its peers — again, a number of techniques are used to accelerate this process,</span></div>
<div style="position:absolute;left:90.00px;top:351.67px" class="cls_007"><span class="cls_007">but it is still quite expensive. Since we are using a high-threshold signature for a CUP, we</span></div>
<div style="position:absolute;left:90.00px;top:365.22px" class="cls_007"><span class="cls_007">can be sure that there is only one valid CUP in any epoch, and moreover, there will be</span></div>
<div style="position:absolute;left:90.00px;top:378.77px" class="cls_007"><span class="cls_007">many peers from which the state may be pulled.</span></div>
<div style="position:absolute;left:90.00px;top:406.93px" class="cls_003"><span class="cls_003">8.3</span></div>
<div style="position:absolute;left:120.64px;top:406.93px" class="cls_003"><span class="cls_003">Implementing chain-evolution technology</span></div>
<div style="position:absolute;left:90.00px;top:428.57px" class="cls_007"><span class="cls_007">Garbage collection: Because of the information contained in a CUP for a given epoch, it</span></div>
<div style="position:absolute;left:117.27px;top:442.12px" class="cls_007"><span class="cls_007">is safe for each replica to purge all inputs that have been processed, and all consensus-</span></div>
<div style="position:absolute;left:117.27px;top:455.67px" class="cls_007"><span class="cls_007">level protocol messages needed to order those inputs, prior to that epoch.</span></div>
<div style="position:absolute;left:90.00px;top:478.19px" class="cls_007"><span class="cls_007">Fast forwarding: If a replica in a subnet falls very far behind its peers (because it is</span></div>
<div style="position:absolute;left:117.27px;top:491.74px" class="cls_007"><span class="cls_007">down or disconnected from the network for a long time), or a new replica is added to</span></div>
<div style="position:absolute;left:117.27px;top:505.29px" class="cls_007"><span class="cls_007">a subnet, it can be fast forwarded to the beginning of the most recent epoch, without</span></div>
<div style="position:absolute;left:117.27px;top:518.84px" class="cls_007"><span class="cls_007">having to run the consensus protocol and process all of the inputs up to that point.</span></div>
<div style="position:absolute;left:117.27px;top:532.38px" class="cls_007"><span class="cls_007">Such a replica may do so by obtaining the most recent CUP. Using the summary block</span></div>
<div style="position:absolute;left:117.27px;top:545.93px" class="cls_007"><span class="cls_007">and random beacon contained in the CUP, along with protocol messages from other</span></div>
<div style="position:absolute;left:117.27px;top:559.48px" class="cls_007"><span class="cls_007">replicas (which have not yet been purged), this replica may run the consensus protocol</span></div>
<div style="position:absolute;left:117.27px;top:573.03px" class="cls_007"><span class="cls_007">forward from the beginning of the corresponding epoch. The replica will also use the</span></div>
<div style="position:absolute;left:117.27px;top:586.58px" class="cls_007"><span class="cls_007">state sync subprotocol to obtain the replicated state corresponding to the beginning</span></div>
<div style="position:absolute;left:117.27px;top:600.13px" class="cls_007"><span class="cls_007">of the epoch, so that it may also process the inputs generated by consensus.</span></div>
<div style="position:absolute;left:117.27px;top:618.16px" class="cls_007"><span class="cls_007">Figure 5 illustrates fast forwarding. Here, we assume that a replica that needs to catch</span></div>
<div style="position:absolute;left:117.27px;top:631.71px" class="cls_007"><span class="cls_007">up has a CUP at the beginning of an epoch, which starts (say) at height 101. The CUP</span></div>
<div style="position:absolute;left:117.27px;top:645.26px" class="cls_007"><span class="cls_007">contains the root of the Merkle tree for the replicated state at height 101, the summary</span></div>
<div style="position:absolute;left:117.27px;top:658.81px" class="cls_007"><span class="cls_007">block at height 101 (shown in green), and the random beacon at height 101.  This</span></div>
<div style="position:absolute;left:117.27px;top:672.36px" class="cls_007"><span class="cls_007">replica will use the state sync subprotocol to obtain from its peers the full replicated</span></div>
<div style="position:absolute;left:117.27px;top:685.91px" class="cls_007"><span class="cls_007">state at height 101, using the root of the Merkle tree in the CUP to validate this state.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">41</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:32882px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background42.jpg" width=612 height=792></div>
<div style="position:absolute;left:195.47px;top:100.99px" class="cls_016"><span class="cls_016">CUP 101</span></div>
<div style="position:absolute;left:205.15px;top:121.62px" class="cls_023"><span class="cls_023">101</span></div>
<div style="position:absolute;left:246.44px;top:121.62px" class="cls_023"><span class="cls_023">102</span></div>
<div style="position:absolute;left:287.16px;top:122.17px" class="cls_023"><span class="cls_023">103</span></div>
<div style="position:absolute;left:328.17px;top:122.17px" class="cls_023"><span class="cls_023">104</span></div>
<div style="position:absolute;left:364.61px;top:123.00px" class="cls_024"><span class="cls_024">Replicated states</span></div>
<div style="position:absolute;left:249.07px;top:155.86px" class="cls_023"><span class="cls_023">N</span></div>
<div style="position:absolute;left:290.17px;top:154.95px" class="cls_023"><span class="cls_023">N</span></div>
<div style="position:absolute;left:331.52px;top:155.03px" class="cls_023"><span class="cls_023">N</span></div>
<div style="position:absolute;left:204.28px;top:182.39px" class="cls_023"><span class="cls_023">101</span></div>
<div style="position:absolute;left:245.57px;top:182.39px" class="cls_023"><span class="cls_023">102</span></div>
<div style="position:absolute;left:286.86px;top:182.39px" class="cls_023"><span class="cls_023">103</span></div>
<div style="position:absolute;left:328.15px;top:182.39px" class="cls_023"><span class="cls_023">104</span></div>
<div style="position:absolute;left:364.61px;top:183.12px" class="cls_024"><span class="cls_024">Blocks</span></div>
<div style="position:absolute;left:249.54px;top:209.23px" class="cls_023"><span class="cls_023">F</span></div>
<div style="position:absolute;left:332.06px;top:209.46px" class="cls_023"><span class="cls_023">F</span></div>
<div style="position:absolute;left:204.56px;top:232.17px" class="cls_023"><span class="cls_023">RB</span></div>
<div style="position:absolute;left:245.86px;top:232.17px" class="cls_023"><span class="cls_023">RB</span></div>
<div style="position:absolute;left:287.15px;top:232.17px" class="cls_023"><span class="cls_023">RB</span></div>
<div style="position:absolute;left:328.44px;top:232.17px" class="cls_023"><span class="cls_023">RB</span></div>
<div style="position:absolute;left:363.95px;top:237.42px" class="cls_024"><span class="cls_024">Random beacons</span></div>
<div style="position:absolute;left:203.62px;top:241.03px" class="cls_023"><span class="cls_023">101</span></div>
<div style="position:absolute;left:244.91px;top:241.03px" class="cls_023"><span class="cls_023">102</span></div>
<div style="position:absolute;left:286.20px;top:241.03px" class="cls_023"><span class="cls_023">103</span></div>
<div style="position:absolute;left:327.49px;top:241.03px" class="cls_023"><span class="cls_023">104</span></div>
<div style="position:absolute;left:244.71px;top:290.69px" class="cls_007"><span class="cls_007">Figure 5: Fast forwarding</span></div>
<div style="position:absolute;left:117.27px;top:323.70px" class="cls_007"><span class="cls_007">Having obtained this state, the replica can then participate in the protocol, obtaining</span></div>
<div style="position:absolute;left:117.27px;top:337.25px" class="cls_007"><span class="cls_007">from its peers blocks (and other messages associated with consensus) at heights 102,</span></div>
<div style="position:absolute;left:117.27px;top:350.79px" class="cls_007"><span class="cls_007">103, and so on, and updating its copy of the replicated state. If its peers have already</span></div>
<div style="position:absolute;left:117.27px;top:364.34px" class="cls_007"><span class="cls_007">finalized blocks at greater heights, this replica will process those finalized blocks as</span></div>
<div style="position:absolute;left:117.27px;top:377.89px" class="cls_007"><span class="cls_007">quickly as it can obtain them (and their notarizations and finalizations) from its peers</span></div>
<div style="position:absolute;left:117.27px;top:391.44px" class="cls_007"><span class="cls_007">(and as quickly as the execution layer will allow).</span></div>
<div style="position:absolute;left:90.00px;top:413.96px" class="cls_007"><span class="cls_007">Subnet membership changes: We have already discussed how summary blocks are used</span></div>
<div style="position:absolute;left:117.27px;top:427.51px" class="cls_007"><span class="cls_007">to encode which version of the registry is in force in a given epoch, and how that is</span></div>
<div style="position:absolute;left:117.27px;top:441.06px" class="cls_007"><span class="cls_007">used to determine the subnet membership, and more specifically, the membership</span></div>
<div style="position:absolute;left:117.27px;top:454.60px" class="cls_007"><span class="cls_007">committees for various tasks. Note that even after a replica is removed from a subnet,</span></div>
<div style="position:absolute;left:117.27px;top:468.15px" class="cls_007"><span class="cls_007">it should (if possible) participate in its assigned committee duties for one additional</span></div>
<div style="position:absolute;left:117.27px;top:481.70px" class="cls_007"><span class="cls_007">epoch .</span></div>
<div style="position:absolute;left:90.00px;top:504.22px" class="cls_007"><span class="cls_007">Pro-active resharing of secrets: We have already discussed how summary blocks are</span></div>
<div style="position:absolute;left:117.27px;top:517.77px" class="cls_007"><span class="cls_007">used to generate and reshare signing keys. If necessary, the required summary block</span></div>
<div style="position:absolute;left:117.27px;top:531.32px" class="cls_007"><span class="cls_007">may be obtained from a CUP.</span></div>
<div style="position:absolute;left:90.00px;top:553.83px" class="cls_007"><span class="cls_007">Protocol upgrades: CUPs are also used to implement protocol upgrades.  Protocol up-</span></div>
<div style="position:absolute;left:117.27px;top:567.38px" class="cls_007"><span class="cls_007">grades are initiated by the NNS (see Section 1.5). The basic idea, without going into</span></div>
<div style="position:absolute;left:117.27px;top:580.93px" class="cls_007"><span class="cls_007">all the details, is this:</span></div>
<div style="position:absolute;left:130.40px;top:603.45px" class="cls_007"><span class="cls_007">• when it is time to install a new version of the protocol, the summary block at</span></div>
<div style="position:absolute;left:141.27px;top:617.00px" class="cls_007"><span class="cls_007">the beginning of an epoch will indicate this;</span></div>
<div style="position:absolute;left:130.40px;top:634.53px" class="cls_007"><span class="cls_007">• the replicas running the old version of the protocol will continue running con-</span></div>
<div style="position:absolute;left:141.27px;top:648.08px" class="cls_007"><span class="cls_007">sensus long enough to finalize the summary block and to create a corresponding</span></div>
<div style="position:absolute;left:141.27px;top:661.63px" class="cls_007"><span class="cls_007">CUP; however, they will create only empty blocks and not pass along any pay-</span></div>
<div style="position:absolute;left:141.27px;top:675.18px" class="cls_007"><span class="cls_007">loads to message routing and execution;</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">42</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:33684px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background43.jpg" width=612 height=792></div>
<div style="position:absolute;left:130.40px;top:90.05px" class="cls_007"><span class="cls_007">• the new version of the protocol will be installed, and the replicas running the</span></div>
<div style="position:absolute;left:141.27px;top:103.60px" class="cls_007"><span class="cls_007">new version of the protocol will resume running the full protocol from the above</span></div>
<div style="position:absolute;left:141.27px;top:117.15px" class="cls_007"><span class="cls_007">CUP.</span></div>
<div style="position:absolute;left:90.00px;top:159.42px" class="cls_006"><span class="cls_006">References</span></div>
<div style="position:absolute;left:90.00px;top:186.19px" class="cls_007"><span class="cls_007">[AMN</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">20] I. Abraham, D. Malkhi, K. Nayak, L. Ren, and M. Yin. Sync HotStuff: Simple</span></div>
<div style="position:absolute;left:145.57px;top:200.76px" class="cls_007"><span class="cls_007">and Practical Synchronous State Machine Replication.  In 2020 IEEE Sympo-</span></div>
<div style="position:absolute;left:145.57px;top:214.31px" class="cls_007"><span class="cls_007">sium on Security and Privacy, SP 2020, San Francisco, CA, USA, May 18-21,</span></div>
<div style="position:absolute;left:145.57px;top:227.86px" class="cls_007"><span class="cls_007">2020, pages 106-118. IEEE, 2020.</span></div>
<div style="position:absolute;left:90.00px;top:250.19px" class="cls_007"><span class="cls_007">[BGLS03]</span></div>
<div style="position:absolute;left:145.57px;top:250.19px" class="cls_007"><span class="cls_007">D. Boneh, C. Gentry, B. Lynn, and H. Shacham.  Aggregate and Verifiably</span></div>
<div style="position:absolute;left:145.57px;top:263.74px" class="cls_007"><span class="cls_007">Encrypted Signatures from Bilinear Maps.  In E. Biham, editor, Advances in</span></div>
<div style="position:absolute;left:145.57px;top:277.29px" class="cls_007"><span class="cls_007">Cryptology - EUROCRYPT 2003, International Conference on the Theory and</span></div>
<div style="position:absolute;left:145.57px;top:290.84px" class="cls_007"><span class="cls_007">Applications of Cryptographic Techniques, Warsaw, Poland, May 4-8, 2003,</span></div>
<div style="position:absolute;left:145.57px;top:304.39px" class="cls_007"><span class="cls_007">Proceedings, volume 2656 of Lecture Notes in Computer Science, pages 416-</span></div>
<div style="position:absolute;left:145.57px;top:317.94px" class="cls_007"><span class="cls_007">432. Springer, 2003.</span></div>
<div style="position:absolute;left:90.00px;top:340.28px" class="cls_007"><span class="cls_007">[BKM18]</span></div>
<div style="position:absolute;left:145.56px;top:340.28px" class="cls_007"><span class="cls_007">E. Buchman, J. Kwon, and Z. Milosevic. The latest gossip on BFT consensus,</span></div>
<div style="position:absolute;left:145.57px;top:353.83px" class="cls_007"><span class="cls_007">2018. arXiv:1807.04938, </span><A HREF="http://arxiv.org/abs/1807.04938">http://arxiv.org/abs/1807.04938</A>.</div>
<div style="position:absolute;left:90.00px;top:376.16px" class="cls_007"><span class="cls_007">[BLS01]</span></div>
<div style="position:absolute;left:145.57px;top:376.16px" class="cls_007"><span class="cls_007">D. Boneh, B. Lynn, and H. Shacham. Short Signatures from the Weil Pairing.</span></div>
<div style="position:absolute;left:145.57px;top:389.71px" class="cls_007"><span class="cls_007">In C. Boyd, editor, Advances in Cryptology - ASIACRYPT 2001, 7th Interna-</span></div>
<div style="position:absolute;left:145.57px;top:403.26px" class="cls_007"><span class="cls_007">tional Conference on the Theory and Application of Cryptology and Information</span></div>
<div style="position:absolute;left:145.57px;top:416.81px" class="cls_007"><span class="cls_007">Security, Gold Coast, Australia, December 9-13, 2001, Proceedings, volume 2248</span></div>
<div style="position:absolute;left:145.57px;top:430.36px" class="cls_007"><span class="cls_007">of Lecture Notes in Computer Science, pages 514-532. Springer, 2001.</span></div>
<div style="position:absolute;left:90.00px;top:452.70px" class="cls_007"><span class="cls_007">[But13]</span></div>
<div style="position:absolute;left:145.56px;top:452.70px" class="cls_007"><span class="cls_007">V.  Buterin.    Ethereum  whitepaper,</span></div>
<div style="position:absolute;left:341.88px;top:452.70px" class="cls_007"><span class="cls_007">2013.</span></div>
<div style="position:absolute;left:384.55px;top:452.70px" class="cls_007"><span class="cls_007"> </span><A HREF="https://ethereum.org/en/whitepaper/">https://ethereum.org/en/</A> </div>
<div style="position:absolute;left:145.57px;top:466.25px" class="cls_007"><span class="cls_007"> </span><A HREF="https://ethereum.org/en/whitepaper/">whitepaper/</A>.</div>
<div style="position:absolute;left:90.00px;top:487.57px" class="cls_007"><span class="cls_007">[CDH</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">21]</span></div>
<div style="position:absolute;left:145.57px;top:488.59px" class="cls_007"><span class="cls_007">J.  Camenisch,  M.  Drijvers,  T.  Hanke,  Y.-A.  Pignolet,  V.  Shoup,  and</span></div>
<div style="position:absolute;left:145.57px;top:502.14px" class="cls_007"><span class="cls_007">D. Williams. Internet Computer Consensus. Cryptology ePrint Archive, Report</span></div>
<div style="position:absolute;left:145.57px;top:515.68px" class="cls_007"><span class="cls_007">2021/632, 2021. </span><A HREF="https://ia.cr/2021/632">https://ia.cr/2021/632</A>.</div>
<div style="position:absolute;left:90.00px;top:538.02px" class="cls_007"><span class="cls_007">[CDS94]</span></div>
<div style="position:absolute;left:145.57px;top:538.02px" class="cls_007"><span class="cls_007">R. Cramer, I. Damg</span></div>
<div style="position:absolute;left:245.07px;top:538.02px" class="cls_007"><span class="cls_007">ard, and B. Schoenmakers.  Proofs of Partial Knowledge</span></div>
<div style="position:absolute;left:145.57px;top:551.57px" class="cls_007"><span class="cls_007">and Simplified Design of Witness Hiding Protocols. In Advances in Cryptology</span></div>
<div style="position:absolute;left:145.57px;top:565.12px" class="cls_007"><span class="cls_007">- CRYPTO ’94, 14th Annual International Cryptology Conference, Santa Bar-</span></div>
<div style="position:absolute;left:145.57px;top:578.67px" class="cls_007"><span class="cls_007">bara, California, USA, August 21-25, 1994, Proceedings, volume 839 of Lecture</span></div>
<div style="position:absolute;left:145.57px;top:592.22px" class="cls_007"><span class="cls_007">Notes in Computer Science, pages 174-187. Springer, 1994.</span></div>
<div style="position:absolute;left:90.00px;top:614.56px" class="cls_007"><span class="cls_007">[CL99]</span></div>
<div style="position:absolute;left:145.57px;top:614.56px" class="cls_007"><span class="cls_007">M. Castro and B. Liskov. Practical Byzantine Fault Tolerance. In M. I. Seltzer</span></div>
<div style="position:absolute;left:145.57px;top:628.11px" class="cls_007"><span class="cls_007">and P. J. Leach, editors, Proceedings of the Third USENIX Symposium on Op-</span></div>
<div style="position:absolute;left:145.57px;top:641.65px" class="cls_007"><span class="cls_007">erating Systems Design and Implementation (OSDI), New Orleans, Louisiana,</span></div>
<div style="position:absolute;left:145.57px;top:655.20px" class="cls_007"><span class="cls_007">USA, February 22-25, 1999, pages 173-186. USENIX Association, 1999.</span></div>
<div style="position:absolute;left:90.00px;top:676.52px" class="cls_007"><span class="cls_007">[CWA</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">09] A. Clement, E. L. Wong, L. Alvisi, M. Dahlin, and M. Marchetti.  Making</span></div>
<div style="position:absolute;left:145.57px;top:691.09px" class="cls_007"><span class="cls_007">Byzantine Fault Tolerant Systems Tolerate Byzantine Faults. In J. Rexford and</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">43</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:34486px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background44.jpg" width=612 height=792></div>
<div style="position:absolute;left:145.57px;top:90.05px" class="cls_007"><span class="cls_007">E. G. Sirer, editors, Proceedings of the 6th USENIX Symposium on Networked</span></div>
<div style="position:absolute;left:145.57px;top:103.60px" class="cls_007"><span class="cls_007">Systems Design and Implementation, NSDI 2009, April 22-24, 2009, Boston,</span></div>
<div style="position:absolute;left:145.57px;top:117.15px" class="cls_007"><span class="cls_007">MA, USA, pages 153-168. USENIX Association, 2009.  </span><A HREF="http://www.usenix.org/events/nsdi09/tech/full_papers/clement/clement.pdf">http://www.usenix.</A> </div>
<div style="position:absolute;left:145.57px;top:130.70px" class="cls_007"><span class="cls_007"> </span><A HREF="http://www.usenix.org/events/nsdi09/tech/full_papers/clement/clement.pdf">org/events/nsdi09/tech/full_papers/clement/clement.pdf</A>.</div>
<div style="position:absolute;left:90.00px;top:153.21px" class="cls_007"><span class="cls_007">[Des87]</span></div>
<div style="position:absolute;left:145.57px;top:153.21px" class="cls_007"><span class="cls_007">Y. Desmedt. Society and Group Oriented Cryptography: A New Concept. In</span></div>
<div style="position:absolute;left:145.57px;top:166.76px" class="cls_007"><span class="cls_007">C. Pomerance, editor, Advances in Cryptology - CRYPTO ’87, A Conference</span></div>
<div style="position:absolute;left:145.57px;top:180.31px" class="cls_007"><span class="cls_007">on the Theory and Applications of Cryptographic Techniques, Santa Barbara,</span></div>
<div style="position:absolute;left:145.57px;top:193.86px" class="cls_007"><span class="cls_007">California, USA, August 16-20, 1987, Proceedings, volume 293 of Lecture Notes</span></div>
<div style="position:absolute;left:145.57px;top:207.41px" class="cls_007"><span class="cls_007">in Computer Science, pages 120-127. Springer, 1987.</span></div>
<div style="position:absolute;left:90.00px;top:229.92px" class="cls_007"><span class="cls_007">[DLS88]</span></div>
<div style="position:absolute;left:145.57px;top:229.92px" class="cls_007"><span class="cls_007">C. Dwork, N. A. Lynch, and L. J. Stockmeyer.  Consensus in the presence of</span></div>
<div style="position:absolute;left:145.57px;top:243.47px" class="cls_007"><span class="cls_007">partial synchrony. J. ACM, 35(2):288-323, 1988.</span></div>
<div style="position:absolute;left:90.00px;top:265.99px" class="cls_007"><span class="cls_007">[Fis83]</span></div>
<div style="position:absolute;left:145.57px;top:265.99px" class="cls_007"><span class="cls_007">M. J. Fischer.  The Consensus Problem in Unreliable Distributed Systems (A</span></div>
<div style="position:absolute;left:145.57px;top:279.54px" class="cls_007"><span class="cls_007">Brief Survey). In Fundamentals of Computation Theory, Proceedings of the 1983</span></div>
<div style="position:absolute;left:145.57px;top:293.09px" class="cls_007"><span class="cls_007">International FCT-Conference, Borgholm, Sweden, August 21-27, 1983, volume</span></div>
<div style="position:absolute;left:145.57px;top:306.64px" class="cls_007"><span class="cls_007">158 of Lecture Notes in Computer Science, pages 127-140. Springer, 1983.</span></div>
<div style="position:absolute;left:90.00px;top:329.15px" class="cls_007"><span class="cls_007">[FS86]</span></div>
<div style="position:absolute;left:145.57px;top:329.15px" class="cls_007"><span class="cls_007">A. Fiat and A. Shamir. How to Prove Yourself: Practical Solutions to Identifica-</span></div>
<div style="position:absolute;left:145.57px;top:342.70px" class="cls_007"><span class="cls_007">tion and Signature Problems. In Advances in Cryptology - CRYPTO ’86, Santa</span></div>
<div style="position:absolute;left:145.57px;top:356.25px" class="cls_007"><span class="cls_007">Barbara, California, USA, 1986, Proceedings, volume 263 of Lecture Notes in</span></div>
<div style="position:absolute;left:145.57px;top:369.80px" class="cls_007"><span class="cls_007">Computer Science, pages 186-194. Springer, 1986.</span></div>
<div style="position:absolute;left:90.00px;top:391.30px" class="cls_007"><span class="cls_007">[GHM</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">17] Y. Gilad, R. Hemo, S. Micali, G. Vlachos, and N. Zeldovich. Algorand: Scaling</span></div>
<div style="position:absolute;left:145.57px;top:405.87px" class="cls_007"><span class="cls_007">Byzantine Agreements for Cryptocurrencies. Cryptology ePrint Archive, Report</span></div>
<div style="position:absolute;left:145.57px;top:419.41px" class="cls_007"><span class="cls_007">2017/454, 2017. </span><A HREF="https://eprint.iacr.org/2017/454">https://eprint.iacr.org/2017/454</A>.</div>
<div style="position:absolute;left:90.00px;top:441.93px" class="cls_007"><span class="cls_007">[Gro21]</span></div>
<div style="position:absolute;left:145.57px;top:441.93px" class="cls_007"><span class="cls_007">J. Groth. Non-interactive distributed key generation and key resharing. Cryp-</span></div>
<div style="position:absolute;left:145.57px;top:455.48px" class="cls_007"><span class="cls_007">tology ePrint Archive, Report 2021/339, 2021. </span><A HREF="https://ia.cr/2021/339">https://ia.cr/2021/339</A>.</div>
<div style="position:absolute;left:90.00px;top:477.99px" class="cls_007"><span class="cls_007">[JMV01]</span></div>
<div style="position:absolute;left:145.57px;top:477.99px" class="cls_007"><span class="cls_007">D. Johnson, A. Menezes, and S. A. Vanstone.  The Elliptic Curve Digital Sig-</span></div>
<div style="position:absolute;left:145.57px;top:491.54px" class="cls_007"><span class="cls_007">nature Algorithm (ECDSA). Int. J. Inf. Sec., 1(1):36-63, 2001.</span></div>
<div style="position:absolute;left:90.00px;top:514.06px" class="cls_007"><span class="cls_007">[Mer87]</span></div>
<div style="position:absolute;left:145.56px;top:514.06px" class="cls_007"><span class="cls_007">R. C. Merkle. A Digital Signature Based on a Conventional Encryption Func-</span></div>
<div style="position:absolute;left:145.57px;top:527.61px" class="cls_007"><span class="cls_007">tion. In Advances in Cryptology - CRYPTO ’87, A Conference on the Theory</span></div>
<div style="position:absolute;left:145.57px;top:541.16px" class="cls_007"><span class="cls_007">and Applications of Cryptographic Techniques, Santa Barbara, California, USA,</span></div>
<div style="position:absolute;left:145.57px;top:554.71px" class="cls_007"><span class="cls_007">August 16-20, 1987, Proceedings, volume 293 of Lecture Notes in Computer Sci-</span></div>
<div style="position:absolute;left:145.57px;top:568.26px" class="cls_007"><span class="cls_007">ence, pages 369-378. Springer, 1987.</span></div>
<div style="position:absolute;left:90.00px;top:589.75px" class="cls_007"><span class="cls_007">[MXC</span><span class="cls_004"><sup>+</sup></span><span class="cls_007">16] A. Miller, Y. Xia, K. Croman, E. Shi, and D. Song.  The Honey Badger of</span></div>
<div style="position:absolute;left:145.57px;top:604.32px" class="cls_007"><span class="cls_007">BFT Protocols.  In E. R. Weippl, S. Katzenbeisser, C. Kruegel, A. C. My-</span></div>
<div style="position:absolute;left:145.57px;top:617.87px" class="cls_007"><span class="cls_007">ers, and S. Halevi, editors, Proceedings of the 2016 ACM SIGSAC Conference</span></div>
<div style="position:absolute;left:145.57px;top:631.42px" class="cls_007"><span class="cls_007">on Computer and Communications Security, Vienna, Austria, October 24-28,</span></div>
<div style="position:absolute;left:145.57px;top:644.97px" class="cls_007"><span class="cls_007">2016, pages 31-42. ACM, 2016.</span></div>
<div style="position:absolute;left:90.00px;top:667.48px" class="cls_007"><span class="cls_007">[Nak08]</span></div>
<div style="position:absolute;left:145.56px;top:667.48px" class="cls_007"><span class="cls_007">S. Nakamoto.  Bitcoin:  A peer-to-peer electronic cash system, 2008.  </span><A HREF="https://bitcoin.org/bitcoin.pdf">https:</A> </div>
<div style="position:absolute;left:145.57px;top:681.03px" class="cls_007"><span class="cls_007"> </span><A HREF="https://bitcoin.org/bitcoin.pdf">//bitcoin.org/bitcoin.pdf</A>.</div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">44</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-306px;top:35288px;width:612px;height:792px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="8454411a-7c16-11ec-a980-0cc47a792c0a_id_8454411a-7c16-11ec-a980-0cc47a792c0a_files/background45.jpg" width=612 height=792></div>
<div style="position:absolute;left:90.00px;top:90.05px" class="cls_007"><span class="cls_007">[PS18]</span></div>
<div style="position:absolute;left:145.57px;top:90.05px" class="cls_007"><span class="cls_007">R. Pass and E. Shi.  Thunderella:  Blockchains with Optimistic Instant Con-</span></div>
<div style="position:absolute;left:145.57px;top:103.60px" class="cls_007"><span class="cls_007">firmation.  In J. B. Nielsen and V. Rijmen, editors, Advances in Cryptology -</span></div>
<div style="position:absolute;left:145.57px;top:117.15px" class="cls_007"><span class="cls_007">EUROCRYPT 2018 - 37th Annual International Conference on the Theory and</span></div>
<div style="position:absolute;left:145.57px;top:130.70px" class="cls_007"><span class="cls_007">Applications of Cryptographic Techniques, Tel Aviv, Israel, April 29 - May 3,</span></div>
<div style="position:absolute;left:145.57px;top:144.25px" class="cls_007"><span class="cls_007">2018 Proceedings, Part II, volume 10821 of Lecture Notes in Computer Science,</span></div>
<div style="position:absolute;left:145.57px;top:157.80px" class="cls_007"><span class="cls_007">pages 3-33. Springer, 2018.</span></div>
<div style="position:absolute;left:90.00px;top:180.31px" class="cls_007"><span class="cls_007">[PSS17]</span></div>
<div style="position:absolute;left:145.56px;top:180.31px" class="cls_007"><span class="cls_007">R. Pass, L. Seeman, and A. Shelat.  Analysis of the Blockchain Protocol in</span></div>
<div style="position:absolute;left:145.57px;top:193.86px" class="cls_007"><span class="cls_007">Asynchronous Networks.  In Advances in Cryptology - EUROCRYPT 2017 -</span></div>
<div style="position:absolute;left:145.57px;top:207.41px" class="cls_007"><span class="cls_007">36th Annual International Conference on the Theory and Applications of Cryp-</span></div>
<div style="position:absolute;left:145.57px;top:220.96px" class="cls_007"><span class="cls_007">tographic Techniques, Paris, France, April 30 - May 4, 2017, Proceedings, Part</span></div>
<div style="position:absolute;left:145.57px;top:234.51px" class="cls_007"><span class="cls_007">II, volume 10211 of Lecture Notes in Computer Science, pages 643-673, 2017.</span></div>
<div style="position:absolute;left:90.00px;top:257.02px" class="cls_007"><span class="cls_007">[Sch90]</span></div>
<div style="position:absolute;left:145.57px;top:257.02px" class="cls_007"><span class="cls_007">F. B. Schneider. Implementing Fault-Tolerant Services Using the State Machine</span></div>
<div style="position:absolute;left:145.57px;top:270.57px" class="cls_007"><span class="cls_007">Approach: A Tutorial. ACM Comput. Surv., 22(4):299-319, 1990.</span></div>
<div style="position:absolute;left:300.55px;top:720.98px" class="cls_007"><span class="cls_007">45</span></div>
</div>

</body>
</html>
